var Prototype={Version:'1.6.1',Browser:(function(){var ua=navigator.userAgent;var isOpera=Object.prototype.toString.call(window.opera)=='[object Opera]';return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf('AppleWebKit/')>-1,Gecko:ua.indexOf('Gecko')>-1&&ua.indexOf('KHTML')===-1,MobileSafari:/Apple.*Mobile.*Safari/.test(ua)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var constructor=window.Element||window.HTMLElement;return!!(constructor&&constructor.prototype);})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=='undefined')
return true;var div=document.createElement('div');var form=document.createElement('form');var isSupported=false;if(div['__proto__']&&(div['__proto__']!==form['__proto__'])){isSupported=true;}
div=form=null;return isSupported;})()},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions=false;var Abstract={};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}
return returnValue;}};var Class=(function(){function subclass(){};function create(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))
parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)
klass.addMethods(properties[i]);if(!klass.prototype.initialize)
klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}
function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length){if(source.toString!=Object.prototype.toString)
properties.push("toString");if(source.valueOf!=Object.prototype.valueOf)
properties.push("valueOf");}
for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments);};})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);}
this.prototype[property]=value;}
return this;}
return{create:create,Methods:{addMethods:addMethods}};})();(function(){var _toString=Object.prototype.toString;function extend(destination,source){for(var property in source)
destination[property]=source[property];return destination;}
function inspect(object){try{if(isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}catch(e){if(e instanceof RangeError)return'...';throw e;}}
function toJSON(object){var type=typeof object;switch(type){case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(isElement(object))return;var results=[];for(var property in object){var value=toJSON(object[property]);if(!isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';}
function toQueryString(object){return $H(object).toQueryString();}
function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object);}
function keys(object){var results=[];for(var property in object)
results.push(property);return results;}
function values(object){var results=[];for(var property in object)
results.push(object[property]);return results;}
function clone(object){return extend({},object);}
function isElement(object){return!!(object&&object.nodeType==1);}
function isArray(object){return _toString.call(object)=="[object Array]";}
function isHash(object){return object instanceof Hash;}
function isFunction(object){return typeof object==="function";}
function isString(object){return _toString.call(object)=="[object String]";}
function isNumber(object){return _toString.call(object)=="[object Number]";}
function isUndefined(object){return typeof object==="undefined";}
extend(Object,{extend:extend,inspect:inspect,toJSON:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isUndefined:isUndefined});})();Object.extend(Function.prototype,(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--)array[arrayLength+length]=args[length];return array;}
function merge(array,args){array=slice.call(array,0);return update(array,args);}
function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',');return names.length==1&&!names[0]?[]:names;}
function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a);}}
function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a);}}
function curry(){if(!arguments.length)return this;var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a);}}
function delay(timeout){var __method=this,args=slice.call(arguments,1);timeout=timeout*1000
return window.setTimeout(function(){return __method.apply(__method,args);},timeout);}
function defer(){var args=update([0.01],arguments);return this.delay.apply(this,args);}
function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a);}}
function methodize(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a);};}
return{argumentNames:argumentNames,bind:bind,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize}})());Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+'-'+
(this.getUTCMonth()+1).toPaddedString(2)+'-'+
this.getUTCDate().toPaddedString(2)+'T'+
this.getUTCHours().toPaddedString(2)+':'+
this.getUTCMinutes().toPaddedString(2)+':'+
this.getUTCSeconds().toPaddedString(2)+'Z"';};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},execute:function(){this.callback(this);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false;}catch(e){this.currentlyExecuting=false;throw e;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,(function(){function prepareReplacement(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};}
function gsub(pattern,replacement){var result='',source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern))
pattern=RegExp.escape(pattern);if(!(pattern.length||pattern.source)){replacement=replacement('');return replacement+source.split('').join(replacement)+replacement;}
while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}
return result;}
function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});}
function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this);}
function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);}
function strip(){return this.replace(/^\s+/,'').replace(/\s+$/,'');}
function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,'');}
function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');}
function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});}
function evalScripts(){return this.extractScripts().map(function(script){return eval(script)});}
function escapeHTML(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function unescapeHTML(){return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');}
function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});}
function toArray(){return this.split('');}
function succ(){return this.slice(0,this.length-1)+
String.fromCharCode(this.charCodeAt(this.length-1)+1);}
function times(count){return count<1?'':new Array(count+1).join(this);}
function camelize(){var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)
camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;}
function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();}
function underscore(){return this.replace(/::/g,'/').replace(/([A-Z]+)([A-Z][a-z])/g,'$1_$2').replace(/([a-z\d])([A-Z])/g,'$1_$2').replace(/-/g,'_').toLowerCase();}
function dasherize(){return this.replace(/_/g,'-');}
function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character];}
return'\\u00'+character.charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";}
function toJSON(){return this.inspect(true);}
function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,'$1');}
function isJSON(){var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);}
function evalJSON(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());}
function include(pattern){return this.indexOf(pattern)>-1;}
function startsWith(pattern){return this.indexOf(pattern)===0;}
function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;}
function empty(){return this=='';}
function blank(){return/^\s*$/.test(this);}
function interpolate(object,pattern){return new Template(this,pattern).evaluate(object);}
return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim?String.prototype.trim:strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,toJSON:toJSON,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate};})());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(object&&Object.isFunction(object.toTemplateReplacements))
object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return(match[1]+'');var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null){var comp=match[1].startsWith('[')?match[2].replace(/\\\\]/g,']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function each(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++);});}catch(e){if(e!=$break)throw e;}
return this;}
function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);}
function all(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result)throw $break;});return result;}
function any(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index))
throw $break;});return result;}
function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index));});return results;}
function detect(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break;}});return result;}
function findAll(iterator,context){var results=[];this.each(function(value,index){if(iterator.call(context,value,index))
results.push(value);});return results;}
function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(RegExp.escape(filter));this.each(function(value,index){if(filter.match(value))
results.push(iterator.call(context,value,index));});return results;}
function include(object){if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value){if(value==object){found=true;throw $break;}});return found;}
function inGroupsOf(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});}
function inject(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index);});return memo;}
function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});}
function max(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result)
result=value;});return result;}
function min(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result)
result=value;});return result;}
function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}
function pluck(property){var results=[];this.each(function(value){results.push(value[property]);});return results;}
function reject(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index))
results.push(value);});return results;}
function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');}
function toArray(){return this.map();}
function zip(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))
iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});}
function size(){return this.toArray().length;}
function inspect(){return'#<Enumerable:'+this.toArray().inspect()+'>';}
return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect};})();function $A(iterable){if(!iterable)return[];if('toArray'in Object(iterable))return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
function $w(string){if(!Object.isString(string))return[];string=string.strip();return string?string.split(/\s+/):[];}
Array.from=$A;(function(){var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;function each(iterator){for(var i=0,length=this.length;i<length;i++)
iterator(this[i]);}
if(!_each)_each=each;function clear(){this.length=0;return this;}
function first(){return this[0];}
function last(){return this[this.length-1];}
function compact(){return this.select(function(value){return value!=null;});}
function flatten(){return this.inject([],function(array,value){if(Object.isArray(value))
return array.concat(value.flatten());array.push(value);return array;});}
function without(){var values=slice.call(arguments,0);return this.select(function(value){return!values.include(value);});}
function reverse(inline){return(inline!==false?this:this.toArray())._reverse();}
function uniq(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value)))
array.push(value);return array;});}
function intersect(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});}
function clone(){return slice.call(this,0);}
function size(){return this.length;}
function inspect(){return'['+this.map(Object.inspect).join(', ')+']';}
function toJSON(){var results=[];this.each(function(object){var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}
function indexOf(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)
if(this[i]===item)return i;return-1;}
function lastIndexOf(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;}
function concat(){var array=slice.call(this,0),item;for(var i=0,length=arguments.length;i<length;i++){item=arguments[i];if(Object.isArray(item)&&!('callee'in item)){for(var j=0,arrayLength=item.length;j<arrayLength;j++)
array.push(item[j]);}else{array.push(item);}}
return array;}
Object.extend(arrayProto,Enumerable);if(!arrayProto._reverse)
arrayProto._reverse=arrayProto.reverse;Object.extend(arrayProto,{_each:_each,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect,toJSON:toJSON});var CONCAT_ARGUMENTS_BUGGY=(function(){return[].concat(arguments)[0][0]!==1;})(1,2)
if(CONCAT_ARGUMENTS_BUGGY)arrayProto.concat=concat;if(!arrayProto.indexOf)arrayProto.indexOf=indexOf;if(!arrayProto.lastIndexOf)arrayProto.lastIndexOf=lastIndexOf;})();function $H(object){return new Hash(object);};var Hash=Class.create(Enumerable,(function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object);}
function _each(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}}
function set(key,value){return this._object[key]=value;}
function get(key){if(this._object[key]!==Object.prototype[key])
return this._object[key];}
function unset(key){var value=this._object[key];delete this._object[key];return value;}
function toObject(){return Object.clone(this._object);}
function keys(){return this.pluck('key');}
function values(){return this.pluck('value');}
function index(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;}
function merge(object){return this.clone().update(object);}
function update(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result;});}
function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=='object'){if(Object.isArray(values))
return results.concat(values.map(toQueryPair.curry(key)));}else results.push(toQueryPair(key,values));return results;}).join('&');}
function inspect(){return'#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';}
function toJSON(){return Object.toJSON(this.toObject());}
function clone(){return new Hash(this);}
return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toJSON,clone:clone};})());Hash.from=$H;Object.extend(Number.prototype,(function(){function toColorPart(){return this.toPaddedString(2,16);}
function succ(){return this+1;}
function times(iterator,context){$R(0,this,true).each(iterator,context);return this;}
function toPaddedString(length,radix){var string=this.toString(radix||10);return'0'.times(length-string.length)+string;}
function toJSON(){return isFinite(this)?this.toString():'null';}
function abs(){return Math.abs(this);}
function round(){return Math.round(this);}
function ceil(){return Math.ceil(this);}
function floor(){return Math.floor(this);}
return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,toJSON:toJSON,abs:abs,round:round,ceil:ceil,floor:floor};})());function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive);}
var ObjectRange=Class.create(Enumerable,(function(){function initialize(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;}
function _each(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}}
function include(value){if(value<this.start)
return false;if(this.exclusive)
return value<this.end;return value<=this.end;}
return{initialize:initialize,_each:_each,include:include};})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))
this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))
this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))
this.options.parameters=this.options.parameters.toObject();}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!['get','post'].include(this.method)){params['_method']=this.method;this.method='post';}
this.parameters=params;if(params=Object.toQueryString(params)){if(this.method=='get')
this.url+=(this.url.include('?')?'&':'?')+params;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))
params+='&_=';}
try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)
this.onStateChange();}
catch(e){this.dispatchException(e);}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete))
this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+
(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)
headers['Connection']='close';}
if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))
for(var i=0,length=extras.length;i<length;i+=2)
headers[extras[i]]=extras[i+1];else
$H(extras).each(function(pair){headers[pair.key]=pair.value});}
for(var name in headers)
this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300);},getStatus:function(){try{return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}
var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
this.evalResponse();}
try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}
if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||(m[0]=='#{protocol}//#{domain}#{port}'.interpolate({protocol:location.protocol,domain:document.domain,port:location.port?':'+location.port:''}));},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null;}catch(e){return null;}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON();}
if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},_getHeaderJSON:function(){var json=this.getHeader('X-JSON');if(!json)return null;json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!='force'&&!(this.getHeader('Content-type')||'').include('application/json'))||this.responseText.blank())
return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);$super(url,options);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}
else options.insertion(receiver,responseText);}
else receiver.update(responseText);}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText;}
this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)
elements.push($(arguments[i]));return elements;}
if(Object.isString(element))
element=document.getElementById(element);return Element.extend(element);}
if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)
results.push(Element.extend(query.snapshotItem(i)));return results;};}
if(!window.Node)var Node={};if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}
(function(global){var SETATTRIBUTE_IGNORES_NAME=(function(){var elForm=document.createElement("form");var elInput=document.createElement("input");var root=document.documentElement;elInput.setAttribute("name","test");elForm.appendChild(elInput);root.appendChild(elForm);var isBuggy=elForm.elements?(typeof elForm.elements.test=="undefined"):null;root.removeChild(elForm);elForm=elInput=null;return isBuggy;})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(SETATTRIBUTE_IGNORES_NAME&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}
if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));return Element.writeAttribute(cache[tagName].cloneNode(false),attributes);};Object.extend(global.Element,element||{});if(element)global.Element.prototype=element.prototype;})(this);Element.cache={};Element.idCounter=1;Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){element=$(element);element.style.display='none';return element;},show:function(element){element=$(element);element.style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML="<option value=\"test\">test</option>";if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION";}
el=null;return isBuggy;})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy;}}catch(e){return true;}})();var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3;}catch(e){isBuggy=true;}
s=null;return isBuggy;})();function update(element,content){element=$(element);if(content&&content.toElement)
content=content.toElement();if(Object.isElement(content))
return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==='SCRIPT'&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element;}
if(SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild);}
Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}
else{element.innerHTML=content.stripScripts();}}
else{element.innerHTML=content.stripScripts();}
content.evalScripts.bind(content).defer();return element;}
return update;})(),replace:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts());}
element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))
insertions={bottom:insertions};var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){insert(element,content);continue;}
content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')childNodes.reverse();childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer();}
return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))
$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)
element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return wrapper;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last();var value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property){element=$(element);var elements=[];while(element=element[property])
if(element.nodeType==1)
elements.push(Element.extend(element));return elements;},ancestors:function(element){return Element.recursivelyCollect(element,'parentNode');},descendants:function(element){return Element.select(element,"*");},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){if(!(element=$(element).firstChild))return[];while(element&&element.nodeType!=1)element=element.nextSibling;if(element)return[element].concat($(element).nextSiblings());return[];},previousSiblings:function(element){return Element.recursivelyCollect(element,'previousSibling');},nextSiblings:function(element){return Element.recursivelyCollect(element,'nextSibling');},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element));},match:function(element,selector){if(Object.isString(selector))
selector=new Selector(selector);return selector.match($(element));},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Selector.findElement(ancestors,expression,index);},down:function(element,expression,index){element=$(element);if(arguments.length==1)return Element.firstDescendant(element);return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0];},previous:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(element));var previousSiblings=Element.previousSiblings(element);return Object.isNumber(expression)?previousSiblings[expression]:Selector.findElement(previousSiblings,expression,index);},next:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.nextElementSibling(element));var nextSiblings=Element.nextSiblings(element);return Object.isNumber(expression)?nextSiblings[expression]:Selector.findElement(nextSiblings,expression,index);},select:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element,args);},adjacent:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element.parentNode,args).without(element);},identify:function(element){element=$(element);var id=Element.readAttribute(element,'id');if(id)return id;do{id='anonymous_element_'+Element.idCounter++}while($(id));Element.writeAttribute(element,'id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];if(name.include(':')){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value;}}
return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=Object.isUndefined(value)?true:value;for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)
element.removeAttribute(name);else if(value===true)
element.setAttribute(name,name);else element.setAttribute(name,value);}
return element;},getHeight:function(element){return Element.getDimensions(element).height;},getWidth:function(element){return Element.getDimensions(element).width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));},addClassName:function(element,className){if(!(element=$(element)))return;if(!Element.hasClassName(element,className))
element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return Element[Element.hasClassName(element,className)?'removeClassName':'addClassName'](element,className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue))
element.removeChild(node);node=nextNode;}
return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition)
return(element.compareDocumentPosition(ancestor)&8)===8;if(ancestor.contains)
return ancestor.contains(element)&&ancestor!==element;while(element=element.parentNode)
if(element==ancestor)return true;return false;},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value||value=='auto'){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}
if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles)
if(property=='opacity')element.setOpacity(styles[property]);else{var tmp=(property=='float'||property=='cssFloat')?(Object.isUndefined(elementStyle.styleFloat)?'cssFloat':'styleFloat'):property
if(tmp=='width'){if(parseInt(styles[property])>=0)
elementStyle[tmp]=styles[property];}else{elementStyle[tmp]=styles[property];}}
return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},getDimensions:function(element){element=$(element);var display=Element.getStyle(element,'display');if(display!='none'&&display!=null)
return{width:element.offsetWidth,height:element.offsetHeight};var els=element.style;var originalVisibility=els.visibility;var originalPosition=els.position;var originalDisplay=els.display;els.visibility='hidden';if(originalPosition!='fixed')
els.position='absolute';els.display='block';var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;els.display=originalDisplay;els.position=originalPosition;els.visibility=originalVisibility;return{width:originalWidth,height:originalHeight};},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'||!pos){element._madePositioned=true;element.style.position='relative';if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0;}}
return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}
return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=Element.getStyle(element,'overflow')||'auto';if(element._overflow!=='hidden')
element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},cumulativeOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);},positionedOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(element.tagName.toUpperCase()=='BODY')break;var p=Element.getStyle(element,'position');if(p!=='static')break;}}while(element);return Element._returnOffset(valueL,valueT);},absolutize:function(element){element=$(element);if(Element.getStyle(element,'position')=='absolute')return element;var offsets=Element.positionedOffset(element);var top=offsets[1];var left=offsets[0];var width=element.clientWidth;var height=element.clientHeight;element._originalLeft=left-parseFloat(element.style.left||0);element._originalTop=top-parseFloat(element.style.top||0);element._originalWidth=element.style.width;element._originalHeight=element.style.height;element.style.position='absolute';element.style.top=top+'px';element.style.left=left+'px';element.style.width=width+'px';element.style.height=height+'px';return element;},relativize:function(element){element=$(element);if(Element.getStyle(element,'position')=='relative')return element;element.style.position='relative';var top=parseFloat(element.style.top||0)-(element._originalTop||0);var left=parseFloat(element.style.left||0)-(element._originalLeft||0);element.style.top=top+'px';element.style.left=left+'px';element.style.height=element._originalHeight;element.style.width=element._originalWidth;return element;},cumulativeScrollOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return Element._returnOffset(valueL,valueT);},getOffsetParent:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body)
if(Element.getStyle(element,'position')!='static')
return $(element);return $(document.body);},viewportOffset:function(forElement){var valueT=0,valueL=0;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||(element.tagName&&(element.tagName.toUpperCase()=='BODY'))){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return Element._returnOffset(valueL,valueT);},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source);element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent);}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case'left':case'top':case'right':case'bottom':if(proceed(element,'position')==='static')return null;case'height':case'width':if(!Element.visible(element))return null;var dim=parseInt(proceed(element,style),10);if(dim!==element['offset'+style.capitalize()])
return dim+'px';var properties;if(style==='height'){properties=['border-top-width','padding-top','padding-bottom','border-bottom-width'];}
else{properties=['border-left-width','padding-left','padding-right','border-right-width'];}
return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10);})+'px';default:return proceed(element,style);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==='title')return element.title;return proceed(element,attribute);});}
else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return $(document.body)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});$w('positionedOffset viewportOffset').each(function(method){Element.Methods[method]=Element.Methods[method].wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle('position')==='fixed')
offsetParent.setStyle({zoom:1});element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(proceed,element){try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
return proceed(element);});Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))
if(value[1])return parseFloat(value[1])/100;return 1.0;}
if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))
return element['offset'+style.capitalize()]+'px';return null;}
return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');}
element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=='normal'))
element.style.zoom=1;var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations=(function(){var classProp='className';var forProp='for';var el=document.createElement('div');el.setAttribute(classProp,'x');if(el.className!=='x'){el.setAttribute('class','x');if(el.className==='x'){classProp='class';}}
el=null;el=document.createElement('label');el.setAttribute(forProp,'x');if(el.htmlFor!=='x'){el.setAttribute('htmlFor','x');if(el.htmlFor==='x'){forProp='htmlFor';}}
el=null;return{read:{names:{'class':classProp,'className':classProp,'for':forProp,'htmlFor':forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute);},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2);},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:"";},_getEv:(function(){var el=document.createElement('div');el.onclick=Prototype.emptyFunction;var value=el.getAttribute('onclick');var f;if(String(value).indexOf('{')>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;attribute=attribute.toString();attribute=attribute.split('{')[1];attribute=attribute.split('}')[0];return attribute.strip();};}
else if(value===''){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;return attribute.strip();};}
el=null;return f;})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:'cellPadding',cellspacing:'cellSpacing'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value;},style:function(element,value){element.style.cssText=value?value:'';}}};Element._attributeTranslations.has={};$w('colSpan rowSpan vAlign dateTime accessKey tabIndex '+'encType maxLength readOnly longDesc frameBorder').each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr;});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName('*'),results=[];for(var i=0,node;node=nodes[i];i++)
if(node.tagName!=="!")
results.push(node);return results;}
Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0];}})();}}
else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}
else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)
if(element.tagName.toUpperCase()=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}
return element;};Element.Methods.cumulativeOffset=function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);};}
if('outerHTML'in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}
content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next();var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)
fragments.each(function(node){parent.insertBefore(node,nextSibling)});else
fragments.each(function(node){parent.appendChild(node)});}
else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];if(t){div.innerHTML=t[0]+html+t[1];t[2].times(function(){div=div.firstChild});}else div.innerHTML=html;return $A(div.childNodes);};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element);},top:function(element,node){element.insertBefore(node,element.firstChild);},bottom:function(element,node){element.appendChild(node);},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD});})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!!(node&&node.specified);}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div['__proto__']){window.HTMLElement={};window.HTMLElement.prototype=div['__proto__'];Prototype.BrowserFeatures.ElementExtensions=true;}
div=null;})(document.createElement('div'))
Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!='undefined'){var proto=window.Element.prototype;if(proto){var id='_'+(Math.random()+'').slice(2);var el=document.createElement(tagName);proto[id]='x';var isBuggy=(el[id]!=='x');delete proto[id];el=null;return isBuggy;}}
return false;}
function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element))
element[property]=value.methodize();}}
var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency('object');if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=='undefined'){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()]);}}
return element;}}
return Prototype.K;}
var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!='undefined'||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();Element.hasAttribute=function(element,attribute){if(element.hasAttribute)return element.hasAttribute(attribute);return Element.Methods.Simulated.hasAttribute(element,attribute);};Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)});}
if(arguments.length==2){var tagName=methods;methods=arguments[1];}
if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}
function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])
Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);}
function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent||!(property in destination))
destination[property]=value.methodize();}}
function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];var element=document.createElement(tagName);var proto=element['__proto__']||element.constructor.prototype;element=null;return proto;}
var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true);}
if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}
Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()};},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate)
return document;if(B.Opera&&window.parseFloat(window.opera.version())<9.5)
return document.body;return document.documentElement;}
function define(D){if(!element)element=getRootElement();property[D]='client'+D;viewport['get'+D]=function(){return element[property[D]]};return viewport['get'+D]();}
viewport.getWidth=define.curry('Width');viewport.getHeight=define.curry('Height');})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element)))return;var uid;if(element===window){uid=0;}else{if(typeof element._prototypeUID==="undefined")
element._prototypeUID=[Element.Storage.UID++];uid=element._prototypeUID[0];}
if(!Element.Storage[uid])
Element.Storage[uid]=$H();return Element.Storage[uid];},store:function(element,key,value){if(!(element=$(element)))return;if(arguments.length===2){Element.getStorage(element).update(key);}else{Element.getStorage(element).set(key,value);}
return element;},retrieve:function(element,key,defaultValue){if(!(element=$(element)))return;var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue;}
return value;},clone:function(element,deep){if(!(element=$(element)))return;var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,'*'),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0;}}
return Element.extend(clone);}});var Selector=Class.create({initialize:function(expression){this.expression=expression.strip();if(this.shouldUseSelectorsAPI()){this.mode='selectorsAPI';}else if(this.shouldUseXPath()){this.mode='xpath';this.compileXPathMatcher();}else{this.mode="normal";this.compileMatcher();}},shouldUseXPath:(function(){var IS_DESCENDANT_SELECTOR_BUGGY=(function(){var isBuggy=false;if(document.evaluate&&window.XPathResult){var el=document.createElement('div');el.innerHTML='<ul><li></li></ul><div><ul><li></li></ul></div>';var xpath=".//*[local-name()='ul' or local-name()='UL']"+"//*[local-name()='li' or local-name()='LI']";var result=document.evaluate(xpath,el,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);isBuggy=(result.snapshotLength!==2);el=null;}
return isBuggy;})();return function(){if(!Prototype.BrowserFeatures.XPath)return false;var e=this.expression;if(Prototype.Browser.WebKit&&(e.include("-of-type")||e.include(":empty")))
return false;if((/(\[[\w-]*?:|:checked)/).test(e))
return false;if(IS_DESCENDANT_SELECTOR_BUGGY)return false;return true;}})(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return false;if(!Selector._div)Selector._div=new Element('div');try{Selector._div.querySelector(this.expression);}catch(e){return false;}
return true;},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m,len=ps.length,name;if(Selector._cache[e]){this.matcher=Selector._cache[e];return;}
this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){this.matcher.push(Object.isFunction(c[name])?c[name](m):new Template(c[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join('\n'));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var e=this.expression,ps=Selector.patterns,x=Selector.xpath,le,m,len=ps.length,name;if(Selector._cache[e]){this.xpath=Selector._cache[e];return;}
this.matcher=['.//*'];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=ps[i].name;if(m=e.match(ps[i].re)){this.matcher.push(Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.xpath=this.matcher.join('');Selector._cache[this.expression]=this.xpath;},findElements:function(root){root=root||document;var e=this.expression,results;switch(this.mode){case'selectorsAPI':if(root!==document){var oldId=root.id,id=$(root).identify();id=id.replace(/([\.:])/g,"\\$1");e="#"+id+" "+e;}
results=$A(root.querySelectorAll(e)).map(Element.extend);root.id=oldId;return results;case'xpath':return document._getElementsByXPath(this.xpath,root);default:return this.matcher(root);}},match:function(element){this.tokens=[];var e=this.expression,ps=Selector.patterns,as=Selector.assertions;var le,p,m,len=ps.length,name;while(e&&le!==e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){if(as[name]){this.tokens.push([name,Object.clone(m)]);e=e.replace(m[0],'');}else{return this.findElements(document).include(element);}}}}
var match=true,name,matches;for(var i=0,token;token=this.tokens[i];i++){name=token[0],matches=token[1];if(!Selector.assertions[name](element,matches)){match=false;break;}}
return match;},toString:function(){return this.expression;},inspect:function(){return"#<Selector:"+this.expression.inspect()+">";}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==='BackCompat'){Selector.CASE_INSENSITIVE_CLASS_NAMES=(function(){var div=document.createElement('div'),span=document.createElement('span');div.id="prototype_test_id";span.className='Test';div.appendChild(span);var isIgnored=(div.querySelector('#prototype_test_id .test')!==null);div=span=null;return isIgnored;})();}
Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:'/following-sibling::*',tagName:function(m){if(m[1]=='*')return'';return"[local-name()='"+m[1].toLowerCase()+"' or local-name()='"+m[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(m){m[1]=m[1].toLowerCase();return new Template("[@#{1}]").evaluate(m);},attr:function(m){m[1]=m[1].toLowerCase();m[3]=m[5]||m[6];return new Template(Selector.xpath.operators[m[2]]).evaluate(m);},pseudo:function(m){var h=Selector.xpath.pseudos[m[1]];if(!h)return'';if(Object.isFunction(h))return h(m);return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);},operators:{'=':"[@#{1}='#{3}']",'!=':"[@#{1}!='#{3}']",'^=':"[starts-with(@#{1}, '#{3}')]",'$=':"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",'*=':"[contains(@#{1}, '#{3}')]",'~=':"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",'|=':"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{'first-child':'[not(preceding-sibling::*)]','last-child':'[not(following-sibling::*)]','only-child':'[not(preceding-sibling::* or following-sibling::*)]','empty':"[count(*) = 0 and (count(text()) = 0)]",'checked':"[@checked]",'disabled':"[(@disabled) and (@type!='hidden')]",'enabled':"[not(@disabled) and (@type!='hidden')]",'not':function(m){var e=m[6],p=Selector.patterns,x=Selector.xpath,le,v,len=p.length,name;var exclusion=[];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=p[i].name
if(m=e.match(p[i].re)){v=Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m);exclusion.push("("+v.substring(1,v.length-1)+")");e=e.replace(m[0],'');break;}}}
return"[not("+exclusion.join(" and ")+")]";},'nth-child':function(m){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",m);},'nth-last-child':function(m){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",m);},'nth-of-type':function(m){return Selector.xpath.pseudos.nth("position() ",m);},'nth-last-of-type':function(m){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",m);},'first-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-of-type'](m);},'last-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-last-of-type'](m);},'only-of-type':function(m){var p=Selector.xpath.pseudos;return p['first-of-type'](m)+p['last-of-type'](m);},nth:function(fragment,m){var mm,formula=m[6],predicate;if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';if(mm=formula.match(/^(\d+)$/))
return'['+fragment+"= "+mm[1]+']';if(mm=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(mm[1]=="-")mm[1]=-1;var a=mm[1]?Number(mm[1]):1;var b=mm[2]?Number(mm[2]):0;predicate="[((#{fragment} - #{b}) mod #{a} = 0) and "+"((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(predicate).evaluate({fragment:fragment,a:a,b:b});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(m){m[3]=(m[5]||m[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);},pseudo:function(m){if(m[6])m[6]=m[6].replace(/"/g,'\\"');return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:'laterSibling',re:/^\s*~\s*/},{name:'child',re:/^\s*>\s*/},{name:'adjacent',re:/^\s*\+\s*/},{name:'descendant',re:/^\s/},{name:'tagName',re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:'id',re:/^#([\w\-\*]+)(\b|$)/},{name:'className',re:/^\.([\w\-\*]+)(\b|$)/},{name:'pseudo',re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:'attrPresence',re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:'attr',re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(element,matches){return matches[1].toUpperCase()==element.tagName.toUpperCase();},className:function(element,matches){return Element.hasClassName(element,matches[1]);},id:function(element,matches){return element.id===matches[1];},attrPresence:function(element,matches){return Element.hasAttribute(element,matches[1]);},attr:function(element,matches){var nodeValue=Element.readAttribute(element,matches[1]);return nodeValue&&Selector.operators[matches[2]](nodeValue,matches[5]||matches[6]);}},handlers:{concat:function(a,b){for(var i=0,node;node=b[i];i++)
a.push(node);return a;},mark:function(nodes){var _true=Prototype.emptyFunction;for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=_true;return nodes;},unmark:(function(){var PROPERTIES_ATTRIBUTES_MAP=(function(){var el=document.createElement('div'),isBuggy=false,propName='_countedByPrototype',value='x'
el[propName]=value;isBuggy=(el.getAttribute(propName)===value);el=null;return isBuggy;})();return PROPERTIES_ATTRIBUTES_MAP?function(nodes){for(var i=0,node;node=nodes[i];i++)
node.removeAttribute('_countedByPrototype');return nodes;}:function(nodes){for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=void 0;return nodes;}})(),index:function(parentNode,reverse,ofType){parentNode._countedByPrototype=Prototype.emptyFunction;if(reverse){for(var nodes=parentNode.childNodes,i=nodes.length-1,j=1;i>=0;i--){var node=nodes[i];if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}}else{for(var i=0,j=1,nodes=parentNode.childNodes;node=nodes[i];i++)
if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}},unique:function(nodes){if(nodes.length==0)return nodes;var results=[],n;for(var i=0,l=nodes.length;i<l;i++)
if(typeof(n=nodes[i])._countedByPrototype=='undefined'){n._countedByPrototype=Prototype.emptyFunction;results.push(Element.extend(n));}
return Selector.handlers.unmark(results);},descendant:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName('*'));return results;},child:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++){for(var j=0,child;child=node.childNodes[j];j++)
if(child.nodeType==1&&child.tagName!='!')results.push(child);}
return results;},adjacent:function(nodes){for(var i=0,results=[],node;node=nodes[i];i++){var next=this.nextElementSibling(node);if(next)results.push(next);}
return results;},laterSibling:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,Element.nextSiblings(node));return results;},nextElementSibling:function(node){while(node=node.nextSibling)
if(node.nodeType==1)return node;return null;},previousElementSibling:function(node){while(node=node.previousSibling)
if(node.nodeType==1)return node;return null;},tagName:function(nodes,root,tagName,combinator){var uTagName=tagName.toUpperCase();var results=[],h=Selector.handlers;if(nodes){if(combinator){if(combinator=="descendant"){for(var i=0,node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName(tagName));return results;}else nodes=this[combinator](nodes);if(tagName=="*")return nodes;}
for(var i=0,node;node=nodes[i];i++)
if(node.tagName.toUpperCase()===uTagName)results.push(node);return results;}else return root.getElementsByTagName(tagName);},id:function(nodes,root,id,combinator){var targetNode=$(id),h=Selector.handlers;if(root==document){if(!targetNode)return[];if(!nodes)return[targetNode];}else{if(!root.sourceIndex||root.sourceIndex<1){var nodes=root.getElementsByTagName('*');for(var j=0,node;node=nodes[j];j++){if(node.id===id)return[node];}}}
if(nodes){if(combinator){if(combinator=='child'){for(var i=0,node;node=nodes[i];i++)
if(targetNode.parentNode==node)return[targetNode];}else if(combinator=='descendant'){for(var i=0,node;node=nodes[i];i++)
if(Element.descendantOf(targetNode,node))return[targetNode];}else if(combinator=='adjacent'){for(var i=0,node;node=nodes[i];i++)
if(Selector.handlers.previousElementSibling(targetNode)==node)
return[targetNode];}else nodes=h[combinator](nodes);}
for(var i=0,node;node=nodes[i];i++)
if(node==targetNode)return[targetNode];return[];}
return(targetNode&&Element.descendantOf(targetNode,root))?[targetNode]:[];},className:function(nodes,root,className,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);return Selector.handlers.byClassName(nodes,root,className);},byClassName:function(nodes,root,className){if(!nodes)nodes=Selector.handlers.descendant([root]);var needle=' '+className+' ';for(var i=0,results=[],node,nodeClassName;node=nodes[i];i++){nodeClassName=node.className;if(nodeClassName.length==0)continue;if(nodeClassName==className||(' '+nodeClassName+' ').include(needle))
results.push(node);}
return results;},attrPresence:function(nodes,root,attr,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var results=[];for(var i=0,node;node=nodes[i];i++)
if(Element.hasAttribute(node,attr))results.push(node);return results;},attr:function(nodes,root,attr,value,operator,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var handler=Selector.operators[operator],results=[];for(var i=0,node;node=nodes[i];i++){var nodeValue=Element.readAttribute(node,attr);if(nodeValue===null)continue;if(handler(nodeValue,value))results.push(node);}
return results;},pseudo:function(nodes,name,value,root,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);if(!nodes)nodes=root.getElementsByTagName("*");return Selector.pseudos[name](nodes,value,root);}},pseudos:{'first-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.previousElementSibling(node))continue;results.push(node);}
return results;},'last-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.nextElementSibling(node))continue;results.push(node);}
return results;},'only-child':function(nodes,value,root){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
if(!h.previousElementSibling(node)&&!h.nextElementSibling(node))
results.push(node);return results;},'nth-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root);},'nth-last-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true);},'nth-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,false,true);},'nth-last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true,true);},'first-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,false,true);},'last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,true,true);},'only-of-type':function(nodes,formula,root){var p=Selector.pseudos;return p['last-of-type'](p['first-of-type'](nodes,formula,root),formula,root);},getIndices:function(a,b,total){if(a==0)return b>0?[b]:[];return $R(1,total).inject([],function(memo,i){if(0==(i-b)%a&&(i-b)/a>=0)memo.push(i);return memo;});},nth:function(nodes,formula,root,reverse,ofType){if(nodes.length==0)return[];if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';var h=Selector.handlers,results=[],indexed=[],m;h.mark(nodes);for(var i=0,node;node=nodes[i];i++){if(!node.parentNode._countedByPrototype){h.index(node.parentNode,reverse,ofType);indexed.push(node.parentNode);}}
if(formula.match(/^\d+$/)){formula=Number(formula);for(var i=0,node;node=nodes[i];i++)
if(node.nodeIndex==formula)results.push(node);}else if(m=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(m[1]=="-")m[1]=-1;var a=m[1]?Number(m[1]):1;var b=m[2]?Number(m[2]):0;var indices=Selector.pseudos.getIndices(a,b,nodes.length);for(var i=0,node,l=indices.length;node=nodes[i];i++){for(var j=0;j<l;j++)
if(node.nodeIndex==indices[j])results.push(node);}}
h.unmark(nodes);h.unmark(indexed);return results;},'empty':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(node.tagName=='!'||node.firstChild)continue;results.push(node);}
return results;},'not':function(nodes,selector,root){var h=Selector.handlers,selectorType,m;var exclusions=new Selector(selector).findElements(root);h.mark(exclusions);for(var i=0,results=[],node;node=nodes[i];i++)
if(!node._countedByPrototype)results.push(node);h.unmark(exclusions);return results;},'enabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(!node.disabled&&(!node.type||node.type!=='hidden'))
results.push(node);return results;},'disabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.disabled)results.push(node);return results;},'checked':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.checked)results.push(node);return results;}},operators:{'=':function(nv,v){return nv==v;},'!=':function(nv,v){return nv!=v;},'^=':function(nv,v){return nv==v||nv&&nv.startsWith(v);},'$=':function(nv,v){return nv==v||nv&&nv.endsWith(v);},'*=':function(nv,v){return nv==v||nv&&nv.include(v);},'~=':function(nv,v){return(' '+nv+' ').include(' '+v+' ');},'|=':function(nv,v){return('-'+(nv||"").toUpperCase()+'-').include('-'+(v||"").toUpperCase()+'-');}},split:function(expression){var expressions=[];expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(m){expressions.push(m[1].strip());});return expressions;},matchElements:function(elements,expression){var matches=$$(expression),h=Selector.handlers;h.mark(matches);for(var i=0,results=[],element;element=elements[i];i++)
if(element._countedByPrototype)results.push(element);h.unmark(matches);return results;},findElement:function(elements,expression,index){if(Object.isNumber(expression)){index=expression;expression=false;}
return Selector.matchElements(elements,expression||'*')[index||0];},findChildElements:function(element,expressions){expressions=Selector.split(expressions.join(','));var results=[],h=Selector.handlers;for(var i=0,l=expressions.length,selector;i<l;i++){selector=new Selector(expressions[i].strip());h.concat(results,selector.findElements(element));}
return(l>1)?h.unique(results):results;}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(a,b){for(var i=0,node;node=b[i];i++)
if(node.tagName!=="!")a.push(node);return a;}});}
function $$(){return Selector.findChildElements(document,$A(arguments));}
var Form={reset:function(form){form=$(form);form.reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash:!!options};else if(Object.isUndefined(options.hash))options.hash=true;var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}
else result[key]=value;}}
return result;});return options.hash?data:Object.toQueryString(data);}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){var elements=$(form).getElementsByTagName('*'),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element);}
return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()])
elements.push(Element.extend(child));return elements;})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))
continue;matchingInputs.push(Element.extend(input));}
return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return'hidden'!=element.type&&!element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName);});},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}
if(form.hasAttribute('method')&&!options.method)
options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;},select:function(element){$(element).select();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair);}}
return'';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'||!(/^(?:button|reset|submit)$/i.test(element.type))))
element.select();}catch(e){}
return element;},disable:function(element){element=$(element);element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case'checkbox':case'radio':return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value);}},inputSelector:function(element,value){if(Object.isUndefined(value))return element.checked?element.value:null;else element.checked=!!value;},textarea:function(element,value){if(Object.isUndefined(value))return element.value;else element.value=value;},select:function(element,value){if(Object.isUndefined(value))
return this[element.type=='select-one'?'selectOne':'selectMany'](element);else{var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return;}}
else opt.selected=value.include(currentValue);}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null;},selectMany:function(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(this.optionValue(opt));}
return values;},optionValue:function(opt){return Element.extend(opt).hasAttribute('value')?opt.value:opt.text;}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue();},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value;}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();else
this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this);},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case'checkbox':case'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element);}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED='onmouseenter'in docEl&&'onmouseleave'in docEl;var _isButton;if(Prototype.Browser.IE){var buttonMap={0:1,1:4,2:2};_isButton=function(event,code){return event.button===buttonMap[code];};}else if(Prototype.Browser.WebKit){_isButton=function(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==1&&event.metaKey;default:return false;}};}else{_isButton=function(event,code){return event.which?(event.which===code+1):(event.button===code);};}
function isLeftClick(event){return _isButton(event,0)}
function isMiddleClick(event){return _isButton(event,1)}
function isRightClick(event){return _isButton(event,2)}
function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==='load'||type==='error'||(type==='click'&&currentTarget.tagName.toLowerCase()==='input'&&currentTarget.type==='radio'))
node=currentTarget;}
if(node.nodeType==Node.TEXT_NODE)
node=node.parentNode;return Element.extend(node);}
function findElement(event,expression){var element=Event.element(event);if(!expression)return element;var elements=[element].concat(element.ancestors());return Selector.findElement(elements,expression,0);}
function pointer(event){return{x:pointerX(event),y:pointerY(event)};}
function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+
(docElement.scrollLeft||body.scrollLeft)-
(docElement.clientLeft||0));}
function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+
(docElement.scrollTop||body.scrollTop)-
(docElement.clientTop||0));}
function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true;}
Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(Prototype.Browser.IE){function _relatedTarget(event){var element;switch(event.type){case'mouseover':element=event.fromElement;break;case'mouseout':element=event.toElement;break;default:return null;}
return Element.extend(element);}
Object.extend(methods,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return'[object Event]'}});Event.extend=function(event,element){if(!event)return false;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});return Object.extend(event,methods);};}else{Event.prototype=window.Event.prototype||document.createEvent('HTMLEvents').__proto__;Object.extend(Event.prototype,methods);Event.extend=Prototype.K;}
function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,'prototype_event_registry',$H());}
var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent);}
if(respondersForEvent.pluck('handler').include(handler))return false;var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName))
return false;if(event.eventName!==eventName)
return false;Event.extend(event,element);handler.call(element,event);};}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode;}
catch(e){parent=element;}}
if(parent===element)return;handler.call(element,event);};}}else{responder=function(event){Event.extend(event,element);handler.call(element,event);};}}
responder.handler=handler;respondersForEvent.push(responder);return responder;}
function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null;}}
var CACHE=[];if(Prototype.Browser.IE)
window.attachEvent('onunload',_destroyCache);if(Prototype.Browser.WebKit)
window.addEventListener('unload',Prototype.emptyFunction,false);var _getDOMEventName=Prototype.K;if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){var translations={mouseenter:"mouseover",mouseleave:"mouseout"};return eventName in translations?translations[eventName]:eventName;};}
function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder)return element;if(eventName.include(':')){if(element.addEventListener)
element.addEventListener("dataavailable",responder,false);else{element.attachEvent("ondataavailable",responder);element.attachEvent("onfilterchange",responder);}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener)
element.addEventListener(actualEventName,responder,false);else
element.attachEvent("on"+actualEventName,responder);}
return element;}
function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry))return element;if(eventName&&!handler){var responders=registry.get(eventName);if(Object.isUndefined(responders))return element;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});return element;}else if(!eventName){registry.each(function(pair){var eventName=pair.key,responders=pair.value;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});});return element;}
var responders=registry.get(eventName);if(!responders)return;var responder=responders.find(function(r){return r.handler===handler;});if(!responder)return element;var actualEventName=_getDOMEventName(eventName);if(eventName.include(':')){if(element.removeEventListener)
element.removeEventListener("dataavailable",responder,false);else{element.detachEvent("ondataavailable",responder);element.detachEvent("onfilterchange",responder);}}else{if(element.removeEventListener)
element.removeEventListener(actualEventName,responder,false);else
element.detachEvent('on'+actualEventName,responder);}
registry.set(eventName,responders.without(responder));return element;}
function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble))
bubble=true;if(element==document&&document.createEvent&&!element.dispatchEvent)
element=document.documentElement;var event;if(document.createEvent){event=document.createEvent('HTMLEvents');event.initEvent('dataavailable',true,true);}else{event=document.createEventObject();event.eventType=bubble?'ondataavailable':'onfilterchange';}
event.eventName=eventName;event.memo=memo||{};if(document.createEvent)
element.dispatchEvent(event);else
element.fireEvent(event.eventType,event);return Event.extend(event);}
Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,Event);else window.Event=Event;})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded)return;if(timer)window.clearTimeout(timer);document.loaded=true;document.fire('dom:loaded');}
function checkReadyState(){if(document.readyState==='complete'){document.stopObserving('readystatechange',checkReadyState);fireContentLoadedEvent();}}
function pollDoScroll(){try{document.documentElement.doScroll('left');}
catch(e){timer=pollDoScroll.defer();return;}
fireContentLoadedEvent();}
if(document.addEventListener){document.addEventListener('DOMContentLoaded',fireContentLoadedEvent,false);}else{document.observe('readystatechange',checkReadyState);if(window==top)
timer=pollDoScroll.defer();}
Event.observe(window,'load',fireContentLoadedEvent);})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};if(!document.getElementsByClassName)document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]";}
instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(''):iter(className);return cond?document._getElementsByXPath('.//*'+cond,element):[];}:function(element,className){className=className.toString().strip();var elements=[],classNames=(/\s/.test(className)?$w(className):null);if(!classNames&&!className)return elements;var nodes=$(element).getElementsByTagName('*');className=' '+className+' ';for(var i=0,child,cn;child=nodes[i];i++){if(child.className&&(cn=' '+child.className+' ')&&(cn.include(className)||(classNames&&classNames.all(function(name){return!name.toString().blank()&&cn.include(' '+name+' ');}))))
elements.push(Element.extend(child));}
return elements;};return function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className);};}(Element.Methods);Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+0.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+0.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+0.5;},pulse:function(pos,pulses){pulses=pulses||5;return(((pos%(1/pulses))*pulses).round()==0?((pos*pulses*2)-(pos*pulses*2).floor()):1-((pos*pulses*2)-(pos*pulses*2).floor()));},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect){element=$(element);effect=(effect||'appear').toLowerCase();var options=Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},arguments[2]||{});Effect[element.visible()?Effect.PAIRS[effect][1]:Effect.PAIRS[effect][0]](element,options);}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+'Internal']?'this.options.'+eventName+'Internal(this);':'')+
(options[eventName]?'this.options.'+eventName+'(this);':''));}
if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ '+'if (this.state=="idle"){this.state="running";'+
codeForEvent(this.options,'beforeSetup')+
(this.setup?'this.setup();':'')+
codeForEvent(this.options,'afterSetup')+'};if (this.state=="running"){'+'pos=this.options.transition(pos)*'+this.fromToDelta+'+'+this.options.from+';'+'this.position=pos;'+
codeForEvent(this.options,'beforeUpdate')+
(this.update?'this.update(pos);':'')+
codeForEvent(this.options,'afterUpdate')+'}}');this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset(),max=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1]>max?max:elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round())});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element)},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}})}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}})}})}})}})}})}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options))}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{};var oldOpacity=element.getInlineOpacity();var transition=options.transition||Effect.Transitions.sinoidal;var reverser=function(pos){return transition(1-Effect.Transitions.pulse(pos,options.pulses))};reverser.bind(transition);return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});}}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16)});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))))});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};};Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element)
var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;}});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);var A_TCALDEF={'months':['January','February','March','April','May','June','July','August','September','October','November','December'],'weekdays':['Su','Mo','Tu','We','Th','Fr','Sa'],'yearscroll':true,'weekstart':1,'centyear':70}
function f_tcalParseDate(s_date){var re_date=/^\s*(\d{1,2})\.(\d{1,2})\.(\d{2,4})\s*$/;if(!re_date.exec(s_date))
return alert("Invalid date: '"+s_date+"'.\nAccepted format is dd.mm.yyyy.")
var n_day=Number(RegExp.$1),n_month=Number(RegExp.$2),n_year=Number(RegExp.$3);if(n_year<100)
n_year+=(n_year<this.a_tpl.centyear?2000:1900);if(n_month<1||n_month>12)
return alert("Invalid month value: '"+n_month+"'.\nAllowed range is 01-12.");var d_numdays=new Date(n_year,n_month,0);if(n_day>d_numdays.getDate())
return alert("Invalid day of month value: '"+n_day+"'.\nAllowed range for selected month is 01 - "+d_numdays.getDate()+".");return new Date(n_year,n_month-1,n_day);}
function f_tcalGenerDate(d_date){return((d_date.getDate()<10?'0':'')+d_date.getDate()+'.'
+(d_date.getMonth()<9?'0':'')+(d_date.getMonth()+1)+"."
+d_date.getFullYear());}
function tcal(a_cfg,a_tpl,date){i=a_tpl.imgpath;a_tpl=A_TCALDEF;a_tpl.imgpath=i;if(!window.A_TCALS)
window.A_TCALS=[];if(!window.A_TCALSIDX)
window.A_TCALSIDX=[];this.s_id=a_cfg.id?a_cfg.id:A_TCALS.length;window.A_TCALS[this.s_id]=this;window.A_TCALSIDX[window.A_TCALSIDX.length]=this;this.f_show=f_tcalShow;this.f_hide=f_tcalHide;this.f_toggle=f_tcalToggle;this.f_update=f_tcalUpdate;this.f_relDate=f_tcalRelDate;this.f_parseDate=f_tcalParseDate;this.f_generDate=f_tcalGenerDate;this.s_iconId='tcalico_'+this.s_id;this.e_icon=f_getElement(this.s_iconId);if(!this.e_icon){document.write('<img src="'+a_tpl.imgpath+'cal.gif" id="'+this.s_iconId+'" onclick="A_TCALS[\''+this.s_id+'\'].f_toggle()" class="tcalIcon" alt="Open Calendar" />');this.e_icon=f_getElement(this.s_iconId);}
this.a_cfg=a_cfg;this.a_tpl=a_tpl;this.startDate=date;if(this.a_cfg.formname){var e_form=document.forms[this.a_cfg.formname];if(!e_form)
throw("TC: form '"+this.a_cfg.formname+"' can not be found");this.e_input=e_form.elements[this.a_cfg.controlname];}
else
this.e_input=f_getElement(this.a_cfg.controlname);var _this=this;}
function f_tcalShow(d_date){if(!this.a_cfg.controlname)
throw("TC: control name is not specified");if(this.a_cfg.formname){var e_form=document.forms[this.a_cfg.formname];if(!e_form)
throw("TC: form '"+this.a_cfg.formname+"' can not be found");this.e_input=e_form.elements[this.a_cfg.controlname];}
else
this.e_input=f_getElement(this.a_cfg.controlname);this.e_input.focus();if(!this.e_input||!this.e_input.tagName||this.e_input.tagName!='INPUT')
throw("TC: element '"+this.a_cfg.controlname+"' does not exist in "
+(this.a_cfg.formname?"form '"+this.a_cfg.controlname+"'":'this document'));this.e_div=f_getElement('tcal');if(!this.e_div){this.e_div=document.createElement("DIV");this.e_div.id='tcal';document.body.appendChild(this.e_div);}
this.e_div.style.zIndex=100001;this.e_shade=f_getElement('tcalShade');if(!this.e_shade){this.e_shade=document.createElement("DIV");this.e_shade.id='tcalShade';document.body.appendChild(this.e_shade);}
this.e_iframe=f_getElement('tcalIF')
if(b_ieFix&&!this.e_iframe){this.e_iframe=document.createElement("IFRAME");this.e_iframe.style.filter='alpha(opacity=0)';this.e_iframe.id='tcalIF';this.e_iframe.src=this.a_tpl.imgpath+'pixel.gif';document.body.appendChild(this.e_iframe);}
f_tcalHideAll();this.e_icon=f_getElement(this.s_iconId);if(!this.f_update())
return;this.e_div.style.visibility='visible';this.e_shade.style.visibility='visible';if(this.e_iframe)
this.e_iframe.style.visibility='visible';this.e_icon.src=this.a_tpl.imgpath+'no_cal.gif';this.e_icon.title='Close Calendar';this.b_visible=true;}
function f_tcalHide(n_date){if(n_date)
this.e_input.value=this.f_generDate(new Date(n_date));if(!this.b_visible)
return;if(this.e_iframe)
this.e_iframe.style.visibility='hidden';if(this.e_shade)
this.e_shade.style.visibility='hidden';this.e_div.style.visibility='hidden';this.e_icon=f_getElement(this.s_iconId);this.e_icon.src=this.a_tpl.imgpath+'cal.gif';this.e_icon.title='Open Calendar';this.b_visible=false;}
function f_tcalToggle(){return this.b_visible?this.f_hide():this.f_show();}
function f_tcalUpdate(d_date){var d_today=this.a_cfg.today?this.f_parseDate(this.a_cfg.today):f_tcalResetTime(new Date());var d_selected=this.e_input.value==''?(this.a_cfg.selected?this.f_parseDate(this.a_cfg.selected):d_today):this.f_parseDate(this.e_input.value);if(!d_date)
d_date=d_selected;else if(typeof(d_date)=='number')
d_date=f_tcalResetTime(new Date(d_date));else if(typeof(d_date)=='string')
this.f_parseDate(d_date);if(!d_date)return false;var d_firstday=new Date(d_date);d_firstday.setDate(1);d_firstday.setDate(1-(7+d_firstday.getDay()-this.a_tpl.weekstart)%7);var a_class,s_html='<table class="ctrl"><tbody><tr>'
+(this.a_tpl.yearscroll?'<td'+this.f_relDate(d_date,-1,'y')+' title="Previous Year"><img src="'+this.a_tpl.imgpath+'prev_year.gif" /></td>':'')
+'<td'+this.f_relDate(d_date,-1)+' title="Previous Month"><img src="'+this.a_tpl.imgpath+'prev_mon.gif" /></td><th>'
+this.a_tpl.months[d_date.getMonth()]+' '+d_date.getFullYear()
+'</th><td'+this.f_relDate(d_date,1)+' title="Next Month"><img src="'+this.a_tpl.imgpath+'next_mon.gif" /></td>'
+(this.a_tpl.yearscroll?'<td'+this.f_relDate(d_date,1,'y')+' title="Next Year"><img src="'+this.a_tpl.imgpath+'next_year.gif" /></td></td>':'')
+'</tr></tbody></table><table><tbody><tr class="wd">';for(var i=0;i<7;i++)
s_html+='<th>'+this.a_tpl.weekdays[(this.a_tpl.weekstart+i)%7]+'</th>';s_html+='</tr>';var n_date,n_month,d_current=new Date(d_firstday);while(d_current.getMonth()==d_date.getMonth()||d_current.getMonth()==d_firstday.getMonth()){s_html+='<tr>';for(var n_wday=0;n_wday<7;n_wday++){a_class=[];n_date=d_current.getDate();n_month=d_current.getMonth();if(d_current<this.startDate){s_html+='<td style="color:#ddd;">'+n_date+'</td>'}else{if(d_current.getMonth()!=d_date.getMonth())
a_class[a_class.length]='othermonth';if(d_current.getDay()==0||d_current.getDay()==6)
a_class[a_class.length]='weekend';if(d_current.valueOf()==d_today.valueOf())
a_class[a_class.length]='today';if(d_current.valueOf()==d_selected.valueOf())
a_class[a_class.length]='selected';s_html+='<td onclick="A_TCALS[\''+this.s_id+'\'].f_hide('+d_current.valueOf()+')"'+(a_class.length?' class="'+a_class.join(' ')+'">':'>')+n_date+'</td>'}
d_current.setDate(++n_date);while(d_current.getDate()!=n_date&&d_current.getMonth()==n_month){d_current.setHours(d_current.getHours+1);d_current=f_tcalResetTime(d_current);}}
s_html+='</tr>';}
s_html+='</tbody></table>';this.e_div.innerHTML=s_html;var n_width=this.e_div.offsetWidth;var n_height=this.e_div.offsetHeight;var n_top=f_getPosition(this.e_icon,'Top')+this.e_icon.offsetHeight;var n_left=f_getPosition(this.e_icon,'Left')-n_width+this.e_icon.offsetWidth;if(n_left<0)n_left=0;this.e_div.style.left=n_left+'px';this.e_div.style.top=n_top+'px';this.e_shade.style.width=(n_width+8)+'px';this.e_shade.style.left=(n_left-1)+'px';this.e_shade.style.top=(n_top-1)+'px';this.e_shade.innerHTML=b_ieFix?'<table><tbody><tr><td rowspan="2" colspan="2" width="6"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td width="7" height="7" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_tr.png\', sizingMethod=\'scale\');"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td height="'+(n_height-7)+'" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_mr.png\', sizingMethod=\'scale\');"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td width="7" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_bl.png\', sizingMethod=\'scale\');"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_bm.png\', sizingMethod=\'scale\');" height="7" align="left"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\''+this.a_tpl.imgpath+'shade_br.png\', sizingMethod=\'scale\');"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td></tr><tbody></table>':'<table><tbody><tr><td rowspan="2" width="6"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td rowspan="2"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td width="7" height="7"><img src="'+this.a_tpl.imgpath+'shade_tr.png"></td></tr><tr><td background="'+this.a_tpl.imgpath+'shade_mr.png" height="'+(n_height-7)+'"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td></tr><tr><td><img src="'+this.a_tpl.imgpath+'shade_bl.png"></td><td background="'+this.a_tpl.imgpath+'shade_bm.png" height="7" align="left"><img src="'+this.a_tpl.imgpath+'pixel.gif"></td><td><img src="'+this.a_tpl.imgpath+'shade_br.png"></td></tr><tbody></table>';if(this.e_iframe){this.e_iframe.style.left=n_left+'px';this.e_iframe.style.top=n_top+'px';this.e_iframe.style.width=(n_width+6)+'px';this.e_iframe.style.height=(n_height+6)+'px';}
return true;}
function f_getPosition(e_elemRef,s_coord){var n_pos=0,n_offset,e_elem=e_elemRef;while(e_elem){n_offset=e_elem["offset"+s_coord];n_pos+=n_offset;e_elem=e_elem.offsetParent;}
if(b_ieMac)
n_pos+=parseInt(document.body[s_coord.toLowerCase()+'Margin']);else if(b_safari)
n_pos-=n_offset;e_elem=e_elemRef;while(e_elem!=document.body){n_offset=e_elem["scroll"+s_coord];if(n_offset&&e_elem.style.overflow=='scroll')
n_pos-=n_offset;e_elem=e_elem.parentNode;}
return n_pos;}
function f_tcalRelDate(d_date,d_diff,s_units){var s_units=(s_units=='y'?'FullYear':'Month');var d_result=new Date(d_date);d_result['set'+s_units](d_date['get'+s_units]()+d_diff);if(d_result.getDate()!=d_date.getDate())
d_result.setDate(0);return' onclick="A_TCALS[\''+this.s_id+'\'].f_update('+d_result.valueOf()+')"';}
function f_tcalHideAll(){if(typeof window.A_TCALSIDX=='undefined')return;for(var i=0;i<window.A_TCALSIDX.length;i++)
window.A_TCALSIDX[i].f_hide();}
function f_tcalResetTime(d_date){d_date.setHours(0);d_date.setMinutes(0);d_date.setSeconds(0);d_date.setMilliseconds(0);return d_date;}
f_getElement=document.all?function(s_id){return document.all[s_id]}:function(s_id){return document.getElementById(s_id)};if(document.addEventListener)
window.addEventListener('scroll',f_tcalHideAll,false);if(window.attachEvent)
window.attachEvent('onscroll',f_tcalHideAll);var s_userAgent=navigator.userAgent.toLowerCase(),re_webkit=/WebKit\/(\d+)/i;var b_mac=s_userAgent.indexOf('mac')!=-1,b_ie5=s_userAgent.indexOf('msie 5')!=-1,b_ie6=s_userAgent.indexOf('msie 6')!=-1&&s_userAgent.indexOf('opera')==-1;var b_ieFix=b_ie5||b_ie6,b_ieMac=b_mac&&b_ie5,b_safari=b_mac&&re_webkit.exec(s_userAgent)&&Number(RegExp.$1)<500;if(!Control)var Control={};Control.Slider=Class.create({initialize:function(handle,track,options){var slider=this;if(Object.isArray(handle)){this.handles=handle.collect(function(e){return $(e)});}else{this.handles=[$(handle)];}
this.track=$(track);this.options=options||{};this.axis=this.options.axis||'horizontal';this.increment=this.options.increment||1;this.step=parseInt(this.options.step||'1');this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(s){return $(s)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||'0');this.alignY=parseInt(this.options.alignY||'0');this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled)this.setDisabled();this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max();}
this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((Object.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);h.makePositioned().observe("mousedown",slider.eventMouseDown);});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true;},dispose:function(){var slider=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(h){Event.stopObserving(h,"mousedown",slider.eventMouseDown);});},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(value){if(this.allowedValues){if(value>=this.allowedValues.max())return(this.allowedValues.max());if(value<=this.allowedValues.min())return(this.allowedValues.min());var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];this.allowedValues.each(function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset;}});return newValue;}
if(value>this.range.end)return this.range.end;if(value<this.range.start)return this.range.start;return value;},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1]))
sliderValue=this.values[handleIdx-1];if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1]))
sliderValue=this.values[handleIdx+1];}
sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?'top':'left']=this.translateToPx(sliderValue);this.drawSpans();if(!this.dragging||!this.event)this.updateFinished();},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0);},translateToPx:function(value){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px";},translateToValue:function(offset){return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(range){var v=this.values.sortBy(Prototype.K);range=range||0;return $R(v[range],v[range+1]);},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=='vertical');},drawSpans:function(){var slider=this;if(this.spans)
$R(0,this.spans.length-1).each(function(r){slider.setSpan(slider.spans[r],slider.getRange(r))});if(this.options.startSpan)
this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));if(this.options.endSpan)
this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum));},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start);span.style.height=this.translateToPx(range.end-range.start+this.range.start);}else{span.style.left=this.translateToPx(range.start);span.style.width=this.translateToPx(range.end-range.start+this.range.start);}},updateStyles:function(){this.handles.each(function(h){Element.removeClassName(h,'selected')});Element.addClassName(this.activeHandle,'selected');},startDrag:function(event){if(Event.isLeftClick(event)){if(!this.disabled){this.active=true;var handle=Event.element(event);var pointer=[Event.pointerX(event),Event.pointerY(event)];var track=handle;if(track==this.track){var offsets=this.track.cumulativeOffset();this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-offsets[1]:pointer[0]-offsets[0])-(this.handleLength/2)));var offsets=this.activeHandle.cumulativeOffset();this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}else{while((this.handles.indexOf(handle)==-1)&&handle.parentNode)
handle=handle.parentNode;if(this.handles.indexOf(handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var offsets=this.activeHandle.cumulativeOffset();this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}}}
Event.stop(event);}},update:function(event){if(this.active){if(!this.dragging)this.dragging=true;this.draw(event);if(Prototype.Browser.WebKit)window.scrollBy(0,0);Event.stop(event);}},draw:function(event){var pointer=[Event.pointerX(event),Event.pointerY(event)];var offsets=this.track.cumulativeOffset();pointer[0]-=this.offsetX+offsets[0];pointer[1]-=this.offsetY+offsets[1];this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide)
this.options.onSlide(this.values.length>1?this.values:this.value,this);},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);Event.stop(event);}
this.active=false;this.dragging=false;},finishDrag:function(event,success){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange)
this.options.onChange(this.values.length>1?this.values:this.value,this);this.event=null;}});function setCookie(name,value,expires,path,domain,secure){document.cookie=name+"="+escape(value)+
((expires)?"; expires="+expires:"")+
((path)?"; path="+path:"")+
((domain)?"; domain="+domain:"")+
((secure)?"; secure":"");}
function getCookie(name){var cookie=" "+document.cookie;var search=" "+name+"=";var setStr=null;var offset=0;var end=0;if(cookie.length>0){offset=cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=cookie.indexOf(";",offset)
if(end==-1){end=cookie.length;}
setStr=unescape(cookie.substring(offset,end));}}
return(setStr);}
if(Object.isUndefined(Effect))
throw("dragdrop.js requires including script.aculo.us' effects.js library");var Droppables={drops:[],remove:function(element){this.drops=this.drops.reject(function(d){return d.element==$(element)});},add:function(element){element=$(element);var options=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(options.containment){options._containers=[];var containment=options.containment;if(Object.isArray(containment)){containment.each(function(c){options._containers.push($(c))});}else{options._containers.push($(containment));}}
if(options.accept)options.accept=[options.accept].flatten();Element.makePositioned(element);options.element=element;this.drops.push(options);},findDeepestChild:function(drops){deepest=drops[0];for(i=1;i<drops.length;++i)
if(Element.isParent(drops[i].element,deepest.element))
deepest=drops[i];return deepest;},isContained:function(element,drop){var containmentNode;if(drop.tree){containmentNode=element.treeNode;}else{containmentNode=element.parentNode;}
return drop._containers.detect(function(c){return containmentNode==c});},isAffected:function(point,element,drop){return((drop.element!=element)&&((!drop._containers)||this.isContained(element,drop))&&((!drop.accept)||(Element.classNames(element).detect(function(v){return drop.accept.include(v)})))&&Position.within(drop.element,point[0],point[1]));},deactivate:function(drop){if(drop.hoverclass)
Element.removeClassName(drop.element,drop.hoverclass);this.last_active=null;},activate:function(drop){if(drop.hoverclass)
Element.addClassName(drop.element,drop.hoverclass);this.last_active=drop;},show:function(point,element){if(!this.drops.length)return;var drop,affected=[];this.drops.each(function(drop){if(Droppables.isAffected(point,element,drop))
affected.push(drop);});if(affected.length>0)
drop=Droppables.findDeepestChild(affected);if(this.last_active&&this.last_active!=drop)this.deactivate(this.last_active);if(drop){Position.within(drop.element,point[0],point[1]);if(drop.onHover)
drop.onHover(element,drop.element,Position.overlap(drop.overlap,drop.element));if(drop!=this.last_active)Droppables.activate(drop);}},fire:function(event,element){if(!this.last_active)return;Position.prepare();if(this.isAffected([Event.pointerX(event),Event.pointerY(event)],element,this.last_active))
if(this.last_active.onDrop){this.last_active.onDrop(element,this.last_active.element,event);return true;}},reset:function(){if(this.last_active)
this.deactivate(this.last_active);}}
var Draggables={drags:[],observers:[],register:function(draggable){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}
this.drags.push(draggable);},unregister:function(draggable){this.drags=this.drags.reject(function(d){return d==draggable});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(draggable){if(draggable.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=draggable;}.bind(this),draggable.options.delay);}else{window.focus();this.activeDraggable=draggable;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(event){if(!this.activeDraggable)return;var pointer=[Event.pointerX(event),Event.pointerY(event)];if(this._lastPointer&&(this._lastPointer.inspect()==pointer.inspect()))return;this._lastPointer=pointer;this.activeDraggable.updateDrag(event,pointer);},endDrag:function(event){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}
if(!this.activeDraggable)return;this._lastPointer=null;this.activeDraggable.endDrag(event);this.activeDraggable=null;},keyPress:function(event){if(this.activeDraggable)
this.activeDraggable.keyPress(event);},addObserver:function(observer){this.observers.push(observer);this._cacheObserverCallbacks();},removeObserver:function(element){this.observers=this.observers.reject(function(o){return o.element==element});this._cacheObserverCallbacks();},notify:function(eventName,draggable,event){if(this[eventName+'Count']>0)
this.observers.each(function(o){if(o[eventName])o[eventName](eventName,draggable,event);});if(draggable.options[eventName])draggable.options[eventName](draggable,event);},_cacheObserverCallbacks:function(){['onStart','onEnd','onDrag'].each(function(eventName){Draggables[eventName+'Count']=Draggables.observers.select(function(o){return o[eventName];}).length;});}}
var Draggable=Class.create({initialize:function(element){var defaults={handle:false,reverteffect:function(element,top_offset,left_offset){var dur=Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;new Effect.Move(element,{x:-left_offset,y:-top_offset,duration:dur,queue:{scope:'_draggable',position:'end'}});},endeffect:function(element){var toOpacity=Object.isNumber(element._opacity)?element._opacity:1.0;new Effect.Opacity(element,{duration:0.2,from:0.7,to:toOpacity,queue:{scope:'_draggable',position:'end'},afterFinish:function(){Draggable._dragging[element]=false}});},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect))
Object.extend(defaults,{starteffect:function(element){element._opacity=Element.getOpacity(element);Draggable._dragging[element]=true;new Effect.Opacity(element,{duration:0.2,from:element._opacity,to:0.7});}});var options=Object.extend(defaults,arguments[1]||{});this.element=$(element);if(options.handle&&Object.isString(options.handle))
this.handle=this.element.down('.'+options.handle,0);if(options.handle.length==2){if(options.scroll&&!options.scroll.scrollTo&&!options.scroll.outerHTML){options.scroll=$(options.scroll);this._isScrollChild=Element.childOf(this.element,options.scroll);}
Element.makePositioned(this.element);this.options=options;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);var _this=this;options.handle.each(function(h){Event.observe(h,"mousedown",_this.eventMouseDown);});Draggables.register(this);}else{if(!this.handle){this.handle=$(options.handle[0]);}
if(!this.handle)this.handle=this.element;if(options.scroll&&!options.scroll.scrollTo&&!options.scroll.outerHTML){options.scroll=$(options.scroll);this._isScrollChild=Element.childOf(this.element,options.scroll);}
Element.makePositioned(this.element);this.options=options;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);}},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return([parseInt(Element.getStyle(this.element,'left')||'0'),parseInt(Element.getStyle(this.element,'top')||'0')]);},initDrag:function(event){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element])return;if(Event.isLeftClick(event)){var src=Event.element(event);if((tag_name=src.tagName.toUpperCase())&&(tag_name=='INPUT'||tag_name=='SELECT'||tag_name=='OPTION'||tag_name=='BUTTON'||tag_name=='TEXTAREA'))return;var pointer=[Event.pointerX(event),Event.pointerY(event)];var pos=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(i){return(pointer[i]-pos[i])});Draggables.activate(this);Event.stop(event);}},startDrag:function(event){this.dragging=true;if(!this.delta)
this.delta=this.currentDelta();if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,'z-index')||0);this.element.style.zIndex=this.options.zindex;}
if(this.options.ghosting){this._clone=this.element.cloneNode(true);this.element._originallyAbsolute=(this.element.getStyle('position')=='absolute');if(!this.element._originallyAbsolute)
Position.absolutize(this.element);this.element.parentNode.insertBefore(this._clone,this.element);}
if(this.options.scroll){if(this.options.scroll==window){var where=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=where.left;this.originalScrollTop=where.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}
Draggables.notify('onStart',this,event);if(this.options.starteffect)this.options.starteffect(this.element);},updateDrag:function(event,pointer){if(!this.dragging)this.startDrag(event);if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element);}
Draggables.notify('onDrag',this,event);this.draw(pointer);if(this.options.change)this.options.change(this);if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=Position.page(this.options.scroll);p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]);p.push(p[1]+this.options.scroll.offsetHeight);}
var speed=[0,0];if(pointer[1]<(p[1]+this.options.scrollSensitivity))speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity);if(pointer[1]>(p[3]-this.options.scrollSensitivity))speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity);this.startScrolling(speed);}
if(Prototype.Browser.WebKit)window.scrollBy(0,0);Event.stop(event);},finishDrag:function(event,success){this.dragging=false;if(this.options.quiet){Position.prepare();var pointer=[Event.pointerX(event),Event.pointerY(event)];Droppables.show(pointer,this.element);}
if(this.options.ghosting){if(!this.element._originallyAbsolute)
Position.relativize(this.element);delete this.element._originallyAbsolute;Element.remove(this._clone);this._clone=null;}
var dropped=false;if(success){dropped=Droppables.fire(event,this.element);if(!dropped)dropped=false;}
if(dropped&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify('onEnd',this,event);var revert=this.options.revert;if(revert&&Object.isFunction(revert))revert=revert(this.element);var d=this.currentDelta();if(revert&&this.options.reverteffect){if(dropped==0||revert!='failure')
this.options.reverteffect(this.element,d[1]-this.delta[1],d[0]-this.delta[0]);}else{this.delta=d;}
if(this.options.zindex)
this.element.style.zIndex=this.originalZ;if(this.options.endeffect)
this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset();},keyPress:function(event){if(event.keyCode!=Event.KEY_ESC)return;this.finishDrag(event,false);Event.stop(event);},endDrag:function(event){if(!this.dragging)return;this.stopScrolling();this.finishDrag(event,true);Event.stop(event);},draw:function(point){var pos=Position.cumulativeOffset(this.element);if(this.options.ghosting){var r=Position.realOffset(this.element);pos[0]+=r[0]-Position.deltaX;pos[1]+=r[1]-Position.deltaY;}
var d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){pos[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;pos[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}
var p=[0,1].map(function(i){return(point[i]-pos[i]-this.offset[i])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){p=this.options.snap(p[0],p[1],this);}else{if(Object.isArray(this.options.snap)){p=p.map(function(v,i){return(v/this.options.snap[i]).round()*this.options.snap[i]}.bind(this))}else{p=p.map(function(v){return(v/this.options.snap).round()*this.options.snap}.bind(this))}}}
var style=this.element.style;if((!this.options.constraint)||(this.options.constraint=='horizontal'))
style.left=p[0]+"px";if((!this.options.constraint)||(this.options.constraint=='vertical'))
style.top=p[1]+"px";if(style.visibility=="hidden")style.visibility="";},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(speed){if(!(speed[0]||speed[1]))return;this.scrollSpeed=[speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000;}
Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify('onDrag',this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0)
Draggables._lastScrollPointer[0]=0;if(Draggables._lastScrollPointer[1]<0)
Draggables._lastScrollPointer[1]=0;this.draw(Draggables._lastScrollPointer);}
if(this.options.change)this.options.change(this);},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}
if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight}}
return{top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(element,observer){this.element=$(element);this.observer=observer;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element))
this.observer(this.element)}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_-](.*)$/,sortables:{},_findRootElement:function(element){while(element.tagName.toUpperCase()!="BODY"){if(element.id&&Sortable.sortables[element.id])return element;element=element.parentNode;}},options:function(element){element=Sortable._findRootElement($(element));if(!element)return;return Sortable.sortables[element.id];},destroy:function(element){var s=Sortable.options(element);if(s){Draggables.removeObserver(s.element);s.droppables.each(function(d){Droppables.remove(d)});s.draggables.invoke('destroy');delete Sortable.sortables[s.element.id];}},create:function(element){element=$(element);var options=Object.extend({element:element,tag:'li',dropOnEmpty:false,tree:false,treeTag:'ul',overlap:'vertical',constraint:'vertical',containment:element,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(element);var options_for_draggable={revert:true,quiet:options.quiet,scroll:options.scroll,scrollSpeed:options.scrollSpeed,scrollSensitivity:options.scrollSensitivity,delay:options.delay,ghosting:options.ghosting,constraint:options.constraint,handle:options.handle};if(options.starteffect)
options_for_draggable.starteffect=options.starteffect;if(options.reverteffect)
options_for_draggable.reverteffect=options.reverteffect;else
if(options.ghosting)options_for_draggable.reverteffect=function(element){element.style.top=0;element.style.left=0;};if(options.endeffect)
options_for_draggable.endeffect=options.endeffect;if(options.zindex)
options_for_draggable.zindex=options.zindex;var options_for_droppable={overlap:options.overlap,containment:options.containment,tree:options.tree,hoverclass:options.hoverclass,onHover:Sortable.onHover}
var options_for_tree={onHover:Sortable.onEmptyHover,overlap:options.overlap,containment:options.containment,hoverclass:options.hoverclass}
Element.cleanWhitespace(element);options.draggables=[];options.droppables=[];if(options.dropOnEmpty||options.tree){Droppables.add(element,options_for_tree);options.droppables.push(element);}
(options.elements||this.findElements(element,options)||[]).each(function(e,i){var handle=options.handles?$(options.handles[i]):(options.handle?$(e).select('.'+options.handle):e);options.draggables.push(new Draggable(e,Object.extend(options_for_draggable,{handle:handle})));Droppables.add(e,options_for_droppable);if(options.tree)e.treeNode=element;options.droppables.push(e);});if(options.tree){(Sortable.findTreeElements(element,options)||[]).each(function(e){Droppables.add(e,options_for_tree);e.treeNode=element;options.droppables.push(e);});}
this.sortables[element.id]=options;Draggables.addObserver(new SortableObserver(element,options.onUpdate));},findElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.tag);},findTreeElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.treeTag);},onHover:function(element,dropon,overlap){if(Element.isParent(dropon,element))return;if(overlap>.33&&overlap<.66&&Sortable.options(dropon).tree){return;}else if(overlap>0.5){Sortable.mark(dropon,'before');if(dropon.previousSibling!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,dropon);if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}else{Sortable.mark(dropon,'after');var nextElement=dropon.nextSibling||null;if(nextElement!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,nextElement);if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}},onEmptyHover:function(element,dropon,overlap){var oldParentNode=element.parentNode;var droponOptions=Sortable.options(dropon);if(!Element.isParent(dropon,element)){var index;var children=Sortable.findElements(dropon,{tag:droponOptions.tag,only:droponOptions.only});var child=null;if(children){var offset=Element.offsetSize(dropon,droponOptions.overlap)*(1.0-overlap);for(index=0;index<children.length;index+=1){if(offset-Element.offsetSize(children[index],droponOptions.overlap)>=0){offset-=Element.offsetSize(children[index],droponOptions.overlap);}else if(offset-(Element.offsetSize(children[index],droponOptions.overlap)/2)>=0){child=index+1<children.length?children[index+1]:null;break;}else{child=children[index];break;}}}
dropon.insertBefore(element,child);Sortable.options(oldParentNode).onChange(element);droponOptions.onChange(element);}},unmark:function(){if(Sortable._marker)Sortable._marker.hide();},mark:function(dropon,position){var sortable=Sortable.options(dropon.parentNode);if(sortable&&!sortable.ghosting)return;if(!Sortable._marker){Sortable._marker=($('dropmarker')||Element.extend(document.createElement('DIV'))).hide().addClassName('dropmarker').setStyle({position:'absolute'});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}
var offsets=Position.cumulativeOffset(dropon);Sortable._marker.setStyle({left:offsets[0]+'px',top:offsets[1]+'px'});if(position=='after')
if(sortable.overlap=='horizontal')
Sortable._marker.setStyle({left:(offsets[0]+dropon.clientWidth)+'px'});else
Sortable._marker.setStyle({top:(offsets[1]+dropon.clientHeight)+'px'});Sortable._marker.show();},_tree:function(element,options,parent){var children=Sortable.findElements(element,options)||[];for(var i=0;i<children.length;++i){var match=children[i].id.match(options.format);if(!match)continue;var child={id:encodeURIComponent(match?match[1]:null),element:element,parent:parent,children:[],position:parent.children.length,container:$(children[i]).down(options.treeTag)}
if(child.container)
this._tree(child.container,options,child)
parent.children.push(child);}
return parent;},tree:function(element){element=$(element);var sortableOptions=this.options(element);var options=Object.extend({tag:sortableOptions.tag,treeTag:sortableOptions.treeTag,only:sortableOptions.only,name:element.id,format:sortableOptions.format},arguments[1]||{});var root={id:null,parent:null,children:[],container:element,position:0}
return Sortable._tree(element,options,root);},_constructIndex:function(node){var index='';do{if(node.id)index='['+node.position+']'+index;}while((node=node.parent)!=null);return index;},sequence:function(element){element=$(element);var options=Object.extend(this.options(element),arguments[1]||{});return $(this.findElements(element,options)||[]).map(function(item){return item.id.match(options.format)?item.id.match(options.format)[1]:'';});},setSequence:function(element,new_sequence){element=$(element);var options=Object.extend(this.options(element),arguments[2]||{});var nodeMap={};this.findElements(element,options).each(function(n){if(n.id.match(options.format))
nodeMap[n.id.match(options.format)[1]]=[n,n.parentNode];n.parentNode.removeChild(n);});new_sequence.each(function(ident){var n=nodeMap[ident];if(n){n[1].appendChild(n[0]);delete nodeMap[ident];}});},serialize:function(element){element=$(element);var options=Object.extend(Sortable.options(element),arguments[1]||{});var name=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:element.id);if(options.tree){return Sortable.tree(element,arguments[1]).children.map(function(item){return[name+Sortable._constructIndex(item)+"[id]="+
encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));}).flatten().join('&');}else{return Sortable.sequence(element,arguments[1]).map(function(item){return name+"[]="+encodeURIComponent(item);}).join('&');}}}
Element.isParent=function(child,element){if(!child.parentNode||child==element)return false;if(child.parentNode==element)return true;return Element.isParent(child.parentNode,element);}
Element.findChildren=function(element,only,recursive,tagName){if(!element.hasChildNodes())return null;tagName=tagName.toUpperCase();if(only)only=[only].flatten();var elements=[];$A(element.childNodes).each(function(e){Element.extend(e);if(e.hasAttribute('locked'))return;if(e.tagName&&e.tagName.toUpperCase()==tagName&&(!only||(Element.classNames(e).detect(function(v){return only.include(v)}))))
elements.push(e);if(recursive){var grandchildren=Element.findChildren(e,only,recursive,tagName);if(grandchildren)elements.push(grandchildren);}});return(elements.length>0?elements.flatten():[]);}
Element.offsetSize=function(element,type){return element['offset'+((type=='vertical'||type=='height')?'Height':'Width')];}
String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+0.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+0.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+0.5;},pulse:function(pos,pulses){pulses=pulses||5;return(((pos%(1/pulses))*pulses).round()==0?((pos*pulses*2)-(pos*pulses*2).floor()):1-((pos*pulses*2)-(pos*pulses*2).floor()));},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect){element=$(element);effect=(effect||'appear').toLowerCase();var options=Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},arguments[2]||{});Effect[element.visible()?Effect.PAIRS[effect][1]:Effect.PAIRS[effect][0]](element,options);}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+'Internal']?'this.options.'+eventName+'Internal(this);':'')+
(options[eventName]?'this.options.'+eventName+'(this);':''));}
if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ '+'if (this.state=="idle"){this.state="running";'+
codeForEvent(this.options,'beforeSetup')+
(this.setup?'this.setup();':'')+
codeForEvent(this.options,'afterSetup')+'};if (this.state=="running"){'+'pos=this.options.transition(pos)*'+this.fromToDelta+'+'+this.options.from+';'+'this.position=pos;'+
codeForEvent(this.options,'beforeUpdate')+
(this.update?'this.update(pos);':'')+
codeForEvent(this.options,'afterUpdate')+'}}');this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset(),max=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1]>max?max:elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round())});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element)},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}})}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}})}})}})}})}})}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options))}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{};var oldOpacity=element.getInlineOpacity();var transition=options.transition||Effect.Transitions.sinoidal;var reverser=function(pos){return transition(1-Effect.Transitions.pulse(pos,options.pulses))};reverser.bind(transition);return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});}}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16)});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))))});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};};Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element)
var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;}});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);if(typeof(Xaprb)==='undefined'){Xaprb=new Object();}
Xaprb.InputMask={masks:{date_iso:{format:'    -  -  ',regex:/\d/},date_us:{format:'  .  .    ',regex:/\d/},time:{format:'  :  :  ',regex:/\d/},phone:{format:'(   )   -    ',regex:/\d/},ssn:{format:'   -  -    ',regex:/\d/},number:{format:'        ',regex:/\d/}},setupElementMasks:function(){$$('.input_mask').each(function(item){Event.observe(item,'keypress',Xaprb.InputMask.applyMask.bindAsEventListener(item),true);});},applyMask:function(event){var match=/mask_(\w+)/.exec(this.className);if(match.length==2&&Xaprb.InputMask.masks[match[1]]){var mask=Xaprb.InputMask.masks[match[1]];var key=Xaprb.InputMask.getKey(event);if(Xaprb.InputMask.isPrintable(key)){var ch=String.fromCharCode(key);var str=this.value+ch;var pos=str.length;if(mask.regex.test(ch)&&pos<=mask.format.length){if(mask.format.charAt(pos-1)!=' '){str=this.value+mask.format.charAt(pos-1)+ch;}
this.value=str;}
Event.stop(event);}}},isPrintable:function(key){return(key>=32&&key<127);},getKey:function(e){return window.event?window.event.keyCode:e?e.which:0;}};var Lightbox=Class.create({closed:false,open:function(){this.closed=false;this._centerWindow(this.container);this._fade('open',this.container);},close:function(){if(this.closed)return;this.closed=true;this._fade('close',this.container);},_fade:function fadeBg(userAction,whichDiv){if(userAction=='close'){new Effect.Opacity('bg_fade',{duration:.5,from:0.8,to:0,afterFinish:this._makeInvisible.bindAsEventListener(this),afterUpdate:this._hideLayer(whichDiv)});}else{new Effect.Opacity('bg_fade',{duration:.5,from:0,to:0.8,beforeUpdate:this._makeVisible,afterFinish:this._showLayer(whichDiv)});}},_makeVisible:function makeVisible(){$("bg_fade").style.visibility="visible";var height=$$('.pageLayout')[0].getHeight();height=Math.max(height,document.viewport.getHeight());$("bg_fade").style.height=(height-40)+'px';},_makeInvisible:function makeInvisible(){$("bg_fade").style.visibility="hidden";$(this.container).update();if(typeof Tables!='undefined'){for(var el in Tables){Tables[el].fullTable=null;}}},_showLayer:function showLayer(userAction){$(userAction).style.display="block";},_hideLayer:function hideLayer(userAction){$(userAction).style.display="none";},_centerWindow:function centerWindow(element){var windowHeight=parseFloat($(element).getHeight())/2;var windowWidth=parseFloat($(element).getWidth())/2;var height=$$('.pageLayout')[0].getHeight();if(document.viewport.getScrollOffsets().top+80+$(element).getHeight()>height){$(element).style.top=height-$(element).getHeight()-40+'px';}else{$(element).style.top=document.viewport.getScrollOffsets().top+80+'px';}
if(parseInt($(element).style.top)<0){$(element).style.top='0px';}
if(typeof window.innerHeight!='undefined'){$(element).style.left=Math.round(document.body.offsetLeft+((window.innerWidth-$(element).getWidth()))/2)+'px';}else{$(element).style.left=Math.round(document.body.offsetLeft+((document.documentElement.offsetWidth-$(element).getWidth()))/2)+'px';}},keyPress:function(event){var kcode=event.which||event.keyCode;if(kcode==27||kcode==0){this.close();}},initialize:function(containerDiv){this.container=containerDiv;document.observe('keypress',this.keyPress.bindAsEventListener(this));if($('bg_fade')==null){var screen=new Element('div',{'id':'bg_fade'});document.body.appendChild(screen);}
this._hideLayer(this.container);}});if(typeof(Control)=='undefined')
Control={};var $proc=function(proc){return typeof(proc)=='function'?proc:function(){return proc};};var $value=function(value){return typeof(value)=='function'?value():value;};Object.Event={extend:function(object){object._objectEventSetup=function(event_name){this._observers=this._observers||{};this._observers[event_name]=this._observers[event_name]||[];};object.observe=function(event_name,observer){if(typeof(event_name)=='string'&&typeof(observer)!='undefined'){this._objectEventSetup(event_name);if(!this._observers[event_name].include(observer))
this._observers[event_name].push(observer);}else
for(var e in event_name)
this.observe(e,event_name[e]);};object.stopObserving=function(event_name,observer){this._objectEventSetup(event_name);if(event_name&&observer)
this._observers[event_name]=this._observers[event_name].without(observer);else if(event_name)
this._observers[event_name]=[];else
this._observers={};};object.observeOnce=function(event_name,outer_observer){var inner_observer=function(){outer_observer.apply(this,arguments);this.stopObserving(event_name,inner_observer);}.bind(this);this._objectEventSetup(event_name);this._observers[event_name].push(inner_observer);};object.notify=function(event_name){this._objectEventSetup(event_name);var collected_return_values=[];var args=$A(arguments).slice(1);try{for(var i=0;i<this._observers[event_name].length;++i)
collected_return_values.push(this._observers[event_name][i].apply(this._observers[event_name][i],args)||null);}catch(e){if(e==$break)
return false;else
throw e;}
return collected_return_values;};if(object.prototype){object.prototype._objectEventSetup=object._objectEventSetup;object.prototype.observe=object.observe;object.prototype.stopObserving=object.stopObserving;object.prototype.observeOnce=object.observeOnce;object.prototype.notify=function(event_name){if(object.notify){var args=$A(arguments).slice(1);args.unshift(this);args.unshift(event_name);object.notify.apply(object,args);}
this._objectEventSetup(event_name);var args=$A(arguments).slice(1);var collected_return_values=[];try{if(this.options&&this.options[event_name]&&typeof(this.options[event_name])=='function')
collected_return_values.push(this.options[event_name].apply(this,args)||null);for(var i=0;i<this._observers[event_name].length;++i)
collected_return_values.push(this._observers[event_name][i].apply(this._observers[event_name][i],args)||null);}catch(e){if(e==$break)
return false;else
throw e;}
return collected_return_values;};}}};Element.addMethods({observeOnce:function(element,event_name,outer_callback){var inner_callback=function(){outer_callback.apply(this,arguments);Element.stopObserving(element,event_name,inner_callback);};Element.observe(element,event_name,inner_callback);}});(function(){function wheel(event){var delta,element,custom_event;if(event.wheelDelta){delta=event.wheelDelta/120;}else if(event.detail){delta=-event.detail/3;}
if(!delta){return;}
element=Event.extend(event).target;element=Element.extend(element.nodeType===Node.TEXT_NODE?element.parentNode:element);custom_event=element.fire('mouse:wheel',{delta:delta});if(custom_event.stopped){Event.stop(event);return false;}}
document.observe('mousewheel',wheel);document.observe('DOMMouseScroll',wheel);})();var IframeShim=Class.create({initialize:function(){this.element=new Element('iframe',{style:'position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none',src:'javascript:void(0);',frameborder:0});$(document.body).insert(this.element);},hide:function(){this.element.hide();return this;},show:function(){this.element.show();return this;},positionUnder:function(element){var element=$(element);var offset=element.cumulativeOffset();var dimensions=element.getDimensions();this.element.setStyle({left:offset[0]+'px',top:offset[1]+'px',width:dimensions.width+'px',height:dimensions.height+'px',zIndex:element.getStyle('zIndex')-1}).show();return this;},setBounds:function(bounds){for(prop in bounds)
bounds[prop]+='px';this.element.setStyle(bounds);return this;},destroy:function(){if(this.element)
this.element.remove();return this;}});var colors=[];var arr=['CC','33','FF','66','00','99']
arr.each(function(el){arr.each(function(el2){arr.each(function(el3){colors.push('#'+el+el2+el3);})})});colors.sort(function(){return(Math.round(Math.random())-0.5)});function PieChart(){items=[],titles=[],sum=0,labels=[],title=0,div=null,S=15;this.start=90;this.sum=0;this.setValues=function(){items=[];titles=[];labels=[];if(typeof this.setValues.arguments[0]=="object"&&this.setValues.arguments[0].length){items=this.setValues.arguments[0];if(typeof this.setValues.arguments[1]=="object"&&this.setValues.arguments[1].length){titles=this.setValues.arguments[1];}
if(typeof this.setValues.arguments[1]=="string"){titles=eval('["'+this.setValues.arguments[1].replace(/,/g,'","')+'"]');}}else{for(var i=0;i<this.setValues.arguments.length;i++){items[i]=this.setValues.arguments[i]}}
if(!titles.length&&title>1){title=0;}
this.redraw();};this.printTo=function(divid){div=divid;if(!div){return false;}
build(this.start);};this.redraw=function(){if(div){var divs=div.getElementsByTagName("div");while(divs.length){div.removeChild(divs[0]);}
build(this.start);}};this.rotate=function(angle){angle=this.start+angle;angle=angle%360;if(angle<0){angle=360+angle;}
this.start=angle;this.redraw();};this.setTitle=function(newtitle){if(newtitle>2){newtitle=0;}
title=newtitle;if(title>1&&!titles.length){title=0;}
var pc=sum/100;for(var i=0,j=items.length;i<j;i++){switch(title){case 0:labels[i].nodeValue=items[i];break;case 1:labels[i].nodeValue=Math.round(items[i]/pc*10)/10+"%";break;case 2:labels[i].nodeValue=titles[i];break;}}};this.title=function(){this.setTitle(title+1);};var build=function(start){if(!div){return;}
sum=0;for(var i=0;i<items.length;i++){sum+=parseInt(items[i]);}
var pc=sum/100;var alpha=2*Math.PI/sum,Q=1,q=1,angle=0,whole=start*Math.PI/180,sigma=0.01,Z=10;for(var i=0;i<items.length;i++){var labeldiv=document.createElement("div");var labelspan=document.createElement("span");var labeltext='';labels[i]=document.createTextNode(labeltext);labelspan.appendChild(labels[i]);labeldiv.appendChild(labelspan);labeldiv.className="pie-label";var labelangle=(whole+alpha*items[i]/2)%(Math.PI*2);if(!isNaN(labelangle)){labeldiv.style.top=(labelangle>Math.PI?1:-1)*(S/3*2*Math.abs(Math.sin(labelangle)))+"em";labeldiv.style.left=(labelangle<Math.PI/2||labelangle>Math.PI/2*3?1:-1)*(S/3*2*Math.abs(Math.cos(labelangle)))+"em";}
div.appendChild(labeldiv);if(items[i]==0){labeldiv.style.display="none";}
var sector=document.createElement("div");whole+=alpha*items[i];angle=whole-Math.PI/2*(Q-1);while(angle>Math.PI/2+sigma){var bg=document.createElement("div");bg.className="bg sector-"+q;bg.style.backgroundColor=colors[i%colors.length];bg.style.zIndex=Z--;div.appendChild(bg);Q++;Z=10*Q;if(Q>4){q=Q-4;}else{q=Q;}
angle=whole-Math.PI/2*(Q-1);}
if(Math.abs(Math.PI/2-angle)<=sigma){var bg=document.createElement("div");bg.className="bg sector-"+q;bg.style.backgroundColor=colors[i%colors.length];bg.style.zIndex=Z--;div.appendChild(bg);Q++;Z=10*Q;if(Q>4){q=Q-4;}else{q=Q;}}else{sector.className="pie sector-"+q;var size=Math.abs(S*Math.tan(angle));var size2=S;if(size>0){if(size>S){size2=S*Math.cos(angle)/Math.sin(angle);size=S;sector.style[[0,"width","height","width","height"][q]]=S-size2+"em";}
sector.style["border"+[0,"Left","Bottom","Right","Top"][q]]="solid "+size2+"em transparent";sector.style["border"+[0,"Bottom","Right","Top","Left"][q]]="solid "+size+"em "+colors[i%colors.length];sector.size=size;sector.colour=colors[i%colors.length];sector.style.zIndex=Z--;div.appendChild(sector);}}}};}
if(typeof(Prototype)=="undefined")
throw"Portal requires Prototype to be loaded.";if(typeof(Effect)=="undefined")
throw"Portal requires Effects to be loaded.";if(typeof(Sortable)=="undefined")
throw"Portal requires Sortable to be loaded.";var Portal=Class.create();Portal.prototype={initialize:function(settings,options,data,disabled){this.setOptions(options);this.apply_settings(settings);if(!this.options.editorEnabled)return;var columns=$(this.options.portal).getElementsByClassName(this.options.column);if(!disabled){$A(columns).each(function(column){Sortable.create(column,{containment:$A(columns),constraint:this.options.constraint,ghosting:this.options.ghosting,tag:this.options.tag,only:this.options.block,dropOnEmpty:this.options.droponempty,handle:this.options.handle,hoverclass:this.options.hoverclass,scroll:this.options.scroll,onUpdate:function(container){if(!this.options.saveurl)return;if(container.id==this.options.blocklist)return;var blocks=container.getElementsByClassName(this.options.block);var res=[];$A(blocks).each(function(el){res.push("'"+el.id+"'")});var postBody=container.id+'='+escape(res.join(','));new Ajax.Request(this.options.saveurl,{method:'post',postBody:postBody,onComplete:function(t){}});}.bind(this)});}.bind(this));}},apply_settings:function(settings){for(var container in settings){var f=function(block){if(block=='')return;if(!$(block))return;if(!$(container)){}else{$(container).appendChild($(block));}};settings[container].each(f);$('portal-column-block-list').childElements().each(f);}},setOptions:function(options){this.options={tag:'div',editorEnabled:false,portal:'portal',column:'column',block:'block',content:'content',configElement:'config',configSave:'save-button',configCancel:'cancel-button',configSaved:'config-saved',handle:'draghandle',hoverclass:'target',scroll:window,remove:'option-remove',config:'option-edit',blocklist:'portal-column-block-list',saveurl:false,constraint:false,ghosting:false,droponempty:true}
Object.extend(this.options,options||{});},loadData:function(data){for(var type in data){data[type].each(function(block){for(var blockname in block){switch(type){default:new Ajax.Updater(blockname+'-content','/module/'+type+'/data='+block[blockname],{evalScripts:true});}}}.bind(this));}}};if(typeof(Prototype)=="undefined")
throw"Control.ScrollBar requires Prototype to be loaded.";if(typeof(Control.Slider)=="undefined")
throw"Control.ScrollBar requires Control.Slider to be loaded.";if(typeof(Object.Event)=="undefined")
throw"Control.ScrollBar requires Object.Event to be loaded.";Control.ScrollBar=Class.create({initialize:function(container,track,options){this.enabled=false;this.notificationTimeout=false;this.container=$(container);this.boundMouseWheelEvent=this.onMouseWheel.bindAsEventListener(this);this.boundResizeObserver=this.onWindowResize.bind(this);this.track=$(track);this.handle=this.track.firstDescendant();this.options=Object.extend({active_class_name:'scrolling',apply_active_class_name_to:this.container,notification_timeout_length:125,handle_minimum_height:25,scroll_to_smoothing:0.01,scroll_to_steps:15,proportional:true,slider_options:{}},options||{});this.slider=new Control.Slider(this.handle,this.track,Object.extend({axis:'vertical',onSlide:this.onChange.bind(this),onChange:this.onChange.bind(this)},this.options.slider_options));this.recalculateLayout();Event.observe(window,'resize',this.boundResizeObserver);this.handle.observe('mousedown',function(){if(this.auto_sliding_executer)
this.auto_sliding_executer.stop();}.bind(this));},destroy:function(){Event.stopObserving(window,'resize',this.boundResizeObserver);},enable:function(){this.enabled=true;this.container.observe('mouse:wheel',this.boundMouseWheelEvent);this.slider.setEnabled();this.track.show();if(this.options.active_class_name)
$(this.options.apply_active_class_name_to).addClassName(this.options.active_class_name);this.notify('enabled');},disable:function(){this.enabled=false;this.container.stopObserving('mouse:wheel',this.boundMouseWheelEvent);this.slider.setDisabled();this.track.hide();if(this.options.active_class_name)
$(this.options.apply_active_class_name_to).removeClassName(this.options.active_class_name);this.notify('disabled');this.reset();},reset:function(){this.slider.setValue(0);},recalculateLayout:function(){if(this.container.scrollHeight<=this.container.offsetHeight)
this.disable();else{this.enable();this.slider.trackLength=this.slider.maximumOffset()-this.slider.minimumOffset();if(this.options.proportional){this.handle.style.height=Math.max(this.container.offsetHeight*(this.container.offsetHeight/this.container.scrollHeight),this.options.handle_minimum_height)+'px';this.slider.handleLength=this.handle.style.height.replace(/px/,'');}}},onWindowResize:function(){this.recalculateLayout();this.scrollBy(0);},onMouseWheel:function(event){if(this.auto_sliding_executer)
this.auto_sliding_executer.stop();this.slider.setValueBy(-(event.memo.delta/20));event.stop();return false;},onChange:function(value){this.container.scrollTop=Math.round(value/this.slider.maximum*(this.container.scrollHeight-this.container.offsetHeight));if(this.notification_timeout)
window.clearTimeout(this.notificationTimeout);this.notificationTimeout=window.setTimeout(function(){this.notify('change',value);}.bind(this),this.options.notification_timeout_length);},getCurrentMaximumDelta:function(){return this.slider.maximum*(this.container.scrollHeight-this.container.offsetHeight);},getDeltaToElement:function(element){return this.slider.maximum*((element.positionedOffset().top+(element.getHeight()/2))-(this.container.getHeight()/2));},scrollTo:function(y,animate){var current_maximum_delta=this.getCurrentMaximumDelta();if(y=='top')
y=0;else if(y=='bottom')
y=current_maximum_delta;else if(typeof(y)!="number")
y=this.getDeltaToElement($(y));if(this.enabled){y=Math.max(0,Math.min(y,current_maximum_delta));if(this.auto_sliding_executer)
this.auto_sliding_executer.stop();var target_value=y/current_maximum_delta;var original_slider_value=this.slider.value;var delta=(target_value-original_slider_value)*current_maximum_delta;if(animate){this.auto_sliding_executer=new PeriodicalExecuter(function(){if(Math.round(this.slider.value*100)/100<Math.round(target_value*100)/100||Math.round(this.slider.value*100)/100>Math.round(target_value*100)/100){this.scrollBy(delta/this.options.scroll_to_steps);}else{this.auto_sliding_executer.stop();this.auto_sliding_executer=null;if(typeof(animate)=="function")
animate();}}.bind(this),this.options.scroll_to_smoothing);}else
this.scrollBy(delta);}else if(typeof(animate)=="function")
animate();},scrollBy:function(y){if(!this.enabled)
return false;this.slider.setValueBy(y/this.getCurrentMaximumDelta());}});Object.Event.extend(Control.ScrollBar);var fdSliderController;(function(){function fdSlider(inp,range,callback,classname,hide,tween,vertical){this._inp=inp;this._hideInput=hide;this._min=range[0]||0;this._max=range[1]||0;this._range=this._max-this._min;this._tween=tween;this._mouseX=0;this._timer=null;this._classname=classname;this._drag=false;this._kbEnabled=true;this._callback=callback;this._vertical=vertical;this._steps=inp.tagName.toLowerCase()=="input"?10:inp.options.length-1;this._resizeVal=0;this.NS_XHTML="http://www.w3.org/1999/xhtml";this.NS_STATE="http://www.w3.org/2005/07/aaa";this.events={stopevent:function(e){if(e==null)e=document.parentWindow.event;if(e.stopPropagation){e.stopPropagation();e.preventDefault();}
return false;},redrawEvent:function(e){if((self._vertical&&self.outerWrapper.offsetHeight!=self._resizeVal)||(!self._vertical&&self.outerWrapper.offsetWidth!=self._resizeVal)){self.events.redraw();};},redraw:function(){self.locate();try{var sW=self.outerWrapper.offsetWidth;var sH=self.outerWrapper.offsetHeight;var hW=self.handle.offsetWidth;var hH=self.handle.offsetHeight;var bH=self.bar.offsetHeight;var bW=self.bar.offsetWidth;var sI=self._steps;if(self._vertical){self.bar.style.height=Math.round(sH-hH)+"px";self.bar.style.left=Math.floor((sW-bW)/2)+"px";self.bar.style.top=Math.round(hH/2)+"px";self._incPx=(sH-hH)/sI<1?1:(sH-hH)/sI;}else{self.bar.style.top=Math.floor((sH-bH)/2)+"px";self._incPx=(sW-hW)/sI<1?1:(sW-hW)/sI;};self.resetHandlePosition();self._resizeVal=(self._vertical)?sH:sW;}catch(err){};},onfocus:function(e){self.outerWrapper.className=self.outerWrapper.className.replace('focused','')+' focused';fdSliderController.addEvent(window,'DOMMouseScroll',self.events.trackmousewheel);fdSliderController.addEvent(document,'mousewheel',self.events.trackmousewheel);if(!window.opera)fdSliderController.addEvent(window,'mousewheel',self.events.trackmousewheel);self.doCallback();},onblur:function(e){self.outerWrapper.className=self.outerWrapper.className.replace(/focused|fd-fc-slider-hover|fd-slider-hover/g,'');fdSliderController.removeEvent(document,'mousewheel',self.events.trackmousewheel);fdSliderController.removeEvent(window,'DOMMouseScroll',self.events.trackmousewheel);if(!window.opera)fdSliderController.removeEvent(window,'mousewheel',self.events.trackmousewheel);},trackmousewheel:function(e){if(!self._kbEnabled)return;var delta=0;var e=e||window.event;if(e.wheelDelta){delta=e.wheelDelta/120;if(window.opera&&window.opera.version()<9.2)delta=-delta;}else if(e.detail){delta=-e.detail/3;};if(delta){var xtmp=self._vertical?self.handle.offsetTop:self.handle.offsetLeft;var wtmp=self._vertical?self.outerWrapper.offsetHeight-self.handle.offsetHeight:self.outerWrapper.offsetWidth-self.handle.offsetWidth;var inc=self._inp.tagName.toLowerCase()=="input"?Math.round(self._incPx/2)<1?1:Math.round(self._incPx/2):self._incPx;if(self._vertical)inc=-inc;if(delta<0){xtmp+=inc;xtmp=Math.ceil(xtmp);}else{xtmp-=inc;xtmp=Math.floor(xtmp);};if(xtmp<0)xtmp=0;else if(xtmp>wtmp)xtmp=wtmp;if(self._vertical)self.handle.style.top=xtmp+"px";else self.handle.style.left=xtmp+"px";self.updateInput(xtmp);};return self.events.stopevent(e);},onkeypress:function(e){if(e==null)e=document.parentWindow.event;if((e.keyCode>=35&&e.keyCode<=40)||!self._kbEnabled){return self.events.stopevent(e);};},onkeydown:function(e){if(!self._kbEnabled)return true;if(e==null)e=document.parentWindow.event;var kc=e.keyCode!=null?e.keyCode:e.charCode;if(kc<35||kc>40)return true;var xtmp=self._vertical?self.handle.offsetTop:self.handle.offsetLeft;var wtmp=self._vertical?self.outerWrapper.offsetHeight-self.handle.offsetHeight:self.outerWrapper.offsetWidth-self.handle.offsetWidth;var inc=self._inp.tagName.toLowerCase()=="input"?Math.round(self._incPx/2)<1?1:Math.round(self._incPx/2):self._incPx;if(self._vertical)inc=-inc;if(kc==37||kc==40){xtmp-=inc;xtmp=Math.floor(xtmp);}else if(kc==39||kc==38){xtmp+=inc;xtmp=Math.ceil(xtmp);}else if(kc==35){xtmp=wtmp;}else if(kc==36){xtmp=0;}
if(xtmp<0)xtmp=0;else if(xtmp>wtmp)xtmp=wtmp;self.handle.style[self._vertical?"top":"left"]=xtmp+"px";self.updateInput(xtmp);return self.events.stopevent(e);},onchange:function(e){self.resetHandlePosition();self.doCallback();return true;},onmouseover:function(e){this.className=this.className.replace(/fd\-slider\-hover/g,"")+' fd-slider-hover';},onmouseout:function(e){this.className=this.className.replace(/fd\-slider\-hover/g,"");},onHmouseup:function(e){e=e||window.event;fdSliderController.removeEvent(document,'mousemove',self.events.trackmouse);fdSliderController.removeEvent(document,'mouseup',self.events.onHmouseup);self._drag=false;self._kbEnabled=true;if(window.opera)try{setTimeout(function(){self.events.onfocus();},0);}catch(err){};return self.events.stopevent(e);},onHmousedown:function(e){e=e||window.event;self._mouseX=self._vertical?e.clientY:e.clientX;self.handleX=parseInt(self._vertical?self.handle.offsetTop:self.handle.offsetLeft)||0;self._drag=true;self._kbEnabled=false;fdSliderController.addEvent(document,'mousemove',self.events.trackmouse);fdSliderController.addEvent(document,'mouseup',self.events.onHmouseup);if(window.devicePixelRatio||(document.all&&!window.opera))try{setTimeout(function(){self.handle.focus();},0);}catch(err){};},onmouseup:function(e){e=e||window.event;fdSliderController.removeEvent(document,'mouseup',self.events.onmouseup);if(!self._tween){clearTimeout(self._timer);self._timer=null;self._kbEnabled=true;}
self.doCallback();return self.events.stopevent(e);},trackmouse:function(e){if(!e)var e=window.event;var x=self._vertical?self.handleX+(e.clientY-self._mouseX):self.handleX+(e.clientX-self._mouseX);if(x<0)x=0;var max=self._vertical?self.outerWrapper.offsetHeight-self.handle.offsetHeight:self.outerWrapper.offsetWidth-self.handle.offsetWidth;if(x>max)x=max;x=Math.round(x/41)*41;if(self._vertical)self.handle.style.top=x+"px";else self.handle.style.left=x+"px";self.updateInput(x);},onmousedown:function(e){var targ;if(!e)var e=window.event;if(e.target)targ=e.target;else if(e.srcElement)targ=e.srcElement;if(targ.nodeType==3)targ=targ.parentNode;if(targ.className.search("fd-slider-handle")!=-1){return true;};try{setTimeout(function(){self.handle.focus();},0);}catch(err){};clearTimeout(self._timer);self._timer=null;self._kbEnabled=false;self.locate();self._drag=false;var posx=0;var sLft=0;var sTop=0;if(document.documentElement&&document.documentElement.scrollTop){sTop=document.documentElement.scrollTop;sLft=document.documentElement.scrollLeft;}else if(document.body){sTop=document.body.scrollTop;sLft=document.body.scrollLeft;};if(e.pageX)posx=self._vertical?e.pageY:e.pageX;else if(e.clientX)posx=self._vertical?e.clientY+sTop:e.clientX+sLft;var diff=Math.round((self._vertical)?self.handle.offsetHeight/2:self.handle.offsetWidth/2);posx-=self._vertical?self._y+diff:self._x+diff;if(posx<0)posx=0;else if(!self._vertical&&posx>self.outerWrapper.offsetWidth-self.handle.offsetWidth)posx=self.outerWrapper.offsetWidth-self.handle.offsetWidth;else if(self._vertical&&posx>self.outerWrapper.offsetHeight-self.handle.offsetHeight)posx=self.outerWrapper.offsetHeight-self.handle.offsetHeight;posx=Math.round(posx/41)*41;if(self._tween){self.tweenTo(posx);}else{fdSliderController.addEvent(document,'mouseup',self.events.onmouseup);self._posx=posx;self.onTimer();};}};this.onTimer=function(){var xtmp=self._vertical?self.handle.offsetTop:self.handle.offsetLeft;if(self._posx<xtmp){xtmp-=self._incPx;xtmp=Math.floor(xtmp);if(xtmp<self._posx)xtmp=self._posx;}else{xtmp+=self._incPx;xtmp=Math.ceil(xtmp);if(xtmp>self._posx)xtmp=self._posx;};xtmp=Math.round(xtmp);self.handle.style[self._vertical?"top":"left"]=xtmp+"px";self.updateInput(xtmp);if(xtmp!=self._posx)self._timer=setTimeout(self.onTimer,200);else self._kbEnabled=true;};this.locate=function(){var curleft=0;var curtop=0;var obj=self.outerWrapper;try{while(obj.offsetParent){curleft+=obj.offsetLeft;curtop+=obj.offsetTop;obj=obj.offsetParent;};}catch(err){}
self._x=curleft;self._y=curtop;};this.tweenTo=function(x){self._kbEnabled=false;self._tweenX=parseInt(x);self._tweenB=parseInt(self._vertical?self.handle.style.top:self.handle.style.left);self._tweenC=self._tweenX-self._tweenB;self._tweenD=20;self._frame=0;if(!self._timer)self._timer=setTimeout(self.tween,50);};this.tween=function(){self._frame++;var c=self._tweenC;var d=20;var t=self._frame;var b=self._tweenB;var x=Math.ceil((t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b);self.handle.style[self._vertical?"top":"left"]=x+"px";self.updateInput(x);if(t!=d&&!self._md)self._timer=setTimeout(self.tween,20);else{self.handle.style[self._vertical?"top":"left"]=self._tweenX+"px";clearTimeout(self._timer);self._timer=null;self._kbEnabled=true;};};this.updateInput=function(x){var max=self._vertical?self.outerWrapper.offsetHeight-self.handle.offsetHeight:self.outerWrapper.offsetWidth-self.handle.offsetWidth;var inc=max/self._range;var val=Number(self._min)+Math.abs(Math.floor(x/inc));if(self._vertical)val=-val;if(val<self._min)val=self._min;else if(val>self._max)val=self._max;val=(val<=self._min+(self._max/2))?Math.round(val):Math.ceil(val);self.setInputValue(val);self.doCallback();};this.setInputValue=function(val){if(self._inp.tagName.toLowerCase()=="select"){try{self._inp.options[val].selected=true;self.setAttrNS(self.handle,self.NS_STATE,"valuenow",self._inp.options[val].value);self.setAttrNS(self.handle,self.NS_STATE,"valuetext",self._inp.options[val].text);}catch(err){};}else{self._inp.value=val;self.setAttrNS(self.handle,self.NS_STATE,"valuenow",val);self.setAttrNS(self.handle,self.NS_STATE,"valuetext",val);};};this.doCallback=function(){if(self._callback){var func;if(self._callback.indexOf(".")!=-1){var split=self._callback.split(".");func=window;for(var i=0,f;f=split[i];i++){if(f in func){func=func[f];}else{func="";break;};};}else if(self._callback in window){func=window[self._callback];};if(typeof func=="function"){func();};func=null;};};this.resetHandlePosition=function(){var value=self._inp.tagName.toLowerCase()=="input"?parseInt(self._inp.value,10):self._inp.selectedIndex;if(isNaN(value)||value<self._min)value=self._min;else if(value>self._max)value=self._max;self.setInputValue(value);var max=self._vertical?self.outerWrapper.offsetHeight-self.handle.offsetHeight:self.outerWrapper.offsetWidth-self.handle.offsetWidth;var inc=max/self._range;var tot=value-self._min;var pos=(tot*inc<(self._min+(self._range/2)))?Math.floor(tot*inc):Math.ceil(tot*inc);if(self._vertical){self.handle.style.top=Math.abs(max-pos)+"px";}else{self.handle.style.left=pos+"px";};};this.setAttrNS=function(elmTarget,uriNamespace,sAttrName,sAttrValue){if(typeof document.documentElement.setAttributeNS!='undefined'){elmTarget.setAttributeNS(uriNamespace,sAttrName,sAttrValue);}else{var nsMapping={"http://www.w3.org/1999/xhtml":"x:","http://www.w3.org/2005/07/aaa":"aaa:"};elmTarget.setAttribute(nsMapping[uriNamespace]+sAttrName,sAttrValue);};};this.findLabel=function(){var label;if(self._inp.parentNode&&self._inp.parentNode.tagName.toLowerCase()=="label")label=self._inp.parentNode;else{var labelList=document.getElementsByTagName('label');for(var lbl=0;lbl<labelList.length;lbl++){if((labelList[lbl]['htmlFor']&&labelList[lbl]['htmlFor']==self._inp.id)||(labelList[lbl].getAttribute('for')==self._inp.id)){label=labelList[lbl];break;};};};if(label&&!label.id){label.id=inp.id+"_label_"+fdSliderController.uniqueid++;};return label;};this.build=function(){if(self._hideInput)self._inp.style.display="none";else fdSliderController.addEvent(self._inp,'change',self.events.onchange);self.outerWrapper=document.createElement('div');self.outerWrapper.className="fd-slider"+(self._vertical?"-vertical ":" ")+self._classname;self.outerWrapper.id="fd-slider-"+inp.id;self.wrapper=document.createElement('span');self.wrapper.className="fd-slider-inner";self.bar=document.createElement('span');self.bar.className="fd-slider-bar";self.handle=document.createElement('button');self.handle.className="fd-slider-handle";self.handle.appendChild(document.createTextNode(" "));self.handle.setAttribute("type","button");self.handle.setAttribute("tabindex","0");self.outerWrapper.appendChild(self.wrapper);self.outerWrapper.appendChild(self.bar);self.outerWrapper.appendChild(self.handle);self._inp.parentNode.insertBefore(self.outerWrapper,self._inp);self.handle.setAttribute("tabindex","0");fdSliderController.addEvent(self.outerWrapper,"mouseover",self.events.onmouseover);fdSliderController.addEvent(self.outerWrapper,"mouseout",self.events.onmouseout);fdSliderController.addEvent(self.outerWrapper,"mousedown",self.events.onmousedown);fdSliderController.addEvent(self.handle,"keydown",self.events.onkeydown);fdSliderController.addEvent(self.handle,"keypress",self.events.onkeypress);fdSliderController.addEvent(self.handle,"focus",self.events.onfocus);fdSliderController.addEvent(self.handle,"blur",self.events.onblur);fdSliderController.addEvent(self.handle,"mousedown",self.events.onHmousedown);fdSliderController.addEvent(self.handle,"mouseup",self.events.onHmouseup);fdSliderController.addEvent(window,"resize",self.events.redrawEvent);self.setAttrNS(self.handle,self.NS_XHTML,"role","wairole:slider");self.setAttrNS(self.handle,self.NS_STATE,"valuemin",self._min);self.setAttrNS(self.handle,self.NS_STATE,"valuemax",self._max);var lbl=self.findLabel();if(lbl){self.setAttrNS(self.handle,self.NS_STATE,'labelledby',lbl.id);self.handle.id="fd-slider-handle-"+inp.id;lbl.setAttribute("for",self.handle.id);};if(document.getElementById("fd_slider_describedby")){self.setAttrNS(self.handle,self.NS_STATE,'describedby',"fd_slider_describedby");};self.events.redraw();};this.destroy=function(){try{self._callback=null;fdSliderController.removeEvent(self.outerWrapper,"mouseover",self.events.onmouseover);fdSliderController.removeEvent(self.outerWrapper,"mouseout",self.events.onmouseout);fdSliderController.removeEvent(self.outerWrapper,"mousedown",self.events.onmousedown);fdSliderController.removeEvent(self.handle,"keydown",self.events.onkeydown);fdSliderController.removeEvent(self.handle,"keypress",self.events.onkeypress);fdSliderController.removeEvent(self.handle,"focus",self.events.onfocus);fdSliderController.removeEvent(self.handle,"blur",self.events.onblur);fdSliderController.removeEvent(self.handle,"mousedown",self.events.onHmousedown);fdSliderController.removeEvent(self.handle,"mouseup",self.events.onHmouseup);fdSliderController.removeEvent(window,"resize",self.events.redraw);if(window.addEventListener&&!window.devicePixelRatio)window.removeEventListener('DOMMouseScroll',self.events.trackmousewheel,false);else{fdSliderController.removeEvent(document,"mousewheel",self.events.trackmousewheel);fdSliderController.removeEvent(window,"mousewheel",self.events.trackmousewheel);};}catch(err){}
self.wrapper=self.bar=self.handle=self.outerWrapper=self._timer=null;};var self=this;self.build();};fdSliderController={sliders:{},uniqueid:0,forms:{},addEvent:function(obj,type,fn){if(obj.attachEvent){obj["e"+type+fn]=fn;obj[type+fn]=function(){obj["e"+type+fn](window.event);}
obj.attachEvent("on"+type,obj[type+fn]);}else{obj.addEventListener(type,fn,true);}},removeEvent:function(obj,type,fn){if(obj.detachEvent){try{obj.detachEvent("on"+type,obj[type+fn]);obj[type+fn]=null;}catch(err){};}else{obj.removeEventListener(type,fn,true);}},onload:function(e){for(slider in fdSliderController.sliders){fdSliderController.sliders[slider].resetHandlePosition();}},joinNodeLists:function(){if(!arguments.length){return[];}
var nodeList=[];for(var i=0;i<arguments.length;i++){for(var j=0,item;item=arguments[i][j];j++){nodeList[nodeList.length]=item;};};return nodeList;},construct:function(e){var regExp_1=/fd_range_([-]{0,1}[0-9]+){1}_([-]{0,1}[0-9]+){1}/;var regExp_2=/fd_callback_([\S-]+)/;var regExp_3=/fd_classname_([a-zA-Z0-9_\-]+)/;var inputs=fdSliderController.joinNodeLists(document.getElementsByTagName('input'),document.getElementsByTagName('select'));var range,callback,classname,hide,tween,vertical;for(var i=0,inp;inp=inputs[i];i++){if((inp.tagName.toLowerCase()=="input"&&inp.type=="text"&&inp.className&&inp.className.search(regExp_1)!=-1)||(inp.tagName.toLowerCase()=="select"&&inp.className.search(/fd_slider/)!=-1)){if(!inp.id)inp.id=="sldr"+fdSliderController.uniqueid++;if(document.getElementById("fd-slider-"+inp.id))continue;if(inp.tagName.toLowerCase()=="select"){range=[0,inp.options.length-1];hide=true;}else{range=inp.className.match(regExp_1);range=[range[1],range[2]]
hide=inp.className.search(/fd_hide_input/ig)!=-1;};callback=inp.className.search(regExp_2)!=-1?inp.className.match(regExp_2)[1].replace("-","."):"";classname=inp.className.search(regExp_3)!=-1?inp.className.match(regExp_3)[1]:"";tween=inp.className.search(/fd_tween/ig)!=-1;vertical=inp.className.search(/fd_vertical/ig)!=-1;fdSliderController.sliders[inp.id]=new fdSlider(inp,range,callback,classname,hide,tween,vertical);};};},deconstruct:function(e){for(slider in fdSliderController.sliders){fdSliderController.sliders[slider].destroy();};fdSliderController.sliders=null;fdSliderController.removeEvent(window,"load",fdSliderController.construct);fdSliderController.removeEvent(window,"unload",fdSliderController.deconstruct);}}})();fdSliderController.addEvent(window,"unload",fdSliderController.deconstruct);fdSliderController.addEvent(window,"load",fdSliderController.construct);﻿function createTable(_name,_containerName,_title,_deletable){return{name:_name,title:_title,table:null,containerName:_containerName,container:document.getElementById(_containerName),data:[],fullTable:null,thead:null,tbody:null,limit:5,entryLimit:999,allowFullLoad:true,fullLoadFunc:'loadFullBrowser',staticParams:'',otherTitle:'',deletable:_deletable,lastSort:'Hosts',lastDest:-1,getDataByID:function(id){for(var i=0;i<this.data.length;i++){if(this.data[i].ID==id){return i;}}
return-1;},getDataByTitle:function(title){for(var i=0;i<this.data.length;i++){if(this.data[i].Title==title){return i;}}
return-1;},getDataByIDAndType:function(id,type){for(var i=0;i<this.data.length;i++){if((this.data[i].ID==id)&&(this.data[i].Type==type)){return i;}}
return-1;},getDataByTitleAndType:function(title,type){for(var i=0;i<this.data.length;i++){if((this.data[i].Title==title)&&(this.data[i].Type==type)){return i;}}
return-1;},recalcMax:function(){var max=0;for(i=0;i<this.data.length;i++){if(this.data[i].Hosts>max){max=this.data[i].Hosts;}}
for(i=0;i<this.data.length;i++){this.data[i].MaxHosts=max;}},resort:function(event,field){if(field==this.lastSort){this.lastDest*=-1;}else{this.lastDest=1;}
this.lastSort=field;var dest=this.lastDest;var postBody=this.name+'Sort='+this.lastSort+'&'+this.name+'Dest='+this.lastDest;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefs',{method:'post',postBody:postBody,onComplete:function(t){}});this.realResort(this.lastSort,dest);},sort:function(){this.realResort(this.lastSort,this.lastDest);},realResort:function(field,dest){this.lastSort=field;this.lastDest=dest;Element.extend(this.thead);var el=this.thead.down().next().down();while(el!=null){var str=el.innerHTML;if((str[str.length-1]=='↓')||(str[str.length-1]=='↑')){str=str.substr(0,str.length-1);}
if(el.getAttribute('type')==field){el.update(str+' '+((dest==1)?'&darr;':'&uarr;'));}else{el.update(str);}
el=el.next();}
this.data.sort(function(a,b){var val_a=a[field];var val_b=b[field];if(field!='Title'){if((field!='Percent')&&(field!='PercentTotal')){val_a=parseInt(val_a);val_b=parseInt(val_b);}else{val_a=parseFloat(val_a);val_b=parseFloat(val_b);}}
if(val_a>val_b)return dest;if(val_a==val_b){return 0;return(a['Title']>b['Title'])?dest:-dest;}
if(val_a<val_b)return-dest;});switch(field){case'Title':field='BrowserVersion';break;case'Hited':field='hited';break;case'Hosts':field='hosts';break;case'Executed':field='executed';break;case'Percent':field='Percent';break;case'PercentTotal':field='Percent';break;}
this.data.each(function(d){if(d.items&&(d.items.length>0)){d.items.sort(function(a,b){var val_a=a[field];var val_b=b[field];if(field!='BrowserVersion'){if((field!='executed')&&(field!='PercentTotal')){val_a=parseInt(val_a);val_b=parseInt(val_b);}else{val_a=parseFloat(val_a);val_b=parseFloat(val_b);}}
if(field=='Percent'){var h2=a['hosts2'];val_a=(h2!=0)?parseFloat(a['executed']/h2):0;var r2=b['hosts2'];val_b=(r2!=0)?parseFloat(b['executed']/r2):0;}
if(val_a>val_b)return dest;if(val_a==val_b){return 0;return(a['Title']>b['Title'])?dest:-dest;}
if(val_a<val_b)return-dest;});}});if(this.fullTable!=null){this.redrawFull();}
this.updateBody();},redrawFull:function(){this.fullTable.update();this.drawFull();},drawFull:function(){var first=false;if(this.fullTable==null){first=true;var div=new Element('div',{className:'main'}).setStyle({paddingBottom:'20px'});this.fullTable=new Element('table');}
var tbody=new Element('tbody');var td=new Element('td',{className:'title2'}).update(this.title+' '+((this.lastSort=='Title')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'Title'));if(this.name=='exploits'){td.setStyle({width:'241px'});}
var tr=new Element('tr',{className:'maximazed'}).insert(new Element('td',{className:'title'}).update(this.title)).insert(new Element('td',{className:'percent2'}).update(Titles.PercentTotal+' '+((this.lastSort=='PercentTotal')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'PercentTotal'))).insert(td);var th=new Element('thead').update(tr);if(this.name!='exploits'){tr.insert(new Element('td',{className:'hited'}).update(Titles.HitsLabel+' '+((this.lastSort=='Hited')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'Hited'))).insert(new Element('td',{className:'hosts'}).update(Titles.HostsLabel+' '+((this.lastSort=='Hosts')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'Hosts')));}
tr.insert(new Element('td',{className:'executed'}).update(Titles.LoadsLabel+' '+((this.lastSort=='Executed')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'Executed'))).insert(new Element('td',{className:'percent'}).update(Titles.PercentLabel+' '+((this.lastSort=='Percent')?(this.lastDest==1)?'&darr;':'&uarr;':'')).observe('click',this.resort.bindAsEventListener(this,'Percent'))).insert(new Element('td',{className:'controls'}).setStyle({textAlign:'right'}).update(new Element('div',{className:'close'}).observe('click',this.closeFull.bindAsEventListener(this))));this.fullTable.insert(th).insert(tbody);var summ=0;for(var i=0;i<this.data.length;i++){summ+=parseInt(this.data[i].Hosts);}
var forChart=[];var pie=new Element('div',{id:'pie'});var len=0;for(var i=0;i<this.data.length;i++){len++;var d=this.data[i];if(d.items&&(d.items.length>0)){for(var k=0;k<d.items.length;k++){if(d.items[k]===false)continue;len++;}}}
for(var i=0;i<this.data.length;i++){var entry=d=this.data[i];var tr=new Element('tr');if(i%2){tr.addClassName('odd');}
if(i==0){pie.update('<span id="for-ie"><img src="'+Config.ImgPath+'pie-1.png" alt="" id="circle" /></span>');var td=new Element('td',{rowspan:len+1,valign:'top'}).setStyle({paddingTop:'15px'}).update(pie);tr.insert(td);}
var td2=new Element('td',{className:'charttd'});var c_w_l=new Element('div',{className:'chart-w-l'});td2.insert(c_w_l);var c2=new Element('div',{className:'c2'});c_w_l.insert(c2);var c3=new Element('div',{className:'c3'});c2.insert(c3);var perc=0;if(d.Hited!=0)
perc=Math.ceil((d.Hosts/d.Hited)*100);var dd2=new Element('div');dd2.className='chart';if(d.Hited!=0)
dd2.style.width=perc+'%';else
dd2.style.width='0%';c3.insert(dd2);var c4=new Element('div',{className:'c4'});c4.setStyle({width:(1.18*perc-10+1)+'px'});dd2.insert(c4);var c5=new Element('div',{className:'c5'});dd2.insert(c5);var c6=new Element('div',{className:'c6'});c5.insert(c6);var div2=new Element('div');div2.className='hited';var perc2=0;if(d.Hosts2!=0){perc2=Math.ceil((d.Executed/d.Hosts2)*100);}
div2.style.minWidth='10px';div2.style.width=perc2+'%';div2.setStyle({opacity:(perc2==0)?'0':'1'});div2.id=this.name+'-'+d.ID;c6.insert(div2);var c8=new Element('div',{className:'c8'});div2.insert(c8);var c9=new Element('div',{className:'c9'});c8.insert(c9);var c7=new Element('div',{className:'c7'});var val=(0.0118*perc*perc2-10+1);if(val<0)val=0;c7.setStyle({width:val+'px'});c9.insert(c7);var img='';if(Icons[entry.Type]&&Icons[entry.Type][entry.ID]){img=Icons[entry.Type][entry.ID];}
if(entry.Type=='exploits'){img='exploit';}
img+='.gif';if(entry.Type=='countries'){img='countries/'+Icons.countries[entry.ID]+'.gif';}
var title='';if(img=='.gif'){title=entry.Title;}else{title='<img src="'+Config.ImgPath+'icons/'+img+'"  ALIGN="ABSMIDDLE"/>'+entry.Title;}
if(summ!=0){r=(d.Hosts/summ)*100;}else{r=0;}
entry.PercentTotal=r;var td=new Element('td');if((!this.allowFullLoad)&&(entry.Type!='browsers')&&(entry.Type!='threads')||(entry.Hosts==0)||(entry.Title=='no referer')){if(entry.Title=='no referer')
td.innerHTML='<i>no referer</i>';else
td.innerHTML=title;}else{if(entry.Type=='referers'){td.innerHTML='<a href="javascript:Charts.loadFullReferer(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=RefererStatistic\',\'RefererID='+entry.ID+'&RefererDomain='+entry.Title+this.staticParams+'\',\''+entry.Title+'\',false,\''+this.name+'\')">'+title+'</a>';}else if(entry.Type=='threads'){td.innerHTML='<a href="javascript:Charts.loadFullThread(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=ThreadStatistic\',\'ThreadID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}else if(entry.Type=='exploits'){td.innerHTML='<a href="javascript:Charts.loadFullExploit(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=ExploitStatistic\',\'ExploitID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}else
if(this.fullLoadFunc=='loadFullBrowser'){td.innerHTML='<a href="javascript:Charts.loadFullBrowser(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=BrowserStatistic\',\'BrowserID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}
if(first){if(d.items&&(d.items.length>0)){}else{eval(td.down().href);}}}
if(d.items&&(d.items.length>0)){td.down().addClassName('full');}
tbody.insert(tr.insert(new Element('td').insert(new Element('div',{className:'bln'}).setStyle({background:colors[i%colors.length]}).update(new Element('img',{src:Config.ImgPath+'bln'+(i%2)+'.png'}))).insert(r.toFixed(2))).insert(td));if(this.name!='exploits'){tr.insert(new Element('td').update(d.Hited)).insert(new Element('td').update(d.Hosts));}
var r=(d.Hosts2!=0)?((d.Executed/d.Hosts2)*100):0;r=r.toFixed(2);entry.Percent=r;tr.insert(new Element('td').update(d.Executed)).insert(new Element('td').update(r)).insert(td2);forChart.push(d.Hosts);if(d.items&&(d.items.length>0)){var maxLimit=d.items.length;for(var j=0;j<maxLimit;j++){var result=d.items[j];if(result===false)continue;var tr=this.createMinTR2(result,j);tbody.appendChild(tr);}
if(maxLimit!=d.items.length){var other={hited:0,hosts:0,hosts2:0,executed:0,BrowserVersion:Lang.StatisticsOtherLabel};for(var k=maxLimit;k<d.items.length;k++){var result=d.items[k];if(result===false)continue;other.hited+=parseInt(d.items[k].hited);other.hosts+=parseInt(d.items[k].hosts);other.hosts2+=parseInt(d.items[k].hosts2);other.executed+=parseInt(d.items[k].executed);}
var tr=this.createMinTR2(other,i);tbody.appendChild(tr);}}}
var height=26*len;if(height<300){tbody.insert(new Element('tr').setStyle({height:(300-height)+'px'}).insert(new Element('td')).insert(new Element('td')).insert(new Element('td')).insert(new Element('td')).insert(new Element('td')).insert(new Element('td')).insert(new Element('td')));}
if(first){div.insert(this.fullTable);}
pc=new PieChart();pc.setValues(forChart);pc.printTo(pie);return div;},closeFull:function(){this.fullTable.select('a').each(function(el){if(el.hasClassName('full')){eval(el.href);}});Widgets.fullWidgetContainer.close();},createHead:function(){this.thead=document.createElement('thead');this.table.appendChild(this.thead);this.tbody=document.createElement('tbody');this.table.appendChild(this.tbody);var tr=new Element('tr',{className:'minimized drag'});tr.hide();this.thead.appendChild(tr);var td=new Element('td',{className:'title'});if(Object.isUndefined(this.title)){td.innerHTML='&nbsp;';}else{td.innerHTML=this.title;}
tr.appendChild(td);var td=document.createElement('td');td.style.textAlign='right';var str='';if(this.deletable){var id=this.name.replace('widgets-','');str+='<div class="close" onclick="Widgets.close(\''+id+'\')"></div>';}
str+='<div class="max" onclick="Controls.maximaze(\''+this.name+'\')"></div> ';str+='<div class="min" onclick="Controls.shide(\''+this.containerName+'\')"></div> ';if(this.deletable){str+='<div class="edit" onclick="Widgets.edit('+this.containerName.replace('widget-','')+')"></div>';}
td.innerHTML=str;tr.appendChild(td);var tr=new Element('tr',{className:'normal drag'});this.thead.appendChild(tr);var td=new Element('td',{type:'Title',className:'title'});if(this.name=='exploits'){td.setStyle({width:'250px'});}
if(Object.isUndefined(this.title)){td.innerHTML='&nbsp;';}else{td.innerHTML=this.title;}
td.observe('click',this.resort.bindAsEventListener(this,'Title'));tr.appendChild(td);if(this.name!='exploits'){var td=new Element('td',{type:'Hited',className:'hited'});td.innerHTML=Titles['HitsLabel'];td.observe('click',this.resort.bindAsEventListener(this,'Hited'));tr.appendChild(td);var td=new Element('td',{type:'Hosts',className:'hosts'});td.innerHTML=Titles['HostsLabel'];td.observe('click',this.resort.bindAsEventListener(this,'Hosts'));tr.appendChild(td);}
var td=new Element('td',{type:'Executed',className:'executed'});td.innerHTML=Titles['LoadsLabel'];td.observe('click',this.resort.bindAsEventListener(this,'Executed'));tr.appendChild(td);var td=new Element('td',{type:'Percent',className:'percent'});td.innerHTML=Titles['PercentLabel'];td.observe('click',this.resort.bindAsEventListener(this,'Percent'));tr.appendChild(td);var td=new Element('td',{className:'controls'});td.style.textAlign='right';var str='';if(this.deletable){var id=this.name.replace('widgets-','');str+='<div class="close" onclick="Widgets.close(\''+id+'\')"></div>';}
str+='<div class="max" onclick="Controls.maximaze(\''+this.name+'\')"></div> ';str+='<div class="min" onclick="Controls.shide(\''+this.containerName+'\')"></div> ';if(this.deletable){str+='<div class="edit" onclick="Widgets.edit('+this.containerName.replace('widget-','')+')"></div>';}
td.innerHTML=str;tr.appendChild(td);},setData:function(_data,isFirst){this.data=_data;this.updateBody();if(isFirst){this.realResort(this.lastSort,this.lastDest);}},addRow:function(entry,isOther,num){var tr=document.createElement('tr');if(isOther){tr.className='other';}else{if(num%2){tr.className='odd';}}
this.tbody.appendChild(tr);var td=new Element('td',{className:'title'});var titleTd=td;var img='';if(Icons[entry.Type]&&Icons[entry.Type][entry.ID]){img=Icons[entry.Type][entry.ID];}
if(entry.Type=='exploits'){img='exploit';}
img+='.gif';if(entry.Type=='countries'){img='countries/'+Icons.countries[entry.ID]+'.gif';}
var title='';if(img=='.gif'){title=entry.Title;}else{title='<img src="'+Config.ImgPath+'icons/'+img+'" ALIGN="ABSMIDDLE"/>'+entry.Title;}
if((isOther||!this.allowFullLoad)&&(entry.Type!='browsers')&&(entry.Type!='threads')||(entry.Hosts==0)||(entry.Title=='no referer')){if(entry.Title=='no referer')
td.innerHTML='<i>no referer</i>';else
td.innerHTML=title;}else{if(entry.Type=='referers'){td.innerHTML='<a href="javascript:Charts.loadFullReferer(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=RefererStatistic\',\'RefererID='+entry.ID+'&RefererDomain='+entry.Title+this.staticParams+'\',\''+entry.Title+'\',false,\''+this.name+'\')">'+title+'</a>';}else if(entry.Type=='threads'){td.innerHTML='<a href="javascript:Charts.loadFullThread(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=ThreadStatistic\',\'ThreadID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}else if(entry.Type=='exploits'){td.innerHTML='<a href="javascript:Charts.loadFullExploit(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=ExploitStatistic\',\'ExploitID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}else
if(this.fullLoadFunc=='loadFullBrowser'){td.innerHTML='<a href="javascript:Charts.loadFullBrowser(\''+Config.AdminScriptName+'?'+Config.MainParamName+'=BrowserStatistic\',\'BrowserID='+entry.ID+this.staticParams+'\',\''+entry.ID+'\',false,\''+this.name+'\')">'+title+'</a>';}}
tr.appendChild(td);if(this.name!='exploits'){var td=document.createElement('td');td.innerHTML=entry.Hited;tr.appendChild(td);var td=document.createElement('td');td.innerHTML=entry.Hosts;tr.appendChild(td);}
var td=document.createElement('td');td.innerHTML=entry.Executed;tr.appendChild(td);var td=new Element('td').setStyle({textAlign:'right'});var r=0;if(entry.Hosts2!=0){r=(parseInt(entry.Executed)/parseInt(entry.Hosts2))*100;}
if(isNaN(r))r=0;entry.Percent=r.toFixed(2);td.innerHTML=entry.Percent;tr.appendChild(td);var td=new Element('td',{className:'charttd'});tr.appendChild(td);var c_w_l=new Element('div',{className:'chart-w-l'});td.insert(c_w_l);var c2=new Element('div',{className:'c2'});c_w_l.appendChild(c2);var c3=new Element('div',{className:'c3'});c2.appendChild(c3);var perc=0;if(entry.Hited!=0)
perc=Math.ceil((entry.Hosts2/entry.Hited)*100);var div=new Element('div');div.className='chart';if(entry.Hited!=0)
div.style.width=perc+'%';else
div.style.width='0%';c3.appendChild(div);var c4=new Element('div',{className:'c4'});c4.setStyle({width:(1.18*perc-10+1)+'px'});div.appendChild(c4);var c5=new Element('div',{className:'c5'});div.appendChild(c5);var c6=new Element('div',{className:'c6'});c5.appendChild(c6);var div2=new Element('div');div2.className='hited';var perc2=0;if(entry.Hosts2!=0){perc2=Math.ceil((parseInt(entry.Executed)/parseInt(entry.Hosts2))*100);}
if(isNaN(perc2))perc2=0;if(perc2==0)div2.setStyle({minWidth:'10px',width:'0px',opacity:'0'});else div2.setStyle({minWidth:'10px',width:perc2+'%',opacity:'1'});div2.id=this.name+'-'+entry.ID;c6.appendChild(div2);var c8=new Element('div',{className:'c8'});div2.appendChild(c8);var c9=new Element('div',{className:'c9'});c8.appendChild(c9);var c7=new Element('div',{className:'c7'});var val=(0.0118*perc*perc2-10+1);if(val<0)val=0;c7.setStyle({width:val+'px'});c9.appendChild(c7);if(entry.items&&(entry.items.length==0)){titleTd.update(titleTd.down().innerHTML);}
if(entry.items&&(entry.items.length>0)){for(var i=0;i<entry.items.length;i++){if(entry.items[i]===false)
entry.items.splice(i,1);}
titleTd.down().addClassName('full');var maxHost=entry.items[0]['hosts'];var maxLimit=entry.items.length;maxLimit=Math.min(maxLimit,this.entryLimit);for(var i=0;i<maxLimit;i++){var result=entry.items[i];if(result===false)continue;var tr=this.createMinTR(result,num,entry.Title);this.tbody.appendChild(tr);}
if(maxLimit!=entry.items.length){var other={hited:0,hosts:0,hosts2:0,executed:0,BrowserVersion:Lang.StatisticsOtherLabel};for(var k=maxLimit;k<entry.items.length;k++){var result=entry.items[k];if(result===false)continue;other.hited+=parseInt(entry.items[k].hited);other.hosts+=parseInt(entry.items[k].hosts);other.hosts2+=parseInt(entry.items[k].hosts2);other.executed+=parseInt(entry.items[k].executed);}
var tr=this.createMinTR(other,num,'Other');this.tbody.appendChild(tr);}}},createMinTR:function(result,num,parentTitle){var tr=new Element('tr',{className:'full'});if(num%2){tr.addClassName('odd');}
if(parentTitle=='Other')tr.addClassName('other');var td=document.createElement('td');td.className='titleFull';var resStr=result['BrowserVersion'];var oldStr=resStr;if(resStr.length>20){resStr=resStr.substr(0,15)+'...'+resStr.substr(-5);}
if(resStr!='/')
td.innerHTML=resStr;else
td.innerHTML=parentTitle;td.setAttribute('title',oldStr);tr.appendChild(td);var td=document.createElement('td');if(result['hited']==null){result['hited']=0;}
if(this.name!='exploits'){td.innerHTML=result['hited'];tr.appendChild(td);var td=document.createElement('td');td.innerHTML=result['hosts'];tr.appendChild(td);}
var td=document.createElement('td');td.innerHTML=result['executed'];tr.appendChild(td);var td=new Element('td').setStyle({textAlign:'right'});if(result['hosts2']!=0){var r=(result['executed']/result['hosts2'])*100;td.innerHTML=r.toFixed(2);}else{td.update('0.00');}
tr.appendChild(td);var td=document.createElement('td');td.className='charttd';tr.appendChild(td);var c_w_l=new Element('div',{className:'chart-w-l'});td.insert(c_w_l);var c2=new Element('div',{className:'c2'});c_w_l.appendChild(c2);var c3=new Element('div',{className:'c3'});c2.appendChild(c3);var perc=0;if(result['hited']!=0)
perc=Math.ceil((result['hosts2']/result['hited'])*100);var div=new Element('div');div.className='chart';if(result['hited']!=0)
div.style.width=perc+'%';else
div.style.width='0%';c3.appendChild(div);var c4=new Element('div',{className:'c4'});c4.setStyle({width:(1.18*perc-6+1)+'px'});div.appendChild(c4);var c5=new Element('div',{className:'c5'});div.appendChild(c5);var c6=new Element('div',{className:'c6'});c5.appendChild(c6);var div2=document.createElement('div');div2.className='hited';var perc2=0;if(result['hosts2']!=0){perc2=Math.ceil((result['executed']/result['hosts2'])*100);}
div2.style.width=perc2+'%';c6.appendChild(div2);var c8=new Element('div',{className:'c8'});div2.appendChild(c8);var c9=new Element('div',{className:'c9'});c8.appendChild(c9);var c7=new Element('div',{className:'c7'});c7.setStyle({width:(0.0118*perc*perc2-6+1)+'px'});c9.appendChild(c7);return tr;},createMinTR2:function(result,num){var tr=new Element('tr',{className:'full'});if(num%2){tr.addClassName('odd');}
tr.insert(new Element('td'));var td=document.createElement('td');td.className='titleFull';var resStr=result['BrowserVersion'];td.innerHTML=resStr;tr.appendChild(td);var td=document.createElement('td');if(result['hited']==null){result['hited']=0;}
if(this.name!='exploits'){td.innerHTML=result['hited'];tr.appendChild(td);var td=document.createElement('td');td.innerHTML=result['hosts'];tr.appendChild(td);}
var td=document.createElement('td');td.innerHTML=result['executed'];tr.appendChild(td);var td=new Element('td').setStyle({textAlign:'right'});if(result['hosts2']!=0){var r=(result['executed']/result['hosts2'])*100;td.innerHTML=r.toFixed(2);}else{td.update('0.00');}
tr.appendChild(td);var td=document.createElement('td');td.className='charttd';tr.appendChild(td);var c_w_l=new Element('div',{className:'chart-w-l'});td.insert(c_w_l);var c2=new Element('div',{className:'c2'});c_w_l.appendChild(c2);var c3=new Element('div',{className:'c3'});c2.appendChild(c3);var perc=0;if(result['hited']!=0)
perc=Math.ceil((result['hosts2']/result['hited'])*100);var div=new Element('div');div.className='chart';if(result['hited']!=0)
div.style.width=perc+'%';else
div.style.width='0%';c3.appendChild(div);var c4=new Element('div',{className:'c4'});c4.setStyle({width:(1.18*perc-6+1)+'px'});div.appendChild(c4);var c5=new Element('div',{className:'c5'});div.appendChild(c5);var c6=new Element('div',{className:'c6'});c5.appendChild(c6);var div2=document.createElement('div');div2.className='hited';var perc2=0;if(result['hosts2']!=0){perc2=Math.ceil((result['executed']/result['hosts2'])*100);}
div2.style.width=perc2+'%';c6.appendChild(div2);var c8=new Element('div',{className:'c8'});div2.appendChild(c8);var c9=new Element('div',{className:'c9'});c8.appendChild(c9);var c7=new Element('div',{className:'c7'});c7.setStyle({width:(0.0118*perc*perc2-6+1)+'px'});c9.appendChild(c7);return tr;},updateBody:function(){while(this.tbody.childNodes.length>=1){this.tbody.removeChild(this.tbody.firstChild);}
var maxIndex=Math.min(this.data.length,this.limit);for(i=0;i<maxIndex;i++){var entry=this.data[i];this.addRow(entry,false,i);}
if(this.data.length==0){this.container.hide();}else{this.container.show();}
var other={Title:this.otherTitle,Hosts:0,Hosts2:0,Hited:0,Executed:0,MaxHosts:0};for(i=maxIndex;i<this.data.length;i++){var entry=this.data[i];other.Hosts+=parseInt(entry.Hosts);other.Hosts2+=parseInt(entry.Hosts2);other.Hited+=parseInt(entry.Hited);other.Executed+=parseInt(entry.Executed);var r=(entry.Hosts2!=0)?entry.Executed/entry.Hosts2:0;entry.Percent=r.toFixed(2);}
if(other.Hosts!=0){this.addRow(other,true);}},init:function(){this.table=document.createElement('table');this.createHead();Element.extend(this.container);this.container.update(this.table);var cook=getCookie('tablefull-'+this.containerName);if(cook!=null){if(cook==0){Controls.shide(this.containerName);}}
return this;}}.init();}
Autoupdater={interval:10,staticParams:'',timer:null,start:function(_interval){this.interval=_interval;Autoupdater.timer=setTimeout(this.update,this.interval*1000);},update:function(){var url=Config.AdminScriptName+'?'+Config.MainParamName+'=RefreshStatistics';var _this=Autoupdater;var fullBrowsers=[];for(var i in Charts.browsersStatus){for(var k in Charts.browsersStatus[i]){if(Charts.browsersStatus[i][k]===false)continue;var browserId=k;fullBrowsers.push('full[]='+browserId);}}
for(var i in Charts.refererStatus){for(var k in Charts.refererStatus[i]){if(Charts.refererStatus[i][k]===false)continue;var id=k;fullBrowsers.push('fullr[]='+id);}}
for(var i in Charts.threadsStatus){for(var k in Charts.threadsStatus[i]){if(Charts.threadsStatus[i][k]===false)continue;var id=k;fullBrowsers.push('fullt[]='+id);}}
for(var i in Charts.exploitsStatus){for(var k in Charts.exploitsStatus[i]){if(Charts.exploitsStatus[i][k]===false)continue;var id=k;fullBrowsers.push('fulle[]='+id);}}
new Ajax.Request(url,{method:'post',postBody:fullBrowsers.join('&')+_this.staticParams,onComplete:function(response){var res=eval(response.responseText);if(!Object.isUndefined(res)){var browsers=res[0];var maxBrowsers=res[1];for(i=0;i<Tables.browsers.data.length;i++){var finded=false;for(j=0;j<browsers.length;j++){if(browsers[j].ID==Tables.browsers.data[i].ID){finded=true;break;}}
if(!finded){Tables.browsers.data.splice(i,1);i--;}}
for(i=0;i<browsers.length;i++){var entry=browsers[i];var j=Tables.browsers.getDataByID(entry.ID);if(j!=-1){Tables.browsers.data[j].Hosts=entry['Hosts'];Tables.browsers.data[j].Hosts2=entry['Hosts2'];Tables.browsers.data[j].Hited=entry['Hited'];Tables.browsers.data[j].Executed=entry['Executed'];Tables.browsers.data[j].MaxHosts=maxBrowsers;}else{Tables.browsers.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Executed:entry['Executed'],Type:'browsers',MaxHosts:maxBrowsers});}}
var oses=res[2];var maxOS=res[3];for(i=0;i<Tables.oses.data.length;i++){var finded=false;for(j=0;j<oses.length;j++){if(oses[j].ID==Tables.oses.data[i].ID){finded=true;break;}}
if(!finded){Tables.oses.data.splice(i,1);i--;}}
for(i=0;i<oses.length;i++){var entry=oses[i];var j=Tables.oses.getDataByID(entry.ID);if(j!=-1){Tables.oses.data[j].Hosts=entry['Hosts'];Tables.oses.data[j].Hosts2=entry['Hosts2'];Tables.oses.data[j].Hited=entry['Hited'];Tables.oses.data[j].Executed=entry['Executed'];Tables.oses.data[j].MaxHosts=maxOS;}else{Tables.oses.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Type:'oses',Executed:entry['Executed'],MaxHosts:maxOS});}}
Tables.oses.realResort(Tables.oses.lastSort,Tables.oses.lastDest);var countries=res[4];var maxCountry=res[5];for(i=0;i<Tables.countries.data.length;i++){var finded=false;for(j=0;j<countries.length;j++){if(countries[j].ID==Tables.countries.data[i].ID){finded=true;break;}}
if(!finded){Tables.countries.data.splice(i,1);i--;}}
for(i=0;i<countries.length;i++){var entry=countries[i];var j=Tables.countries.getDataByID(entry.ID);if(j!=-1){Tables.countries.data[j].Hosts=entry['Hosts'];Tables.countries.data[j].Hosts2=entry['Hosts2'];Tables.countries.data[j].Hited=entry['Hited'];Tables.countries.data[j].Executed=entry['Executed'];Tables.countries.data[j].MaxHosts=maxCountry;}else{Tables.countries.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Type:'countries',Executed:entry['Executed'],MaxHosts:maxCountry});}}
Tables.countries.realResort(Tables.countries.lastSort,Tables.countries.lastDest);var exploits=res[6];var maxExploit=res[7];for(i=0;i<Tables.exploits.data.length;i++){var finded=false;for(j=0;j<exploits.length;j++){if(exploits[j].ID==Tables.exploits.data[i].ID){finded=true;break;}}
if(!finded){Tables.exploits.data.splice(i,1);i--;}}
for(i=0;i<exploits.length;i++){var entry=exploits[i];var j=Tables.exploits.getDataByID(entry.ID);if(j!=-1){Tables.exploits.data[j].Hosts=entry['Hosts'];Tables.exploits.data[j].Hosts2=entry['Hosts2'];Tables.exploits.data[j].Hited=entry['Hited'];Tables.exploits.data[j].Executed=entry['Executed'];Tables.exploits.data[j].MaxHosts=maxExploit;}else{Tables.exploits.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Type:'exploits',Executed:entry['Executed'],MaxHosts:maxExploit});}}
Tables.exploits.realResort(Tables.exploits.lastSort,Tables.exploits.lastDest);var referers=res[8];if(referers){for(i=0;i<Tables.referers.data.length;i++){var finded=false;for(j=0;j<referers.length;j++){if(referers[j].ID==Tables.referers.data[i].ID){finded=true;break;}}
if(!finded){Tables.referers.data.splice(i,1);i--;}}
for(i=0;i<referers.length;i++){var entry=referers[i];var j=Tables.referers.getDataByID(entry.ID);if(j!=-1){Tables.referers.data[j].Hosts=entry['Hosts'];Tables.referers.data[j].Hosts2=entry['Hosts2'];Tables.referers.data[j].Hited=entry['Hited'];Tables.referers.data[j].Executed=entry['Executed'];Tables.referers.data[j].MaxHosts=null;}else{Tables.referers.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Executed:entry['Executed'],Type:'referers',MaxHosts:maxExploit});}}
Tables.referers.realResort(Tables.referers.lastSort,Tables.referers.lastDest);}
var threads=res[9];if(threads){for(i=0;i<Tables.threads.data.length;i++){var finded=false;for(j=0;j<threads.length;j++){if(threads[j].ID==Tables.threads.data[i].ID){finded=true;break;}}
if(!finded){Tables.threads.data.splice(i,1);i--;}}
for(i=0;i<threads.length;i++){var entry=threads[i];var j=Tables.threads.getDataByID(entry.ID);if(j!=-1){Tables.threads.data[j].Hosts=entry['Hosts'];Tables.threads.data[j].Hosts2=entry['Hosts2'];Tables.threads.data[j].Hited=entry['Hited'];Tables.threads.data[j].Executed=entry['Executed'];Tables.threads.data[j].MaxHosts=null;}else{Tables.threads.data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hosts2:entry['Hosts2'],Hited:entry['Hited'],Executed:entry['Executed'],Type:'threads',MaxHosts:maxExploit});}}
Tables.threads.realResort(Tables.threads.lastSort,Tables.threads.lastDest);}
var fulls=res[10];for(var i=0;i<fulls.length;i++){var browserId=fulls[i][0];var entries=fulls[i][1];var j=Tables.browsers.getDataByID(browserId);if((Tables.browsers.data[j].items!=null)&&(j!=-1))
Tables.browsers.data[j].items=entries;for(var el in Tables){if(Charts.browsersStatus[el]){if(Charts.browsersStatus[el][browserId]){var j=Tables[el].getDataByIDAndType(browserId,'browsers');if(j!=-1){if(Tables[el].data[j].items!=null)
Tables[el].data[j].items=entries;}}}};}
Tables.browsers.realResort(Tables.browsers.lastSort,Tables.browsers.lastDest);var fullt=res[11];for(var i=0;i<fullt.length;i++){var browserId=fullt[i][0];var entries=fullt[i][1];var j=Tables.threads.getDataByID(browserId);if(j!=-1)
Tables.threads.data[j].items=entries;for(var el in Tables){if(Charts.threadsStatus[el]){if(Charts.threadsStatus[el][browserId]){var j=Tables[el].getDataByIDAndType(browserId,'threads');if(j!=-1){if(Tables[el].data[j].items!=null)
Tables[el].data[j].items=entries;}}}};}
Tables.threads.realResort(Tables.threads.lastSort,Tables.threads.lastDest);var fulle=res[12];for(var i=0;i<fulle.length;i++){var browserId=fulle[i][0];var entries=fulle[i][1];var j=Tables.exploits.getDataByID(browserId);if(j!=-1)
Tables.exploits.data[j].items=entries;for(var el in Tables){if(Charts.exploitsStatus[el]){if(Charts.exploitsStatus[el][browserId]){var j=Tables[el].getDataByIDAndType(browserId,'exploits');if(j!=-1){if(Tables[el].data[j].items!=null)
Tables[el].data[j].items=entries;}}}};}
Tables.exploits.realResort(Tables.exploits.lastSort,Tables.exploits.lastDest);var fullsr=res[13];for(var i=0;i<fullsr.length;i++){var refererDomain=fullsr[i][0];var entries=fullsr[i][1];var j=Tables.referers.getDataByTitle(refererDomain);if(j!=-1){Tables.referers.data[j].items=entries;}
for(var el in Tables){if(Charts.refererStatus[el]){if(Charts.refererStatus[el][refererDomain]){var j=Tables[el].getDataByTitleAndType(refererDomain,'referers');if(j!=-1){if(Tables[el].data[j].items!=null)
Tables[el].data[j].items=entries;}}}};}
Tables.browsers.realResort(Tables.browsers.lastSort,Tables.browsers.lastDest);var offset=14;var hosts=res[offset];var hosts2=res[offset+1];var hits=res[offset+2];var loads=res[offset+3];$('hostsTotal').update(hosts);$('hitsTotal').update(hits);$('executedTotal').update(loads);var val=(loads/hosts2)*100;val=(isNaN(val))?0:val;if(val<0)val=0;val=val.toFixed(2);$('percentTotal').update(val+'%');var perc=Math.floor((hosts/hits)*100);$('totalChart1').setStyle({width:perc+'%'});$('totalChart1_1').setStyle({width:Math.ceil(4.7*perc-18)+'px'});$('totalChart2').setStyle({width:val+'%',opacity:((val==0)?'0':'1')});var val2=Math.ceil(0.047*perc*val-18);$('totalChart2_1').setStyle({width:((val2<0)?0:val2)+'px'});var hosts=res[offset+4];var hosts2=res[offset+5];var hits=res[offset+6];var loads=res[offset+7];$('hostsTotal2').update(hosts);$('hitsTotal2').update(hits);$('executedTotal2').update(loads);var val=(loads/hosts2)*100;val=(isNaN(val))?0:val;if(val<0)val=0;val=val.toFixed(2);$('percentTotal2').update(val+'%');var perc=Math.floor((hosts/hits)*100);$('todayChart1').setStyle({width:perc+'%'});$('todayChart1_1').setStyle({width:Math.ceil(4.7*perc-10)+'px'});$('todayChart2').setStyle({width:val+'%',opacity:((val==0)?'0':'1')});var val2=Math.ceil(0.047*perc*val-10);$('todayChart2_1').setStyle({width:((val2<0)?0:val2)+'px'});for(var k=offset+8;k<res.length;k+=3){var id=res[k];var maxHosts=res[k+1];var data=res[k+2];for(i=0;i<Tables['widgets-'+id].data.length;i++){var finded=false;for(j=0;j<data.length;j++){if(data[j].ID==Tables['widgets-'+id].data[i].ID){finded=true;break;}}
if(!finded){Tables['widgets-'+id].data.splice(i,1);i--;}}
for(i=0;i<data.length;i++){var entry=data[i];var j=Tables['widgets-'+id].getDataByIDAndType(entry.ID,entry.Type);if(j!=-1){Tables['widgets-'+id].data[j].Hosts=entry['Hosts'];Tables['widgets-'+id].data[j].Hited=entry['Hited'];Tables['widgets-'+id].data[j].Executed=entry['Executed'];Tables['widgets-'+id].data[j].MaxHosts=maxHosts;}else{Tables['widgets-'+id].data.push({ID:entry['ID'],Title:entry['Title'],Hosts:entry['Hosts'],Hited:entry['Hited'],Executed:entry['Executed'],MaxHosts:maxHosts});}}
Tables['widgets-'+id].realResort(Tables['widgets-'+id].lastSort,Tables['widgets-'+id].lastDest);}}
Autoupdater.timer=setTimeout(Autoupdater.update,Autoupdater.interval*1000);}});}}
Charts={browsersStatus:{},refererStatus:{},threadsStatus:{},exploitsStatus:{},loadFullBrowser:function(url,params,name,withoutToggle,_table){if(Object.isUndefined(this.browsersStatus[_table])){this.browsersStatus[_table]={};}
var id=name;var table=(_table!='browsers')?Tables[_table]:Tables.browsers;setCookie('full-'+id,1);if(this.browsersStatus[_table][name]&&!withoutToggle){setCookie('full-'+id,0);var j=(_table!='browsers')?table.getDataByIDAndType(id,'browsers'):table.getDataByID(id);table.data[j].items=null;this.browsersStatus[_table][name]=false;table.sort();return;}
this.browsersStatus[_table][name]=1;new Ajax.Request(url,{method:'post',postBody:params,onComplete:function(response){var reses=eval(response.responseText);var res=reses[1];var browserId=reses[0];var j=(_table!='browsers')?table.getDataByIDAndType(browserId,'browsers'):table.getDataByID(browserId);table.data[j].items=res;table.sort();return;}});},loadFullReferer:function(url,params,name,withoutToggle,_table){if(Object.isUndefined(this.refererStatus[_table])){this.refererStatus[_table]={};}
var id=name;var table=(_table!='referers')?Tables[_table]:Tables.referers;if(getCookie('fullr-'+id)==1){this.refererStatus[_table][name]=1;}
setCookie('fullr-'+id,1);if(this.refererStatus[_table][name]&&!withoutToggle){setCookie('fullr-'+id,0);var j=(_table!='referers')?table.getDataByTitleAndType(id,'referers'):table.getDataByTitle(id);table.data[j].items=null;this.refererStatus[_table][name]=false;table.sort();return;}
this.refererStatus[_table][name]=1;new Ajax.Request(url,{method:'post',postBody:params,onComplete:function(response){var reses=eval(response.responseText);var res=reses[1];var browserId=reses[0];var j=(_table!='referers')?table.getDataByIDAndType(browserId,'referers'):table.getDataByID(browserId);table.data[j].items=res;table.sort();return;}});},loadFullThread:function(url,params,name,withoutToggle,_table){if(Object.isUndefined(this.threadsStatus[_table])){this.threadsStatus[_table]={};}
var id=name;var table=Tables[_table];if(getCookie('fullt-'+id)==1){this.threadsStatus[_table][name]=1;}
setCookie('fullt-'+id,1);if(this.threadsStatus[_table][name]&&!withoutToggle){setCookie('fullt-'+id,0);var j=table.getDataByIDAndType(id,'threads');table.data[j].items=null;this.threadsStatus[_table][name]=false;table.sort();return;}
this.threadsStatus[_table][name]=1;new Ajax.Request(url,{method:'post',postBody:params,onComplete:function(response){var reses=eval(response.responseText);var res=reses[1];var browserId=reses[0];var j=table.getDataByIDAndType(browserId,'threads');table.data[j].items=res;table.sort();return;}});},loadFullExploit:function(url,params,name,withoutToggle,_table){if(Object.isUndefined(this.exploitsStatus[_table])){this.exploitsStatus[_table]={};}
var id=name;var table=Tables[_table];if(getCookie('fulle-'+id)==1){this.exploitsStatus[_table][name]=1;}
setCookie('fulle-'+id,1);if(this.exploitsStatus[_table][name]&&!withoutToggle){setCookie('fulle-'+id,0);var j=table.getDataByIDAndType(id,'exploits');table.data[j].items=null;this.exploitsStatus[_table][name]=false;table.sort();return;}
this.exploitsStatus[_table][name]=1;new Ajax.Request(url,{method:'post',postBody:params,onComplete:function(response){var reses=eval(response.responseText);var res=reses[1];var browserId=reses[0];var j=table.getDataByIDAndType(browserId,'exploits');table.data[j].items=res;table.sort();return;}});}}
Controls={shide:function(name){var el=$($$('#'+name+' tbody')[0]);var tr1=$($$('#'+name+' tr.minimized')[0]);var tr2=$($$('#'+name+' tr.normal')[0]);if(el.visible()){setCookie('tablefull-'+name,0);el.hide();tr2.hide();tr1.show();}else{setCookie('tablefull-'+name,1);el.show();tr1.hide();tr2.show();}},maximaze:function(name){if(name=='os')name='oses';var table=Tables[name];$('fullWidgetContainer').update(table.drawFull());Widgets.fullWidgetContainer.open();}}
Widgets={blocks:['browsers','oses','countries','threads'],addWidgetWindow:null,editID:null,allCheck:null,toggle:function(id,type,img){var el=$(id);var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');var e=$('r'+id);if(e!=null)e.remove();}else{u.addClassName('selected');var str='';if(img){str+='<img src="'+Config.ImgPath+'icons/'+img+'" width="16px" '+((type=='countries')?'height="11px"':'height="16px"')+'/>';}
var d=new Element('div',{className:'trimmed'}).update(el.innerHTML);var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);var str=d.innerHTML;if(str.length>30){d.setAttribute('title',str);d.update(str.substr(0,30)+'...');}}
if(typeof scrollbar2=='undefined')
scrollbar2=new Control.ScrollBar('resultsDiv','scrollbar_track_result');if(this.allCheck==null){if(type=='countries'){var l=$$('#countriesResult li').length;var el=$('allCountries');var el2=$('countriesResult');if(l==252){el.show();el2.hide();}else{if(el.visible()){el.hide();el2.show();}}}}
scrollbar2.recalculateLayout();},recheck:function(){var l=$$('#countriesResult li').length;var el=$('allCountries');var el2=$('countriesResult');if(l==252){el.show();el2.hide();}else{if(el.visible()){el.hide();el2.show();}}
scrollbar2.recalculateLayout();},type:function(){var t='';this.blocks.each(function(el){if($(el).up().up().up().hasClassName('active')){t=el;}});return t;},realCheckAll:function(event,arr,start,length){var end=Math.min(arr.length,start+length);for(var i=start;i<end;i++){var el=arr[i];if(!el.hasClassName('selected')){el.onclick();}}
if(i<arr.length){setTimeout(this.realCheckAll.bindAsEventListener(this,arr,end,length),10);}else{this.allCheck=null
this.recheck();}},checkAll:function(){var type=this.type();if(type=='countries'){var el=$('allCountries');var el2=$('countriesResult');el.show();el2.hide();}
this.allCheck=true;var arr=$$('#'+type+'Div li');setTimeout(this.realCheckAll.bindAsEventListener(this,arr,0,10),10);},realUncheckAll:function(event,arr,start,length){var end=Math.min(arr.length,start+length);for(var i=start;i<end;i++){var el=arr[i];if(el.hasClassName('selected')){el.onclick();}}
if(i<arr.length){setTimeout(this.realUncheckAll.bindAsEventListener(this,arr,end,length),10);}else{this.allCheck=null}},uncheckAll:function(){var type=this.type();$(type+'Result').update();this.recheck();this.allCheck=true;var arr=$$('#'+type+'Div li');setTimeout(this.realUncheckAll.bindAsEventListener(this,arr,0,10),10);},show:function(type){this.blocks.each(function(el){$(el).up().up().up().removeClassName('active');$(el+'Div').hide();});$(type).up().up().up().addClassName('active');var el=$(type+'Div');el.show();if(typeof scrollbar=='undefined')
scrollbar=new Control.ScrollBar('countriesDiv','scrollbar_track_countries');scrollbar.recalculateLayout();this.filter();},edit:function(id){this.editID=id;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=editWidget',{method:'post',postBody:'widgetID='+id,onComplete:function(t){$('addWidgetContainer').update(t.responseText);Widgets.addWidgetWindow.open();Event.observe('addWidgetClose','click',function(){Widgets.addWidgetWindow.close();});}});},close:function(id){Alert.confirm(Titles.CloseAskLabel,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=closeWidget',{method:'post',postBody:'id='+id,onComplete:function(t){$('widget-'+id).remove();}});});},save:function(){var arr=[];this.blocks.each(function(el){arr.push(el+'='+$$('#'+el+'Result li div div div').pluck('innerHTML').join(','));});arr.push('title='+$F('newWidgetTitle'));if(this.editID!=null){arr.push('widgetID='+this.editID);}
var postBody=arr.join('&');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addWidgetSave',{method:'post',postBody:postBody,onComplete:function(t){Widgets.addWidgetWindow.close();var container=$('portal-column-block-list').update(t.responseText);}});},filter:function(){var str=$F('searchStr').toLowerCase();var type=this.type();$$('#'+type+'Div li').each(function(el){var text=el.down().innerHTML.toLowerCase();if((str=='')||(text.indexOf(str)!==-1))
el.show();else
el.hide();el.removeClassName('odd');});var k=-1;$$('#'+type+'Div li').findAll(function(el){if(el.visible()){k++;if(k%2)return true;}return false;}).each(function(el){el.addClassName('odd');});},showSearch:function(){var el=$('searchStr');var el2=el.up();if(!el2.visible()){el2.show();el.focus();new Effect.Tween(el,0,267,{duration:0.5,transition:Effect.Transitions.sinoidal},function(p){el.style.width=p+'px'});}else{$('searchStr').value='';this.filter();new Effect.Tween(el,267,0,{duration:0.5,transition:Effect.Transitions.sinoidal,afterFinish:function(){el2.hide();}},function(p){el.style.width=p+'px'});}}}
﻿Threads={actionType:null,ruleID:null,threadID:null,trafficType:null,resort:function(el){var arr=[];for(var i=0;i<el.options.length;i++){var op=el.options[i];arr.push({value:op.value,text:op.text});};arr.sort(function(a,b){if(a.text>b.text)return 1;if(a.text<b.text)return-1;return 0;});el.update();arr.each(function(a){el.insert(new Element('option',{value:a.value}).update(a.text));});},selectedCountries:{},allCheck:null,addCountry:function(id,type,img){$('selectedCountries').removeClassName('disabled');var el=$(id);var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');var e=$('r'+id);if(e!=null)e.remove();delete this.selectedCountries[el.innerHTML];if($('countriesResult').childElements().length==0)
$('selectedCountries').addClassName('disabled');}else{u.addClassName('selected');var str='';if(img){str+='<img src="'+Config.ImgPath+'icons/'+img+'" width="16px"/>';}
var d=new Element('div').update(el.innerHTML);this.selectedCountries[el.innerHTML]=id.replace('countries_','');;var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);if(d.getWidth()>125){d.addClassName('trimmed');li.insert('...');}}
if(this.allCheck==null){var l=$$('#countriesResult li').length;var el=$('allCountries');var el2=$('countriesResult');if(l==252){el.show();el2.hide();}else{if(el.visible()){el.hide();el2.show();}}}
scrollbar.recalculateLayout();},selectedBrowsers:{},addBrowser:function(id,type,img){$('selectedBrowsers').removeClassName('disabled');var el=$(id);var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');var e=$('r'+id);if(e!=null)e.remove();delete this.selectedBrowsers[el.innerHTML];if($('browsersResult').childElements().length==0)
$('selectedBrowsers').addClassName('disabled');}else{u.addClassName('selected');var str='';if(img){str+='<img src="'+Config.ImgPath+'icons/'+img+'" width="16px"/>';}
var d=new Element('div').update(el.innerHTML);this.selectedBrowsers[el.innerHTML]=id.replace('browser-','');;var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);if(d.getWidth()>125){d.addClassName('trimmed');li.insert('...');}}
scrollbar2.recalculateLayout();},selectedOS:{},addOS:function(id,type,img){$('selectedOS').removeClassName('disabled');var el=$(id);var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');var e=$('r'+id);if(e!=null)e.remove();delete this.selectedOS[el.innerHTML];if($('osesResult').childElements().length==0)
$('selectedOS').addClassName('disabled');}else{u.addClassName('selected');var str='';if(img){str+='<img src="'+Config.ImgPath+'icons/'+img+'" width="16px"/>';}
var d=new Element('div').update(el.innerHTML);this.selectedOS[el.innerHTML]=id.replace('oses-','');;var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);if(d.getWidth()>125){d.addClassName('trimmed');li.insert('...');}}
scrollbar3.recalculateLayout();},selectedFiles:{},addFile:function(id,type,limit){$('selectedFiles').removeClassName('disabled');var el=this.step2.select('#'+id)[0];if(el==null)return;var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');$('r'+id).remove();delete this.selectedFiles[el.innerHTML];if($('filesResult').childElements().length==0)
$('selectedFiles').addClassName('disabled');}else{u.addClassName('selected');var str='';var d=new Element('div').update(el.innerHTML);this.selectedFiles[el.innerHTML]=id.replace('files_','');;var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);}
Sortable.create(this.step2.select('#filesResult')[0],{tag:'li'});if(typeof scrollbar5=='undefined')
scrollbar5=new Control.ScrollBar('selectedFiles','scrollbar_track_files');scrollbar5.recalculateLayout();},uploaded:function(){$('fileUpload').value='';var body=$('upload_target').contentDocument;var el=body.getElementById('result');if(el==null)return;var result=el.innerHTML;var arr=result.split('::');var id=arr[0];var title=arr[1];var ul=$('filesList').down();var count=ul.childElements().length;var li=new Element('li');li.onclick=function(){Threads.addFile('files_'+id,'files')}
if(count%2)li.addClassName('odd');ul.insert(li);li.insert(new Element('a',{id:'files_'+id}).update(title));li.onclick();if(typeof scrollbar5_2=='undefined')
scrollbar5_2=new Control.ScrollBar('filesList','scrollbar_track_files2');scrollbar5_2.recalculateLayout();},addFileFromSelect:function(){this.addFile($F('fileSelect'));},deleteFile:function(name,div){div.remove();delete this.selectedFiles[name];},selectedIP:{},addRealIP:function(name){if(!this.selectedIP[name]){$('selectedIP').removeClassName('disabled');var str='';str+='<img src="'+Config.ImgPath+'icons/ip.gif" width="15px"/>';var d=new Element('div').update(name);this.selectedIP[name]=1;var _this=this;var li=new Element('li');li.insert(str).insert(d);li.insert(new Element('div',{className:'trash'}).observe('click',function(){_this.deleteIP(name,li);}));$('ipResult').insert(li);scrollbar4.recalculateLayout();}},addIP:function(event){var res=[$F('IPText1'),$F('IPText2'),$F('IPText3'),$F('IPText4')];$('IPText1').value='';$('IPText2').value='';$('IPText3').value='';$('IPText4').value='';$('IPText1').focus();good=true;for(var i=0;i<res.length;i++){if(res[i].indexOf('*')!=-1){res[i]='*';}else{res[i]=parseInt(res[i]);if(isNaN(res[i]))
res[i]='*';else
if(res[i]>255)good=false;}}
var name=res.join('.');if(good){this.addRealIP(name);}
return false;},deleteIP:function(name,div){div.remove();delete this.selectedIP[name];scrollbar4.recalculateLayout();if($('ipResult').childElements().length==0)
$('selectedIP').addClassName('disabled');},selectedExploits:{},addExploit:function(id,type,img){$('selectedExploits').removeClassName('disabled');var el=$(id);var u=el.up();if(u.hasClassName('selected')){u.removeClassName('selected');var e=$('r'+id);if(e!=null)e.remove();delete this.selectedExploits[el.innerHTML];if($('exploitsResult').childElements().length==0)
$('selectedExploits').addClassName('disabled');}else{u.addClassName('selected');var str='';if(img){str+='<img src="'+Config.ImgPath+'icons/'+img+'" width="16px"/>';}
var d=new Element('div').update(el.innerHTML);this.selectedExploits[el.innerHTML]=id.replace('exploits_','');;var li=new Element('li',{id:'r'+id});var div1=new Element('div',{className:'div1'});var div2=new Element('div',{className:'div2'});li.insert(div1);div1.insert(div2);div2.insert(str).insert(d);div1.insert(new Element('div',{className:'trash'}).observe('click',u.onclick));$(type+'Result').insert(li);if(d.getWidth()>50){d.addClassName('trimmed');li.insert('...');}}},resortRedirect:function(){var arr=$$('#redirectsResult li input');arr.each(function(el){el.enable();});if(arr.length>0){var el=arr.last();el.value='∞';el.disable();}},addRealRedirect:function(url,limit,dontResort,id){url=url.replace('http://','');var arr=$$('#redirectsResult li');var d=new Element('div',{className:'redirect'}).update(url);var li=new Element('li').insert(d);if(id){li.id='redirect_'+id;}else{li.id='redirect_0';}
var inp=new Element('input',{value:(limit!=-1)?limit:'∞'});inp.observe('click',function(){inp.select();});li.insert(inp);li.insert(new Element('img',{src:Config.ImgPath+'trash.png',width:'9px',height:'9px'}).observe('click',function(){Threads.delRedirect(li)}));li.insert(new Element('div',{className:'infin'}).observe('click',function(){inp.value='∞';}).update('<img src="'+Config.ImgPath+'infin.png" width="13px" height="5px"/>'));$('redirectsResult').insert(li);Sortable.create(this.step3.select('#redirectsResult')[0],{tag:'li',onUpdate:this.resortRedirect.bindAsEventListener(this)});if(!dontResort)
this.resortRedirect();},addRedirect:function(){var url=$('redirectUrl').value;$('redirectUrl').value='';$('redirectUrl').focus();if(url=='')return false;this.addRealRedirect(url,'');return false;},delRedirect:function(el){el.remove();this.resortRedirect();},edit:function(_ruleID,undeletable){$('addThreadContainer').setStyle({width:'664px'});this.selectedCountries={};this.selectedBrowsers={};this.selectedOS={};this.selectedExploits={};this.selectedFiles={};this.selectedIP={};this.actionType='edit';this.ruleID=_ruleID;this.threadID=null;this.step1=null;this.step2=null;this.step3=null;var _this=this;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addRule',{method:'post',postBody:'ruleID='+this.ruleID,onComplete:function(t){var el=$('addThreadContainer');el.update(t.responseText);scrollbar=new Control.ScrollBar('selectedCountries','scrollbar_track_countries');scrollbar2=new Control.ScrollBar('selectedBrowsers','scrollbar_track_browsers');scrollbar3=new Control.ScrollBar('selectedOS','scrollbar_track_oses');Event.observe('addThreadClose','click',function(){addThreadWindow.close();});_this.step1=$('addThreadContainer').down();if(undeletable){_this.next(true);}else{addThreadWindow.open();scrollbar_2=new Control.ScrollBar('countriesList','scrollbar_track_countries2');scrollbar2_2=new Control.ScrollBar('browsersList','scrollbar_track_browsers2');scrollbar3_2=new Control.ScrollBar('osesList','scrollbar_track_oses2');}}});},step1:null,step2:null,step3:null,toExploits:function(doShow){var container=$('addThreadContainer');var _this=this;if(this.step2){if(container.getWidth()!=504)
container.setStyle({width:'504px',left:(parseInt(container.style.left)+72)+'px'});$('addThreadContainer').update(this.step2);Sortable.create(_this.step2.select('#filesResult')[0],{tag:'li'});if(typeof scrollbar5_2=='undefined')
scrollbar5_2=new Control.ScrollBar('filesList','scrollbar_track_files2');}else{var body=null;if(this.ruleID!=null)body='ruleID='+this.ruleID;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addRule2',{method:'post',postBody:body,onComplete:function(t){container.update(t.responseText);_this.step2=container.down();if(container.getWidth()!=504)
container.setStyle({width:'504px',left:(parseInt(container.style.left)+72)+'px'});Event.observe('addThreadClose','click',function(){addThreadWindow.close();});if(doShow){addThreadWindow.open();}
if(body==null)
Threads.checkAll('exploits');if(typeof scrollbar5_2=='undefined')
scrollbar5_2=new Control.ScrollBar('filesList','scrollbar_track_files2');}});}},toRedirects:function(doShow){var container=$('addThreadContainer');var _this=this;if(this.step3){if(container.getWidth()!=504)
container.setStyle({width:'504px',left:(parseInt(container.style.left)+72)+'px'});$('addThreadContainer').update(this.step3);Sortable.create(_this.step3.select('#redirectsResult')[0],{tag:'li'});$('redirectUrl').focus();}else{var body=null;if(this.ruleID!=null)body='ruleID='+this.ruleID;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addRule3',{method:'post',postBody:body,onComplete:function(t){var container=$('addThreadContainer');container.update(t.responseText);_this.step3=container.down();if(container.getWidth()!=504)
container.setStyle({width:'504px',left:(parseInt(container.style.left)+72)+'px'});if(doShow){addThreadWindow.open();}
Event.observe('addThreadClose','click',function(){addThreadWindow.close();});$('redirectUrl').focus();}});}},next:function(doShow){this.step1=$('addThreadContainer').down();var _this=this;this.trafficType=$F('TrafficType');var el=$('addThreadContainer');if($('nextExploit').checked){this.toExploits(doShow);}else{this.toRedirects(doShow);}},prev:function(){var el=$('addThreadContainer');el.update(this.step1);el.setStyle({width:'664px',left:(parseInt(el.style.left)-72)+'px'});},submit:function(isRedirect){var body=[];var arr=[]
for(var i in this.selectedCountries){var id=this.selectedCountries[i];arr.push(id);}
body.push('countries='+arr.join(','));var arr=[]
for(var i in this.selectedIP){arr.push(i);}
body.push('ip='+arr.join(','));var arr=[]
for(var i in this.selectedBrowsers){arr.push(this.selectedBrowsers[i]);}
body.push('browsers='+arr.join(','));var _this=this;var arr=[]
for(var i in this.selectedOS){var id=this.selectedOS[i];arr.push(id);}
body.push('os='+arr.join(','));body.push('trafficType='+this.trafficType);body.push('isRedirect='+((isRedirect)?'1':'0'));if(isRedirect){var arr=[]
var k=0;$$('#redirectsResult li').each(function(el){var title=el.down().innerHTML;var limit=el.down().next().value;if(limit=='')limit=-1;arr.push('redirectID['+k+']='+el.id.replace('redirect_',''));arr.push('redirectTitle['+k+']='+title);arr.push('redirectLimit['+k+']='+limit);k++;});if(arr.length==0){Alert.confirm(Lang.RedirectsNotSelected,null,function(){});return;}
body.push(arr.join('&'));}else{var arr=[]
for(var i in this.selectedExploits){arr.push(this.selectedExploits[i]);}
var selE=arr.length==0;body.push('exploits='+arr.join(','));var arr=[]
$$('#filesResult li').each(function(el){var id=el.id.replace('rfiles_','');var limit=-1;arr.push('files['+id+']='+limit);});var selF=arr.length==0;if(selF||selE){var str=Lang.NotAllSelected;Alert.confirm(str,null,function(){});return;}
body.push(arr.join('&'));}
if(this.threadID)
body.push('threadID='+this.threadID);if($('threadTitle')!=null){var title=$F('threadTitle');if(title==''){title='untitled';}
body.push('threadTitle='+title);}
if(this.actionType=='edit'){body.push('ruleID='+this.ruleID);}
new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=saveRule',{method:'post',postBody:body.join('&'),onComplete:function(t){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=threadsAjax',{method:'post',postBody:'',onComplete:function(t){$('data').update(t.responseText);_this.makeSortable();}});addThreadWindow.close();}});},makeSortable:function(){$$('#data div.thread div.rules').each(function(el){Sortable.create(el,{tag:'div',handle:'rule_title',onUpdate:function(container){if($('addThreadContainer').visible())return;var k=0;var arr=container.select('div.rule');var c=arr.length%2;arr.each(function(el2){if(k%2==c){el2.addClassName('odd');}else{el2.removeClassName('odd');}
k++;});var body=[];$$('#data div.thread').each(function(el){var threadId=el.id.replace('thread','');var res=[];el.select('div.rules > div').each(function(el2){res.push(el2.id.replace('rule_',''));});body.push(threadId+'='+res.join(','));});new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=reorderRules',{method:'post',postBody:body.join('&'),onComplete:function(t){}});}});});},addExploitReal:function(id,name){Threads.selectedExploits[name]=id;},addRule:function(id){this.step1=null;this.step2=null;this.step3=null;this.threadID=id;this.ruleID=null;var _this=this;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addRule',{method:'post',postBody:'type=add',onComplete:function(t){$('addThreadContainer').setStyle({width:'664px'});$('addThreadContainer').update(t.responseText);addThreadWindow.open();Threads.actionType='add';Threads.selectedCountries={};Threads.selectedBrowsers={};Threads.selectedOS={};Threads.selectedFiles={};Threads.selectedIP={};Threads.step1=null;Threads.step2=null;_this.step1=$('addThreadContainer').down();scrollbar=new Control.ScrollBar('selectedCountries','scrollbar_track_countries');scrollbar2=new Control.ScrollBar('selectedBrowsers','scrollbar_track_browsers');scrollbar3=new Control.ScrollBar('selectedOS','scrollbar_track_oses');scrollbar_2=new Control.ScrollBar('countriesList','scrollbar_track_countries2');scrollbar2_2=new Control.ScrollBar('browsersList','scrollbar_track_browsers2');scrollbar3_2=new Control.ScrollBar('osesList','scrollbar_track_oses2');Event.observe('addThreadClose','click',function(){addThreadWindow.close();});}});},textChange:function(name){var doNext=false;var el=$(name);var text=$F(el);if(text.indexOf('.')!=-1){text=text.replace('.','');el.value=text;doNext=true;}
if(text.length==3){doNext=true;}
if(doNext){var nameId=parseInt(name.replace('IPText',''))+1;var next=$('IPText'+nameId);if(next!=null){next.focus();}}},playPauseThread:function(ruleID){var el=$$('#rule_'+ruleID+' .play')[0];var state=-1;if(el.hasClassName('pause')){el.removeClassName('pause');state=1;}else{el.addClassName('pause');state=0;}
new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=playPauseRule',{method:'post',postBody:'ruleID='+ruleID+'&state='+state,onComplete:function(t){var r=$('rule_'+ruleID);if(state){r.removeClassName('paused');}
if(!state){r.addClassName('paused');}}});},addThread:function(){var title=$F('threadTitle');if(title=='')return;var body='threadTitle='+title;if(this.lastThreadID!=null){body+='&lastId='+this.lastThreadID;}
body+='&copyThreadID='+$F('threadCopy');var _this=this;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=saveThread',{method:'post',postBody:body,onComplete:function(t){t.responseText.evalScripts();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=threadsAjax',{method:'post',postBody:'',onComplete:function(t){$('data').update(t.responseText);_this.makeSortable();}});addRealThreadWindow.close();}});return false;},lastThreadID:null,editThread:function(threadId,name){this.lastThreadID=threadId;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addThread',{method:'post',postBody:null,onComplete:function(t){$('addRealThreadContainer').update(t.responseText);addRealThreadWindow.open();$('threadTitle').value=name;$('threadTitle').setStyle({width:'363px'});$('threadCopy').hide();$('threadTitle').focus();Event.observe('addRealThreadClose','click',function(){addRealThreadWindow.close();});}});},delThread:function(threadId){var _this=this;Alert.confirm(Lang.CloseAskLabel,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=delThread',{method:'post',postBody:'threadId='+threadId,onComplete:function(t){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=threadsAjax',{method:'post',postBody:'',onComplete:function(t){$('data').update(t.responseText);_this.makeSortable();}});}});});},delRule:function(threadId,ruleId){var _this=this;Alert.confirm(Lang.CloseAskLabel,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=delRule',{method:'post',postBody:'threadId='+threadId+'&ruleId='+ruleId,onComplete:function(t){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=threadsAjax',{method:'post',postBody:'',onComplete:function(t){$('data').update(t.responseText);_this.makeSortable();}});}});});},moreLinkFind:function(){$$('.moreLink').each(function(el){var el2=el.next().next().next();el.observe('click',function(){if(el2.visible()){el2.hide();el.next().src=Config.ImgPath+'more.png';}else{el2.show();el.next().src=Config.ImgPath+'less.png';}});});},toggleAll:function(thread,rule){rule=rule.replace('rule','rule_');var el2=$$('#'+thread+' #'+rule+' .max')[0];$$('#'+thread+' #'+rule+' .block_content').each(function(div){var el=div.select('ul')[0];var a=div.select('.moreLink')[0];if(el==null)return;if(el.hasAttribute('locked'))return;if(el2.hasClassName('min')){if(el.visible()){a.next().src=Config.ImgPath+'more.png';el.hide();}}else{if(!el.visible()){a.next().src=Config.ImgPath+'less.png';el.show();}}});if(el2.hasClassName('min'))
el2.removeClassName('min');else
el2.addClassName('min');},filter:function(){var str=$F('searchStr').toLowerCase();$$('#countriesList li').each(function(el){var text=el.down().innerHTML.toLowerCase();if((str=='')||(text.indexOf(str)!==-1))
el.show();else
el.hide();el.removeClassName('odd');});var k=-1;$$('#countriesList li').findAll(function(el){if(el.visible()){k++;if(k%2)return true;}return false;}).each(function(el){el.addClassName('odd');});},showSearch:function(){var el=$('searchStr');var el2=el.up();if(!el2.visible()){el2.show();el.focus();new Effect.Tween(el,0,186,{duration:0.5,transition:Effect.Transitions.sinoidal},function(p){el.style.width=p+'px'});}else{$('searchStr').value='';this.filter();new Effect.Tween(el,186,0,{duration:0.5,transition:Effect.Transitions.sinoidal,afterFinish:function(){el2.hide();}},function(p){el.style.width=p+'px'});}},realCheckAll:function(event,arr,start,length){var end=Math.min(arr.length,start+length);for(var i=start;i<end;i++){var el=arr[i];if(!el.hasClassName('selected')){el.onclick();}}
if(i<arr.length){setTimeout(this.realCheckAll.bindAsEventListener(this,arr,end,length),10);}else{this.allCheck=null
this.recheck();}},recheck:function(){var l=$$('#countriesResult li').length;var el=$('allCountries');var el2=$('countriesResult');if(l==252){el.show();el2.hide();}else{if((el!=null)&&el.visible()){el.hide();el2.show();}}
scrollbar2.recalculateLayout();},checkAll:function(type){if(type=='countries'){var el=$('allCountries');var el2=$('countriesResult');el.show();el2.hide();}
this.allCheck=true;var arr=$$('#'+type+'List li');setTimeout(this.realCheckAll.bindAsEventListener(this,arr,0,10),10);},realUncheckAll:function(event,arr,start,length){var end=Math.min(arr.length,start+length);for(var i=start;i<end;i++){var el=arr[i];if(el.hasClassName('selected')){el.onclick();}}
if(i<arr.length){setTimeout(this.realUncheckAll.bindAsEventListener(this,arr,end,length),10);}else{this.allCheck=null}},uncheckAll:function(type){$(type+'Result').update();this.recheck();this.allCheck=true;var arr=$$('#'+type+'List li');setTimeout(this.realUncheckAll.bindAsEventListener(this,arr,0,10),10);},filesReorder:function(id){var body=$('files'+id).select('li').map(function(el){return el.id.replace('file'+id+'_','');}).join(',');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=reorderFiles',{method:'post',postBody:'ruleID='+id+'&order='+body,onComplete:function(t){var first=true;$('files'+id).select('li').each(function(el){if(el.hasClassName('past'))return;if(el.hasClassName('active')){if(!first){el.removeClassName('active');el.addClassName('future');}
first=false;return;}
if(el.hasClassName('future')){if(first){el.removeClassName('future');el.addClassName('active')
first=false;}}});}});},redirectsReorder:function(id){var body=$('redirects'+id).select('li').map(function(el){return el.id.replace('redirect'+id+'_','');}).join(',');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=reorderRedirects',{method:'post',postBody:'ruleID='+id+'&order='+body,onComplete:function(t){var first=true;$('redirects'+id).select('li').each(function(el){if(el.hasClassName('past'))return;if(el.hasClassName('active')){if(!first){el.removeClassName('active');el.addClassName('future');}
first=false;return;}
if(el.hasClassName('future')){if(first){el.removeClassName('future');el.addClassName('active')
first=false;}}});}});}}
Files={addFileWindow:null,submit:function(){var el=$('FileReplace');if((((el!=null)&&(el.checked))||(el==null))&&($F('File')=='')){Alert.confirm(Lang.SelectFile,null,function(){});return false;}
if(($F('Limit')=='')){Alert.confirm(Lang.InputLimit,null,function(){});return false;}
return true;},addFile:function(){var _this=this;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addFile',{method:'post',postBody:null,onComplete:function(t){$('addFileContainer').update(t.responseText);$("fileUploadForm").target="upload_target";$("upload_target").onload=_this.uploaded.bindAsEventListener(_this);_this.addFileWindow.open();Event.observe('addFileClose','click',function(){_this.addFileWindow.close();});}});},editFile:function(id){var _this=this;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addFile',{method:'post',postBody:'fileID='+id,onComplete:function(t){$('addFileContainer').update(t.responseText);$("fileUploadForm").target="upload_target";$("upload_target").onload=_this.uploaded.bindAsEventListener(_this);_this.addFileWindow.open();Event.observe('addFileClose','click',function(){_this.addFileWindow.close();});}});},toggleFile:function(id){var el=$$('#file'+id+' .fileContent')[0];var btn=$$('#file'+id+' .min')[0];if(btn.hasClassName('max')){el.show();btn.removeClassName('max');}else{el.hide();btn.addClassName('max');}},uploaded:function(){var body=$('upload_target').contentDocument;var el=body.getElementById('result');if(el==null)return;var result=el.innerHTML;this.addFileWindow.close();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=filesAjax',{method:'post',postBody:null,onComplete:function(t){$('data2').update(t.responseText);}});},deleteFile:function(id){Alert.confirm(Lang.CloseAskLabel,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=deleteFile',{method:'post',postBody:'fileID='+id,onComplete:function(t){if(t.responseText=='0'){Alert.confirm(Lang.UsedFile,null,function(){});}else{$('file'+id).remove();}}});});},scan:function(id){$('loader'+id).show();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=fileScan',{method:'post',postBody:'fileID='+id,onComplete:function(t){$('loader'+id).hide();var el=$('fileScan');el.show();el.update(t.responseText);new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=filesAjax',{method:'post',postBody:null,onComplete:function(t){$('data2').update(t.responseText);}});}});},showLast:function(id){$('loader'+id).show();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=showLast',{method:'post',postBody:'fileID='+id,onComplete:function(t){$('loader'+id).hide();var el=$('fileScan');el.show();el.update(t.responseText);}});}}
Alert={confirm:function(title,btnTitle,callback){var alert=$('alert');alert.style.left=Math.round(document.body.offsetLeft+((window.innerWidth-$(alert).getWidth()))/2)+'px';$('alertTitle').update(title);var el=$('apply');var el2=$('cancel');if(btnTitle!=null){el.update(btnTitle);el.show();el2.setStyle({marginLeft:'0px'});el2.update(Lang.CloseCancelLabel);}else{el.hide();el2.setStyle({marginLeft:'40px'});el2.update('OK');}
el.onclick=function(){alert.hide();callback();}
alert.show();},cancel:function(){$('alert').hide();}}
Secur={addUrl:function(){var value=$F('UrlInput');if(value.indexOf('.')==-1){Alert.confirm(Lang.InvalidUrl,null,function(){});return;}
$('UrlInput').value='';$('UrlInput').focus();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addUrl',{method:'post',postBody:'value='+value,onComplete:function(t){var res=t.responseText;if(res!='false'){$('list1').insert(t.responseText);}else{Alert.confirm(Lang.DuplicateUrl,null,function(){});}}});},addIP:function(){var ip1=parseInt($F('IPInput1'));if(isNaN(ip1))ip1='*';var ip2=parseInt($F('IPInput2'));if(isNaN(ip2))ip2='*';var ip3=parseInt($F('IPInput3'));if(isNaN(ip3))ip3='*';var ip4=parseInt($F('IPInput4'));if(isNaN(ip4))ip4='*';if((ip1<0)||(ip1>255)||(ip2<0)||(ip2>255)||(ip3<0)||(ip3>255)||(ip4<0)||(ip4>255)){Alert.confirm(Lang.InvalidIP,null,function(){});return;}
var value=ip1+'.'+ip2+'.'+ip3+'.'+ip4;$('IPInput1').value='';$('IPInput2').value='';$('IPInput3').value='';$('IPInput4').value='';$('IPInput1').focus();new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=addIP',{method:'post',postBody:'value='+value,onComplete:function(t){var res=t.responseText;if(res!='false'){$('list2').insert(t.responseText);}else{Alert.confirm(Lang.DublicateIP,null,function(){});}}});},del:function(id){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=delIP',{method:'post',postBody:'id='+id,onComplete:function(t){$('r'+id).remove();}});}}
TotalUpdater={interval:10,staticParams:'',timer:null,start:function(_interval){this.interval=_interval;TotalUpdater.timer=setTimeout(TotalUpdater.update,TotalUpdater.interval*1000);},update:function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=refreshTotal',{method:'post',postBody:'',onComplete:function(t){var res=eval(t.responseText);$('hostsTotal').update(res[0]);$('hitsTotal').update(res[1]);$('executedTotal').update(res[2]);}});TotalUpdater.timer=setTimeout(TotalUpdater.update,TotalUpdater.interval*1000);}}
Prefs={saveFileName:function(){var value=$F('MainRename');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=MainRename&MainRename='+value,onComplete:function(t){window.location=t.responseText;}});},saveStatFileName:function(){var value=$F('StatRename');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=StatRename&StatRename='+value,onComplete:function(t){var el=$('StatRenameSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveStatParamName:function(){var value=$F('StatParamName');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=StatParamName&StatParamName='+value,onComplete:function(t){var el=$('StatParamNameSuccess');var res=t.responseText;if(res==0){el.update('<img src="'+Config.ImgPath+'err.png"/><span style="color:red;">Incorrect param name</span>');}else{el.update('<img src="'+Config.ImgPath+'accept.png"/><span>Changed</span>');}
el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},totalDelete:function(){Alert.confirm(Lang.DeleteConfirmText,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=totalDelete',{method:'post',postBody:null,onComplete:function(t){var el=$('TotalDeleteSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});});},threadDelete:function(){Alert.confirm(Lang.DeleteThreadText,Lang.CloseDeleteLabel,function(){new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=threadDelete',{method:'post',postBody:'threadID='+$F('threadSelect'),onComplete:function(t){var el=$('ThreadDeleteSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});});},saveFrameFileName:function(){var value=$F('FrameRename');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=FrameRename&FrameRename='+value,onComplete:function(t){var el=$('FrameRenameSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveDownloadFileName:function(){var value=$F('DownloadFileName');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=DownloadFileName&DownloadFileName='+value,onComplete:function(t){var el=$('DownloadFileNameSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveurltosmb:function(){var value=$F('urltosmb');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=urltosmb&urltosmb='+value,onComplete:function(t){var el=$('urltosmbSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveLimits:function(){var body=[];['MaxBrowsersLimit','MaxOSLimit','MaxCountriesLimit','MaxReferersLimit','ShowReferers'].each(function(el){body.push(el+'='+$F(el));});body.push('type=limits');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:body.join('&'),onComplete:function(t){var el=$('LimitsSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveVir:function(){var body=[];['virtestLogin','virtestPass','AVService'].each(function(el){body.push(el+'='+$F(el));});body.push('type=virtest');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:body.join('&'),onComplete:function(t){var el=$('VirSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},saveLanguage:function(){var value=$F('Language');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=language&language='+value,onComplete:function(t){window.location.reload();}});},saveTemplate:function(){var value=$F('Template');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=template&template='+value,onComplete:function(t){window.location.reload();}});},interval:null,saveInterval:function(){var value=this.interval;if(value=='never')value=9999;new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:'type=timeout&timeout='+value,onComplete:function(t){var el=$('IntervalSuccess');el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},savePassword:function(){var body='type=password&old='+$F('OldPassword')+'&new1='+$F('NewPassword1')+'&new2='+$F('NewPassword2');new Ajax.Request(Config.AdminScriptName+'?'+Config.MainParamName+'=savePrefsNew',{method:'post',postBody:body,onComplete:function(t){var el=$('PasswordSuccess');var res=t.responseText;if(res==0){el.update('<img src="'+Config.ImgPath+'err.png"/><span style="color:red;">Wrong old password</span>');}else if(res==2){el.update('<img src="'+Config.ImgPath+'err.png"/><span style="color:red;">Passwords dont match</span>');}else{el.update('<img src="'+Config.ImgPath+'accept.png"/><span>Password changed</span>');}
el.show();setTimeout(Prefs.hide.bindAsEventListener(this,el),4000);}});},hide:function(event,el){el.hide();},checkPasswords:function(){var pas1=$F('NewPassword1');var pas2=$F('NewPassword2');if(pas1!=pas2){$('ConfirmComment').show();}else{$('ConfirmComment').hide();}}}