<?php 
if( !defined("ADMIN_LOADED") ) 
{
    exit();
}

$imgPath = Config::get("AdminScriptName") . "?" . Config::get("MainParamName") . "=file&type=img&file=";
$ruleID = (isset($_POST["ruleID"]) ? intval($_POST["ruleID"]) : null);
if( $ruleID != null ) 
{
    $rule = db::selectone("*", "Rules", "ID = " . $ruleID);
    $_redirects = db::select("select * from Redirects where RuleID = " . $ruleID . " order by Sort asc");
    echo "<script>\r\n\t";
    foreach( $_redirects as $arr ) 
    {
        echo "\t\tThreads.addRealRedirect('";
        echo $arr["Title"];
        echo "', '";
        echo $arr["FileLimit"];
        echo "', true, ";
        echo $arr["ID"];
        echo ");\r\n\t";
    }
    echo "\tThreads.resortRedirect();\r\n\t";
    if( $rule["Title"] != "default" ) 
    {
        echo "\t\tvar el = \$('threadTitle');\r\n\t\tel.value = '";
        echo $rule["Title"];
        echo "';\r\n\t";
    }

    echo "</script>\r\n";
}

echo "<div class=\"main3\">\r\n\t<div class=\"title\">";
echo Lang::get("StatisticsRedirectsLabel");
echo "</div>\r\n\t<div class=\"title2\">";
echo Lang::get("LoadsLimit");
echo "</div>\r\n\t<div class=\"close\" id=\"addThreadClose\"></div>\r\n\t<div style=\"clear:both;\"></div>\r\n\t<div class=\"addRedirect\">\r\n\t\t<form onsubmit=\"return Threads.addRedirect();\">\r\n\t\t\t<div class=\"input\"><input type=\"text\" id=\"redirectUrl\" value=\"\" maxlength=\"256\"/></div>\r\n\t\t\t<input type=\"submit\" value=\"\" style=\"display:none;\"/>\r\n\t\t\t<div class=\"add\"><a href=\"javascript:void(0)\" onclick=\"Threads.addRedirect()\"><img src=\"";
echo $imgPath;
echo "plus.png\" width=\"14px\" height=\"14px\"/></a></div>\r\n\t\t</form>\r\n\t</div>\r\n\t\r\n\t<div id=\"selectedRedirects\">\r\n\t\t<ul id=\"redirectsResult\"></ul>\r\n\t</div> \r\n\t<div style=\"clear:both\"></div>\r\n\t<div class=\"foot\">\r\n\t\t";
if( $ruleID == null || $rule["Title"] != "default" ) 
{
    echo "\t\t\t<div class=\"prev\" onclick=\"Threads.prev()\">";
    echo Lang::get("Back");
    echo "</div>\r\n\t\t\t<div class=\"threadTitle\"><input type=\"text\" id=\"threadTitle\" value=\"\" maxlength=\"32\"/></div>\r\n\t\t";
}
else
{
    echo "\t\t\t<div class=\"prevLong\" onclick=\"Threads.toExploits()\">";
    echo Lang::get("ToExploits");
    echo "</div>\r\n\t\t";
}

echo "\t\t<div class=\"submit\"><input type=\"button\" onclick=\"Threads.submit('redirects')\" value=\"";
echo Lang::get("ConfigSubmitButton");
echo "\"/></div>\r\n\t</div>\r\n</div>";

