<?php 
if( !defined("ADMIN_LOADED") ) 
{
    exit();
}

list($browsers, $oses, $countries, $exploits) = Browser2::getalldata(array( "browsers2", "oses2", "countries", "exploits" ));
$imgPath = Config::get("AdminScriptName") . "?" . Config::get("MainParamName") . "=file&type=img&file=";
$ruleID = (isset($_POST["ruleID"]) ? intval($_POST["ruleID"]) : null);
if( $ruleID != null ) 
{
    $rule = db::selectone("*", "Rules", "ID = " . $ruleID);
    $_countries = explode(",", $rule["Countries"]);
    $_browsers = explode(",", $rule["Browsers"]);
    $_oses = explode(",", $rule["Oses"]);
    echo "<script>\r\n\t";
    foreach( $_countries as $id ) 
    {
        if( $id == "" ) 
        {
            continue;
        }

        echo "\t\tThreads.addCountry('countries_";
        echo $id;
        echo "','countries','countries/";
        echo strtolower(Browser::$countryCodes[$id]);
        echo ".gif');\r\n\t";
    }
    echo "\t";
    foreach( $_browsers as $id ) 
    {
        if( $id == "" ) 
        {
            continue;
        }

        echo "\t\tThreads.addBrowser('browser-";
        echo $id;
        echo "','browsers','";
        if( isset(Browser::$icons["browsers"][$id]) ) 
        {
            echo Browser::$icons["browsers"][$id];
        }

        echo ".gif');\r\n\t";
    }
    echo "\t";
    foreach( $_oses as $id ) 
    {
        if( $id == "" ) 
        {
            continue;
        }

        echo "\t\tThreads.addOS('oses-";
        echo $id;
        echo "','oses','";
        if( isset(Browser::$icons["oses"][$id]) ) 
        {
            echo Browser::$icons["oses"][$id];
        }

        echo ".gif');\r\n\t";
    }
    echo "\t\$('TrafficType').value = ";
    echo $rule["TrafficType"];
    echo ";\r\n</script>\r\n";
}

echo "<div class=\"main\">\r\n\t<div class=\"title\">";
echo Lang::get("StatisticsCountriesLabel");
echo "</div>\r\n\t<div class=\"title\">";
echo Lang::get("StatisticsBrowsersLabel");
echo "</div>\r\n\t<div class=\"title\">";
echo Lang::get("StatisticsOSLabel");
echo "</div>\r\n\t<!--<div class=\"title\">IP</div>-->\r\n\t<div class=\"close\" id=\"addThreadClose\"></div>\r\n\t<div style=\"clear:both;\"></div>\r\n\t\r\n\t<div class=\"addThreadList\">\r\n\t\t<div id=\"scrollbar_container\" class=\"result\">  \r\n\t\t\t<div id=\"scrollbar_track_countries\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"selectedCountries\" class=\"disabled\">\r\n\t\t\t\t<div class=\"disableDiv\">\r\n\t\t\t\t\t<div class=\"disableRegion\"></div>\r\n\t\t\t\t\t<div class=\"disableLabel\">";
echo Lang::get("CountriesFilter");
echo "</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ul id=\"countriesResult\"></ul>\r\n\t\t\t\t<div id=\"allCountries\" style=\"display:none;\">\r\n\t\t\t\t\t<img src=\"";
echo $imgPath;
echo "all_countries.png\" width=\"123px\" height=\"128px\"/>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t";
echo Lang::get("allCountries");
echo "\t\t\t\t</div>\r\n\t\t\t</div> \r\n\t\t</div>\r\n\t\t<div class=\"controls\">\r\n\t\t\t<div><a href=\"javascript:Threads.checkAll('countries')\"><img src=\"";
echo $imgPath;
echo "check.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("CheckAll");
echo "</a></div>\r\n\t\t\t<div><a href=\"javascript:Threads.uncheckAll('countries')\"><img src=\"";
echo $imgPath;
echo "check2.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("UncheckAll");
echo "</a></div>\r\n\t\t\t<div class=\"search\" onclick=\"Threads.showSearch()\"><img src=\"";
echo $imgPath;
echo "search.png\" width=\"13px\" height=\"13px\"/></div>\r\n\t\t\t<div class=\"searchStr\" style=\"display:none;\"><input type=\"text\" id=\"searchStr\" onkeyup=\"Threads.filter()\" style=\"width:0px;\"/></div>\r\n\t\t</div>\r\n\t\t<div id=\"scrollbar_container\">  \r\n\t\t\t<div id=\"scrollbar_track_countries2\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"countriesList\" class=\"widgetList\">\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t";
foreach( $countries as $k => $arr ) 
{
    echo "\t\t\t\t\t\t<li ";
    if( $k % 2 ) 
    {
        echo "class=\"odd\"";
    }

    echo " onclick=\"Threads.addCountry('countries_";
    echo $arr["id"];
    echo "','countries','countries/";
    echo strtolower(Browser::$countryCodes[$arr["id"]]);
    echo ".gif')\"><a id=\"countries_";
    echo $arr["id"];
    echo "\">";
    echo $arr["title"];
    echo "</a></li>\r\n\t\t\t\t\t";
}
echo "\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<div class=\"addThreadList\">\r\n\t\t<div id=\"scrollbar_container\" class=\"result\"> \r\n\t\t\t<div id=\"scrollbar_track_browsers\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"selectedBrowsers\" class=\"disabled\">\r\n\t\t\t\t<div class=\"disableDiv\">\r\n\t\t\t\t\t<div class=\"disableRegion\"></div>\r\n\t\t\t\t\t<div class=\"disableLabel\">";
echo Lang::get("BrowsersFilter");
echo "</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ul id=\"browsersResult\"></ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"controls\">\r\n\t\t\t<div><a href=\"javascript:Threads.checkAll('browsers')\"><img src=\"";
echo $imgPath;
echo "check.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("CheckAll");
echo "</a></div>\r\n\t\t\t<div><a href=\"javascript:Threads.uncheckAll('browsers')\"><img src=\"";
echo $imgPath;
echo "check2.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("UncheckAll");
echo "</a></div>\r\n\t\t</div>\r\n\t\t<div id=\"scrollbar_container\">  \r\n\t\t\t<div id=\"scrollbar_track_browsers2\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"browsersList\" class=\"widgetList\">\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t";
foreach( $browsers as $k => $arr ) 
{
    echo "\t\t\t\t\t\t<li ";
    if( $k % 2 ) 
    {
        echo "class=\"odd\"";
    }

    echo " onclick=\"Threads.addBrowser('browser-";
    echo $arr["id"];
    echo "','browsers','";
    if( isset(Browser::$icons["browsers"][$arr["id"]]) ) 
    {
        echo Browser::$icons["browsers"][$arr["id"]];
    }

    echo ".gif')\"><a id=\"browser-";
    echo $arr["id"];
    echo "\">";
    echo $arr["title"];
    echo "</a></li>\r\n\t\t\t\t\t";
}
echo "\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t\r\n\t<div class=\"addThreadList\">\r\n\t\t<div id=\"scrollbar_container\" class=\"result\"> \r\n\t\t\t<div id=\"scrollbar_track_oses\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"selectedOS\" class=\"disabled\">\r\n\t\t\t\t<div class=\"disableDiv\">\r\n\t\t\t\t\t<div class=\"disableRegion\"></div>\r\n\t\t\t\t\t<div class=\"disableLabel\">";
echo Lang::get("OSFilter");
echo "</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ul id=\"osesResult\"></ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"controls\">\r\n\t\t\t<div><a href=\"javascript:Threads.checkAll('oses')\"><img src=\"";
echo $imgPath;
echo "check.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("CheckAll");
echo "</a></div>\r\n\t\t\t<div><a href=\"javascript:Threads.uncheckAll('oses')\"><img src=\"";
echo $imgPath;
echo "check2.png\" width=\"15px\" height=\"11px\"/> ";
echo Lang::get("UncheckAll");
echo "</a></div>\r\n\t\t</div>\r\n\t\t<div id=\"scrollbar_container\">  \r\n\t\t\t<div id=\"scrollbar_track_oses2\"><div id=\"scrollbar_handle\"></div></div>  \r\n\t\t\t<div id=\"osesList\" class=\"widgetList\">\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t";
foreach( $oses as $k => $arr ) 
{
    echo "\t\t\t\t\t\t<li ";
    if( $k % 2 ) 
    {
        echo "class=\"odd\"";
    }

    echo " onclick=\"Threads.addOS('oses-";
    echo $arr["id"];
    echo "','oses','";
    if( isset(Browser::$icons["oses"][$arr["id"]]) ) 
    {
        echo Browser::$icons["oses"][$arr["id"]];
    }

    echo ".gif')\"><a id=\"oses-";
    echo $arr["id"];
    echo "\">";
    echo $arr["title"];
    echo "</a></li>\r\n\t\t\t\t\t";
}
echo "\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"next\">\r\n\t\t\t<div>\r\n\t\t\t\t<input type=\"radio\" id=\"nextExploit\" name=\"nextType\" value=\"exploit\" ";
if( $ruleID == null || $ruleID != null && $rule["isRedirect"] == 0 ) 
{
    echo " checked=\"checked\"";
}

echo "/>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"label\">\r\n\t\t\t\t<label for=\"nextExploit\">";
echo Lang::get("StatisticsExploitsLabel");
echo "</label>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<input type=\"radio\" id=\"nextRedirect\" name=\"nextType\" value=\"redirect\" ";
if( $ruleID != null && $rule["isRedirect"] == 1 ) 
{
    echo " checked=\"checked\"";
}

echo "/>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"label\">\r\n\t\t\t\t<label for=\"nextRedirect\">";
echo Lang::get("StatisticsRedirectsLabel");
echo "</label>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"btn\">\r\n\t\t\t\t<input class=\"next\" type=\"button\" onclick=\"Threads.next()\" value=\"";
echo Lang::get("Next");
echo "\"/>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"select\">\r\n\t\t\t\t<select id=\"TrafficType\">\r\n\t\t\t\t\t<option value=\"0\">";
echo Lang::get("ForAll");
echo "</option>\r\n\t\t\t\t\t<option value=\"1\">";
echo Lang::get("ForHits");
echo "</option>\t\t\t\t\t\r\n\t\t\t\t\t<option value=\"2\">";
echo Lang::get("ForHosts");
echo "</option>\t\t\t\t\t\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div style=\"clear:both;\"></div>\r\n</div>";

